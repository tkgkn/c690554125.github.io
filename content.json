{"meta":{"title":"ä¸‰è§’çŒ«","subtitle":"","description":"ä¸ªäººåšå®¢ï¼Œè®°å½•å­¦ä¹ ï¼Œæ€è€ƒï¼Œç”Ÿæ´»","author":"czm","url":"https://690554125.github.io","root":"/"},"pages":[{"title":"æ ‡ç­¾","date":"2021-11-04T14:52:59.668Z","updated":"2021-11-04T14:52:59.667Z","comments":false,"path":"tags/index.html","permalink":"https://690554125.github.io/tags/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2021-11-06T07:27:06.381Z","updated":"2021-11-06T07:27:06.381Z","comments":false,"path":"about/index.html","permalink":"https://690554125.github.io/about/index.html","excerpt":"","text":"é˜¿é‡Œå·´å·´æ‰“å·¥ä¸­â€¦"}],"posts":[{"title":"JSåŸå‹å’Œç»§æ‰¿","slug":"2020/åŸå‹å’Œç»§æ‰¿åˆè¯†","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:36:11.575Z","comments":true,"path":"2020/12/30/2020/åŸå‹å’Œç»§æ‰¿åˆè¯†/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF%E5%88%9D%E8%AF%86/","excerpt":"","text":"åˆæ­¥ä»‹ç»ä¸‹åŸå‹å’Œç»§æ‰¿ï¼Œä»¥åŠç›¸å…³çš„ API. åŸå‹æ˜¯ä»€ä¹ˆæ‰€æœ‰çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬å‡½æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ªéšè—çš„å†…éƒ¨å±æ€§[[Prototype]]ï¼Œè¯¥å±æ€§å¼•ç”¨çš„å°±æ˜¯åŸå‹ï¼ŒåŸå‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥åŸå‹è‡ªå·±ä¹Ÿæœ‰åŸå‹ã€‚ åŸå‹é•¿ä»€ä¹ˆæ ·å› ä¸º[[Prototype]]æ˜¯å†…éƒ¨å±æ€§ï¼Œæ‰€ä»¥é€šè¿‡ä»£ç æ— æ³•è®¿é—®ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å…¶ä»–æ–¹å¼è®¿é—®åˆ°åŸå‹ã€‚ æ„é€ å‡½æ•°æ‰æœ‰çš„ prototypeè¿™æ˜¯ JS æ—©æœŸå°±æœ‰çš„å±æ€§ï¼Œåªæœ‰å‡½æ•°æ‰æœ‰ï¼Œå­—é¢é‡å¯¹è±¡æ˜¯æ²¡æœ‰çš„ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°å°è¯•è®¿é—®ä¸€ä¸ªå­—é¢é‡å¯¹è±¡çš„prototypeï¼Œå‘ç°æ˜¯undefinedã€‚æ‰€ä»¥è¿™ä¸ªåŠŸèƒ½æœ‰é™ã€‚ 12345function Person(name) &#123; this.name = name;&#125;console.log(Person.prototype); ç»“æœå¦‚å›¾ï¼š __proto__2012 å¹´ï¼ŒObject.create()è¢«å†™å…¥æ ‡å‡†ï¼Œæä¾›äº†ä½¿ç”¨ç»™å®šåŸå‹åˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›ï¼Œç„¶åè¿˜æ˜¯æ²¡æœ‰æä¾›set/getåŸå‹çš„èƒ½åŠ›ï¼Œæµè§ˆå™¨å‚å•†ä»¬å› æ­¤å®ç°äº†éæ ‡å‡†çš„__proto__è®¿é—®å™¨å±æ€§ï¼Œå…è®¸ç”¨æˆ·éšæ—¶ä¿®æ”¹å’Œè·å–åŸå‹å¯¹è±¡ã€‚ 12345var a = &#123;&#125;;console.log(a.__proto__);function b() &#123;&#125;console.log(b.__proto__); ç»“æœå¦‚å›¾ï¼š æ ‡å‡†æ–¹æ³• Object.getPrototypeOf å’Œ Object.setPrototypeOf2015 å¹´ï¼Œè¿™ 2 ä¸ªæ–¹æ³•è¢«åŠ å…¥åˆ°æ ‡å‡†ä¸­ã€‚ä½†æ˜¯å› ä¸º__proto__åœ¨å¾ˆå¤šæµè§ˆå™¨éƒ½å¾—åˆ°äº†å®ç°ï¼Œå³ä¾¿è¿‡æ—¶ï¼Œä½†ä¹Ÿè¢«åŠ å…¥åˆ°æ ‡å‡†çš„é™„ä»¶ä¸­äº†ã€‚ 12var a = &#123;&#125;;Object.getPrototypeOf(a); ç»“æœå¦‚å›¾ æ€»ç»“ï¼šä»ä¸Šé¢çš„å‡ ä¸ªä»£ç æ¡ˆä¾‹çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ‰€æ‰“å°çš„åŸå‹å°±æ˜¯å¯¹è±¡ã€‚ åŸå‹çš„ä½œç”¨å½“æˆ‘ä»¬æƒ³è¦è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå…ˆä»å¯¹è±¡è‡ªèº«æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šå»å¯¹è±¡çš„ç§æœ‰å±æ€§[[Prototype]] æ‰€å¼•ç”¨çš„åŸå‹å¯¹è±¡ä¸Šå»æ‰¾ã€‚ 123456789var parent = &#123; run: true,&#125;;var son = &#123;&#125;;Object.setPrototypeOf(son, parent); // ç­‰äº son.__proto__ = parentson.run; // true sonå¯¹è±¡æœ¬èº«æ²¡æœ‰runå±æ€§ï¼Œæ‰€ä»¥ä¼šæ²¿ç€[[Prototype]]æŒ‡å‘çš„åŸå‹å¯¹è±¡ä¸Šå»æ‰¾ è¿™ä¸ªç‰¹æ€§å¯ä»¥è®©æˆ‘ä»¬å¤ç”¨é€»è¾‘ï¼Œå®ç°é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„ ç»§æ‰¿ ç‰¹æ€§ã€‚ JS ä¸­çš„ç»§æ‰¿JS ä¸­çš„ç»§æ‰¿æ˜¯é€šè¿‡[[Prototype]]æ¥å®ç°çš„ï¼Œå³ä¾¿åœ¨ ES6 æ—¶ä»£æœ‰äº†classå…³é”®å­—ã€‚ æ—©æœŸçš„å‡½æ•°æ–¹å¼ç»§æ‰¿ï¼š 12345678910function Person() &#123; this.run = true;&#125;function Son() &#123;&#125;Son.prototype = new Person();var son = new Son();son.run; // true ä½¿ç”¨ es6 å…³é”®å­—classå®ç° 1234567891011121314class Parent &#123; constructor() &#123; this.run = true; &#125;&#125;class Son extends Parent &#123; constructor() &#123; super(); &#125;&#125;const son = new Son();son.run; æ€»ç»“åŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨å±æ€§[[Prototype]]æ‰€å¼•ç”¨çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä» JS è¯ç”Ÿå¼€å§‹ï¼Œå°±æœ‰F.prototypeçš„æ–¹å¼å¯ä»¥è®¿é—®åˆ°åŸå‹ï¼Œå’Œä¿®æ”¹åŸå‹ï¼Œä½†æ˜¯åªæœ‰å‡½æ•°æ‰æœ‰prototypeï¼Œåæ¥æµè§ˆå™¨å‚å•†è‡ªå·±å®ç°äº†__proto__è®¿é—®å™¨å±æ€§æ¥å®ç°å¯¹åŸå‹çš„set/getï¼Œç›´åˆ° ES æ ‡å‡†è§„å®šäº†åŸå‹çš„è®¿é—®å’Œè®¾ç½®çš„æ–¹æ³•Object.getPrototypeOfå’ŒObject.setPrototypeOfã€‚ åŸå‹å­˜åœ¨çš„æœ€å¤§ä½œç”¨æ˜¯ç»§æ‰¿ï¼ŒJS ä¸­çš„ç»§æ‰¿éƒ½æ˜¯åŸå‹ç»§æ‰¿ï¼Œä»ä»¥å‰çš„å‡½æ•°ç»§æ‰¿åˆ°ç°åœ¨çš„classç±»è¯­æ³•ç³–æ¥å®ç°ç»§æ‰¿ã€‚","categories":[],"tags":[]},{"title":"å¯¼èˆªæµç¨‹","slug":"2020/URLè¾“å…¥åˆ°é¡µé¢æ¸²æŸ“æµç¨‹","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:36:21.906Z","comments":true,"path":"2020/12/30/2020/URLè¾“å…¥åˆ°é¡µé¢æ¸²æŸ“æµç¨‹/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/URL%E8%BE%93%E5%85%A5%E5%88%B0%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B/","excerpt":"","text":"è¿™é‡Œå…ˆé…æµç¨‹å›¾ï¼Œåé¢æè¿°åœ¨ä¸°å¯Œä¸€ä¸‹ã€‚ å¯¼èˆªé˜¶æ®µ æ¸²æŸ“é˜¶æ®µ","categories":[],"tags":[]},{"title":"å®ç°Promiseï¼ˆç‰ˆæœ¬2è‡ªå·±å®ç°ï¼‰","slug":"2020/å®ç°promise_v2","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:35:35.757Z","comments":true,"path":"2020/12/30/2020/å®ç°promise_v2/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E5%AE%9E%E7%8E%B0promise_v2/","excerpt":"","text":"ä¸Šä¸€æ¬¡å®ç°çš„Promiseæ€è·¯æ¯”è¾ƒç»•ï¼Œä¸å®¹æ˜“ç†è§£ã€‚å‚è€ƒå¸‚é¢ä¸Šå¤§éƒ¨åˆ†çš„å®ç°æ–¹å¼ï¼Œè‡ªå·±å®ç°äº†ä¸€æŠŠã€‚ åŸç”Ÿ123456789101112131415// æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ¥å—2ä¸ªå›è°ƒå‡½æ•°ï¼Œresolve å’Œ rejectvar p = new Promise((resolve, reject) =&gt; &#123; // ... // promiseåˆå§‹çŠ¶æ€ä¸ºpending // ä¸¤ç§ç»“æœåªèƒ½é€‰å…¶ä¸€ï¼Œä¿®æ”¹çŠ¶æ€ï¼Œå¹¶ä¼ é€’å€¼æˆ–é”™è¯¯ // resolve(value) çŠ¶æ€ -&gt; resolved // or // reject(error) çŠ¶æ€ -&gt; rejected&#125;);// å¼‚æ­¥æˆ–åŒæ­¥æ³¨å†Œthenå‡½æ•°ï¼Œå‡½æ•°æ¥å—2ä¸ªå›è°ƒï¼Œä¸€ä¸ªæ˜¯resolvedçš„valueï¼Œä¸€ä¸ªæ˜¯rejectedçš„errp.then(onResolved, onRejected);// thenå¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡æ³¨å†Œ2ä¸ªå›è°ƒï¼Œä¸€æ—¦promiseå†³è®®ï¼ŒçŠ¶æ€ä¸åœ¨æ”¹å˜p.then(); å…ˆæ­æ¶å­1234567891011121314151617181920212223242526272829// å¸¸é‡å®šä¹‰çŠ¶æ€const PENDING = &#x27;pending&#x27;;const RESOLVED = &#x27;resolved&#x27;;const REJECTED = &#x27;rejected&#x27;;// promiseæ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°fnï¼Œfnæ¥æ”¶resolve å’Œ rejectfunction MyPromise(fn) &#123; // åˆå§‹çŠ¶æ€ var state = &#x27;pending&#x27;; // ç»ˆå€¼ var finalValue = null; // æ”¶é›†thenä¸­æ³¨å†Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œfullfilled var onFulfilledCallback = []; // æ”¶é›†thenä¸­æ³¨å†Œçš„ç¬¬äºŒä¸ªå‡½æ•°ï¼Œrejected var onRejectedCallback = []; // å†…éƒ¨å®ç°çš„resolve function resolve(value) &#123;&#125; // å†…éƒ¨å®ç°çš„reject function reject(err) &#123;&#125; // å®ç°thenæ–¹æ³• // å› ä¸ºè°ƒç”¨æ–¹å¼æ˜¯ obj.thenï¼Œå±äºå®ä¾‹å±æ€§ // æ¥æ”¶2ä¸ªå‚æ•°onFulfilled, onRejected this.then = function (onFulfilled, onRejected) &#123;&#125;; fn(resolve, reject);&#125; å¡«å……åŸºæœ¬çš„ promise åŠŸèƒ½å®ç°resolve,reject,thenæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374// å¸¸é‡å®šä¹‰çŠ¶æ€const PENDING = &#x27;pending&#x27;;const RESOLVED = &#x27;resolved&#x27;;const REJECTED = &#x27;rejected&#x27;;// promiseæ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°fnï¼Œfnæ¥æ”¶resolve å’Œ rejectfunction MyPromise(fn) &#123; // åˆå§‹çŠ¶æ€ var state = &#x27;pending&#x27;; // ç»ˆå€¼ var finalValue = null; // æ”¶é›†thenä¸­æ³¨å†Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œfullfilled var onFulfilledCallback = []; // æ”¶é›†thenä¸­æ³¨å†Œçš„ç¬¬äºŒä¸ªå‡½æ•°ï¼Œrejected var onRejectedCallback = []; // å†…éƒ¨å®ç°çš„resolve function resolve(value) &#123; // åªæœ‰çŠ¶æ€ä¸ºpendingæ—¶ï¼Œå¯ä»¥è§¦å‘ if (state === PENDING) &#123; // ä¿®æ”¹çŠ¶æ€ä¸º resolved state = RESOLVED; // ä¿®æ”¹è¯¥promiseç»ˆå€¼ä¸ºè°ƒç”¨æ—¶ä¼ é€’çš„å€¼ finalValue = value; // å°†æ”¶é›†åˆ°çš„thenæ³¨å†Œçš„æ–¹æ³•ï¼Œå…¨éƒ¨æ‰§è¡Œä¸€é onFulfilledCallback.forEach((cb) =&gt; &#123; cb(value); &#125;); &#125; &#125; // å†…éƒ¨å®ç°çš„reject function reject(err) &#123; // åªæœ‰çŠ¶æ€ä¸ºpendingæ—¶ï¼Œå¯ä»¥è§¦å‘ if (state === PENDING) &#123; // ä¿®æ”¹çŠ¶æ€ä¸º rejected state = RESOLVED; // ä¿®æ”¹è¯¥promiseç»ˆå€¼ä¸ºè°ƒç”¨æ—¶ä¼ é€’çš„å€¼ finalValue = err; // å°†æ”¶é›†åˆ°çš„thenæ³¨å†Œçš„æ–¹æ³•ï¼Œå…¨éƒ¨æ‰§è¡Œä¸€é onRejectedCallback.forEach((cb) =&gt; &#123; cb(err); &#125;); &#125; &#125; // å®ç°thenæ–¹æ³• // å› ä¸ºè°ƒç”¨æ–¹å¼æ˜¯ obj.thenï¼Œå±äºå®ä¾‹å±æ€§ // æ¥æ”¶2ä¸ªå‚æ•°onFulfilled, onRejected this.then = function (onFulfilled, onRejected) &#123; // è°ƒç”¨thençš„æ—¶å€™ï¼Œå¦‚æœè¯¥promiseå·²ç»å†³è®®äº†ï¼Œåˆ™æ‰§è¡Œå…¶æ³¨å†Œçš„å›è°ƒ if (state === RESOLVED) &#123; onResolved(value); &#125; if (state === REJECTED) &#123; onRejected(value); &#125; // ç»§ç»­æ³¨å†Œthençš„å‚æ•°åˆ°å„è‡ªå›è°ƒä¸­ if (state === PENDING) &#123; onFulfilledCallback.push(onFulfilled); onRejectedCallback.push(onRejected); &#125; &#125;; // æ‰§è¡Œnew promise(fn)ä¸­çš„fnï¼Œæœ‰å¯èƒ½å‡ºé”™ï¼Œæ‰€ä»¥try catchåŒ…è£¹ try &#123; fn(resolve, reject); &#125; catch (err) &#123; // å‡ºé”™å°±å°±å†³è®®è¿™ä¸ªpromiseä¸ºrejectï¼Œè°ƒç”¨å…¶rejectæ–¹æ³• reject(err); &#125;&#125; å®Œå–„ then thenæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„promise2ï¼Œè€Œpromise2çš„ç»ˆå€¼ï¼Œå–å†³äºä¸Šä¸€ä¸ªpromiseçš„thençš„è¿”å›å€¼ï¼Œæˆ‘ä»¬æ¥æ”¹é€ then thenæ–¹æ³•æ¥æ”¶ 2 ä¸ªå›è°ƒå‡½æ•°ï¼Œéå¿…ä¼ ï¼Œæœªä¼ æ—¶éœ€è¦æœ‰é»˜è®¤çš„ï¼Œå› ä¸ºç©ºthenå¯ä»¥é€ä¼ ç»“æœã€‚å¦‚ä¸‹ 1234var p = new Promise((resolve) =&gt; resolve(1));p.then() .then() .then((r) =&gt; console.log(r)); // 1 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182this.then = function (onResolved, onRejected) &#123; // åˆ¤æ–­thenæ³¨å†Œçš„æ˜¯å¦æ˜¯å‡½æ•°ï¼Œå¦åˆ™è¦æä¾›é»˜è®¤å‡½æ•°ï¼Œé€ä¼ ç»“æœ onFulfilled = typeof onFulfilled === &#x27;function&#x27; ? onFulfilled : (v) =&gt; v; onRejected = typeof onRejected === &#x27;function&#x27; ? onRejected : (err) =&gt; &#123; throw err; &#125;; let promise2 = null; if (state === RESOLVED) &#123; promise2 = new MyPromise((resolve, reject) =&gt; &#123; // å› ä¸ºæ‰§è¡ŒonResolvedçš„å‡½æ•°å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥tryåŒ…è£¹ try &#123; // æ‹¿åˆ°å‰ä¸€ä¸ªpromiseçš„thenä¸­ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆonResolvedï¼‰æ‰§è¡Œåçš„ç»“æœï¼Œè¿™é‡Œç”¨xè¡¨ç¤ºã€‚ const x = onResolved(value); // å¦‚æœxæ˜¯ä¸€ä¸ªx-promiseï¼Œåˆ™æˆ‘ä»¬éœ€è¦ç”¨è¿™ä¸ªx-promiseçš„ç»ˆå€¼ä½œä¸ºpromise2çš„ç»ˆå€¼ if (x instanceof MyPromise) &#123; // è¿™é‡Œä¼ é€’ç»™x.thençš„ onFulfilledå‡½æ•°ï¼Œæ˜¯ promise2çš„ resolveï¼Œå¦‚æœx-promiseå†³è®®äº†ï¼Œå°±ä¼šå»è°ƒç”¨promise2çš„resolveï¼Œä»è€Œå†³å®šäº†promise2çš„ç»ˆå€¼ã€‚ x.then(resolve, reject); &#125; else &#123; // å¦‚æœxä¸æ˜¯æˆ‘ä»¬çš„MyPromiseå®ä¾‹ï¼Œåˆ™ç›´æ¥è°ƒç”¨promise2çš„resolveï¼Œå†³è®®å³å¯ã€‚ resolve(x); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125;); // è¿”å›promise2 return promise2; &#125; if (state === REJECTED) &#123; promise2 = new MyPromise((resolve, reject) =&gt; &#123; // è¿™é‡Œè§£æçš„é“ç†ä¸ä¸Šé¢ä¸€æ ·ã€‚ try &#123; const x = onRejected(value); if (x instanceof MyPromise) &#123; x.then(resolve, reject); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125;); return promise2; &#125; // ç»§ç»­æ³¨å†Œthençš„å‚æ•°åˆ°å„è‡ªå›è°ƒä¸­ if (state === PENDING) &#123; // promise1è¿˜æœªå†³è®®ï¼Œä¸æ¸…æ¥šæ˜¯æ‰§è¡Œresolveè¿˜æ˜¯rejectï¼Œæ‰€ä»¥ï¼Œå°†å›è°ƒå‡½æ•°æ’å…¥å¯¹åº”æ•°ç»„ promise2 = new MyPromise((resolve, reject) =&gt; &#123; // å°†promise1çš„thenæ–¹æ³•æ³¨å†Œçš„å‡½æ•°æ’å…¥ // thençš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š(res) =&gt; &#123;&#125; onFulfilledCallback.push(function (value) &#123; try &#123; var x = onResolved(value); if (x instanceof Promise) &#123; x.then(resolve, reject); &#125; else &#123; // å¦‚æœxä¸æ˜¯æˆ‘ä»¬çš„MyPromiseå®ä¾‹ï¼Œåˆ™ç›´æ¥è°ƒç”¨promise2çš„resolveï¼Œå†³è®®å³å¯ã€‚ resolve(x); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125;); // thençš„ç¬¬äºŒä¸ªå‚æ•° (err) =&gt; &#123;&#125; onRejectedCallback.push(function (reason) &#123; try &#123; var x = onRejected(reason); if (x instanceof Promise) &#123; x.then(resolve, reject); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125;); &#125;); return promise2; &#125;&#125;; å®ç° catchå®ç°äº†thenåï¼Œå†å®ç°catchä¼šå¾ˆç®€å•ï¼Œcatchå®é™…ä¸Šå°±æ˜¯then(null, onRejected)ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸å¤„ç†ã€‚ çœ‹çœ‹åŸç”Ÿçš„å®ç°æ–¹å¼ 1234567var p = new Promise((resolve, reject) =&gt; &#123; reject(new Error(&#x27;this is error&#x27;));&#125;);p.catch((err) =&gt; &#123; console.log(err); // æ‰“å°Error&#125;); 1234// æ¥æ”¶ä¸€ä¸ªå¤„ç†é”™è¯¯çš„æ–¹æ³•ï¼Œæ–¹æ³•æ¥æ”¶ä¸€ä¸ªreasonthis.catch = function (fn) &#123; this.then(null, fn);&#125;; å®ç° Promise.allçœ‹çœ‹åŸç”Ÿçš„å®ç° 12345678910111213141516171819var p1 = new Promise((resolve) =&gt; resolve(1));var p2 = new Promise((resolve) =&gt; resolve(2));Promise.all([p1, p2]).then((res) =&gt; &#123; console.log(res); // [1,2]&#125;);// å¦‚æœæœ‰rejectedæ‰çš„ï¼Œåˆ™æ•´ä¸ªpromise rejectedæ‰var p3 = new Promise((resolve, reject) =&gt; &#123; reject(new Error(&#x27;this is error&#x27;));&#125;);Promise.all([p1, p2, p3]) .then((res) =&gt; &#123; console.log(res); &#125;) .catch((err) =&gt; &#123; console.log(err); // Error: this is error &#125;); ä»åŸç”Ÿçš„å®ç°æˆ‘ä»¬å¾—çŸ¥ï¼ŒPromise.allåšçš„äº‹æœ‰è¿™äº›ï¼š è¿”å›ä¸€ä¸ª promise æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æˆå‘˜éƒ½æ˜¯promise å¦‚æœå…¨éƒ¨æˆå‘˜resolvedï¼Œåˆ™è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€é¡¹æ˜¯æ¯ä¸ªæˆå‘˜çš„resolvedçš„ç»ˆå€¼ å¦‚æœæœ‰ä¸€ä¸ªæˆå‘˜rejectedï¼Œåˆ™æ•´ä¸ªpromiseè¢«rejectedæ‰ã€‚ 12345678910111213141516171819202122232425262728MyPromise.all = function (promises) &#123; // è¿”å›ä¸€ä¸ªpromise return new MyPromise((resolve, reject) =&gt; &#123; // å­˜æ”¾æ¯ä¸ªæˆå‘˜çš„ç»ˆå€¼ const res = []; // å¾ªç¯æ‰§è¡Œæ¯ä¸ªæˆå‘˜ for (let i = 0; i &lt; promises.length; i++) &#123; promises[i].then( (r) =&gt; &#123; // å¦‚æœæˆåŠŸresolvedäº†ï¼Œå°±å¾€ç»ˆå€¼æ•°ç»„é‡Œå¡å…¥ç»ˆå€¼ res.push(r); // å½“ç»ˆå€¼æ•°ç»„é•¿åº¦å’Œä¼ å…¥çš„promiseé•¿åº¦ç›¸ç­‰ï¼Œåˆ™å¯ä»¥resolvedæ•´ä¸ªå¤§promiseï¼Œç»ˆå€¼å°±æ˜¯ç»ˆå€¼æ•°ç»„ if (res.length === promises.length) &#123; resolve(res); &#125; &#125;, (err) =&gt; &#123; reject(err); &#125; ); // åŸæœ¬å°è¯•ç”¨catchæ¥æ•è·é”™è¯¯ï¼Œä¸è¡Œ // åŸå› ï¼šcatché€šè¿‡thenæ¨¡æ‹Ÿçš„ï¼Œæ¯”thenä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ‰§è¡Œï¼Œæ…¢ã€‚å› ä¸ºsetTimeoutæ’å…¥macroçš„æ—¶æœºå…³ç³»ã€‚ &#125; // åŸæœ¬å°†resolveæ”¾åˆ°è¿™é‡Œæ‰§è¡Œï¼Œä¸è¡Œã€‚ // åŸå› ï¼šå› ä¸ºæ‰€æœ‰å¼‚æ­¥é€šè¿‡setTimeoutæ¥å®ç°ï¼Œforå¾ªç¯ç»“æŸäº†ï¼Œç«‹é©¬å°±æ‰§è¡Œresolveäº†ï¼Œåœ¨rejectä¹‹å‰æ‰§è¡Œï¼Œå¯¼è‡´æ•´ä¸ªpromiseæ˜¯resolvedçš„çŠ¶æ€ // resolve(res) &#125;);&#125;; æ€»ç»“è¯¥ç‰ˆæœ¬çš„ promise æ•´ä½“è¾ƒä¸ºå®¹æ˜“ç†è§£ï¼ŒçœŸæ­£çš„æ¨¡æ‹Ÿå®ç°ï¼Œè¿˜åº”è¯¥æ ¹æ®PromiseA+è§„èŒƒçº¦å®šçš„ï¼Œå¤„ç†å„ä¸ªpromiseå®ç°çš„å…¼å®¹ï¼Œè¿™é‡Œå°±ä¸åšåˆ†æäº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šã€‚ è‡³äºraceç­‰æ–¹æ³•ï¼Œå…¶å®è·Ÿallå·®ä¸å¤šäº†ï¼Œåªè¦æœ‰ä¸€ä¸ªresolvedæˆ–rejectedäº†ï¼Œæ•´ä½“å°±å†³è®®äº†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…ï¼Œè‡ªå·±å°è¯•ä¸‹ã€‚ ä¸Šä¸€ä¸‹codesandboxçš„æµ‹è¯•é“¾æ¥ï¼Œæ‰‹æ’• promiseã€‚","categories":[],"tags":[]},{"title":"å®ç°Promiseï¼ˆç‰ˆæœ¬1ï¼‰","slug":"2020/å®ç°promise_v1","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:35:17.136Z","comments":true,"path":"2020/12/30/2020/å®ç°promise_v1/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E5%AE%9E%E7%8E%B0promise_v1/","excerpt":"","text":"å®ç°ä¸€ä¸ªPromiseã€‚ åŸç”Ÿçš„è¯­æ³•å¦‚ä¸‹ 123456var p = new Promise(function (resolve) &#123; resolve(1);&#125;);p.then(function (val) &#123; console.log(val);&#125;); çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯å‡½æ•°æœ‰ä¸ªthenæ–¹æ³•å‘—ã€‚ 123456789101112function miniPromise() &#123; return &#123; then: (callback) =&gt; &#123; var value = 1; callback(value); &#125;, &#125;;&#125;miniPromise().then(function (v) &#123; console.log(v); // 1&#125;); å®ç°äº†ä¸€ä¸ªå®Œå…¨åªæ˜¯è¯­æ³•ç³–çš„promise ğŸ˜ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ ç®€å•å®ç° promise æ¥æ”¶ä¸€ä¸ªå‡½æ•° fnï¼Œåˆ›å»º promise æ—¶ï¼Œfn è‡ªåŠ¨æ‰§è¡Œï¼Œä¸” fn æ¥æ”¶resolveã€‚ å‡½æ•°æœ‰ä¸ªthenæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æ¥æ”¶ç»ˆå€¼ã€‚ 123456789101112131415161718function MyPromise(fn) &#123; var callback = null; this.then = function (cb) &#123; callback = cb; &#125;; function resolve(value) &#123; callback(value); &#125; fn(resolve);&#125;MyPromise(function (resolve) &#123; resolve(1);&#125;).then((value) =&gt; &#123; console.log(1);&#125;); ä¸Šé¢ä»£ç æ‰§è¡Œä¼šæŠ¥é”™ï¼Œcallbackä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚åˆ†æçœ‹å‡ºMyPromiseæ‰§è¡Œæ—¶è°ƒç”¨äº†resolveæ–¹æ³•ï¼Œé‡Œé¢é€šè¿‡callbackå¾—åˆ°å€¼ï¼Œä½†æ˜¯æ­¤æ—¶thenè¿˜æœªè°ƒç”¨å‘¢ï¼Œcallbackæ˜¯ null æ‰€ä»¥ æˆ‘ä»¬éœ€è¦ç­‰åˆ°thenæ³¨å†Œå®Œcallbackååœ¨è°ƒç”¨ï¼Œå¯ä»¥å°†callbackå¼‚æ­¥æ‰§è¡Œï¼ˆä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼‰ï¼Œä¿è¯åŒæ­¥æ³¨å†Œçš„thenå‡½æ•°å…ˆè§¦å‘å»æ³¨å†Œcallbackã€‚ 1234567891011121314151617181920function MyPromise(fn) &#123; var callback = null; this.then = function (cb) &#123; callback = cb; &#125;; function resolve(value) &#123; setTimeout(() =&gt; &#123; callback(value); &#125;, 1); &#125; fn(resolve);&#125;MyPromise(function (resolve) &#123; resolve(1);&#125;).then((value) =&gt; &#123; console.log(1);&#125;); çœ‹èµ·æ¥å¯ä»¥æ­£å¸¸è·‘ï¼Œåªæ˜¯å½“thenå¼‚æ­¥è°ƒç”¨æ—¶ï¼Œå‘ç°åˆä¸ç®¡ç”¨äº†ã€‚ åŠ å…¥çŠ¶æ€æœºåˆ¶æˆ‘ä»¬æ¥å¼•å…¥promiseçš„çŠ¶æ€æœºæ¥è§£å†³å¼‚æ­¥æ³¨å†Œçš„é—®é¢˜ã€‚ 1234567891011121314151617181920212223242526function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var deferred = null; // resolveçš„å·¥ä½œæ˜¯å°†çŠ¶æ€åˆ‡æ¢ä¸ºresolved function resolve(newV) &#123; state = &#x27;resolved&#x27;; value = newV; // å¦‚æœresolveæ—¶ï¼Œå·²ç»æœ‰æ³¨å†Œè¿‡å‡½æ•°ï¼Œåˆ™æ‰§è¡Œ if (deferred) &#123; deferred(value); &#125; &#125; // then æ³¨å†Œä¸€ä¸ªonResolvedæ–¹æ³•ï¼Œæ¥æ”¶ç»ˆå€¼ this.then = function (onResolved) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = onResolved; &#125; else &#123; onResolved(value); &#125; &#125;; fn(resolve);&#125; ä¸Šé¢ä»£ç çš„deferredå’ŒonResolvedå…¶å®æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œåªä¸è¿‡å¦‚æœstateè¿˜æ˜¯peddingçŠ¶æ€ï¼Œåˆ™onResolvedéœ€è¦å»¶è¿Ÿåˆ°resolveè°ƒç”¨åæ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€è°ƒåº¦è°ƒç”¨deferredï¼ˆæˆ–è€…è¯´æ˜¯onResolvedï¼‰ 12345678910111213141516171819202122232425262728293031function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var deferred = null; // resolveçš„å·¥ä½œæ˜¯å°†çŠ¶æ€åˆ‡æ¢ä¸ºresolved function resolve(newV) &#123; state = &#x27;resolved&#x27;; value = newV; // å¦‚æœresolveæ—¶ï¼Œå·²ç»æœ‰æ³¨å†Œè¿‡å‡½æ•°ï¼Œåˆ™æ‰§è¡Œ if (deferred) &#123; deferred(value); &#125; &#125; // ç»Ÿä¸€è°ƒåº¦è°ƒç”¨onResolved function handle(onResolved) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = onResolved; return; &#125; onResolved(value); &#125; // then æ³¨å†Œä¸€ä¸ªonResolvedæ–¹æ³•ï¼Œæ¥æ”¶ç»ˆå€¼ this.then = function (onResolved) &#123; handle(onResolved); &#125;; fn(resolve);&#125; è¿™æ®µä»£ç å·²ç»å®ç°äº†promiseçš„åŸºæœ¬åŠŸèƒ½ã€‚å³ä¾¿æ˜¯å¼‚æ­¥resolveä¹Ÿå¯ä»¥è·å–åˆ°ç»ˆå€¼ã€‚ 123456789var promise = new MyPromise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);promise.then((v) =&gt; &#123; console.log(v);&#125;); then è¿”å›æ–°çš„ promise thenæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseï¼Œå¹¶æ¥å—å‰ä¸€ä¸ªä¸Šä¸€ä¸ªçš„thenè¿”å›å€¼ä½œä¸ºå…¥å‚ã€‚ å¦‚æœä¸Šä¸€ä¸ªthenæ²¡æœ‰æ³¨å†Œresolvedæ–¹æ³•ï¼Œåˆ™é€ä¼ ä¹‹å‰çš„ç»ˆå€¼ã€‚ å¦‚æœä¸Šä¸€ä¸ªthenæœ‰æ³¨å†Œresolvedæ–¹æ³•ï¼Œæ‰§è¡Œï¼Œå¹¶å°†æ‰§è¡Œç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªthen æˆ‘ä»¬å…ˆçœ‹ä¸‹åŸç”Ÿçš„æ•ˆæœ 12345678910111213141516171819var p = new Promise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);// then è¿”å›æ–°çš„promiseã€‚å› ä¸ºå¯ä»¥é“¾å¼è°ƒç”¨thenã€‚// é“¾å¼çš„thenå¹¶éä¹‹å‰çš„promiseï¼Œè€Œæ˜¯æ–°çš„promisep.then() .then() .then((v) =&gt; &#123; console.log(v); // å‰2ä¸ªthenæ²¡æœ‰è·å–åˆ°ç»ˆå€¼ï¼Œé€ä¼ ç»ˆå€¼1 &#125;);p.then((v) =&gt; &#123; return v + 1;&#125;).then((v) =&gt; &#123; console.log(v); // 2&#125;); æ³¨æ„ï¼šä¸Šé¢ 2 ä¸ªè°ƒç”¨æœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œé€ä¼ çš„æœ‰ 3 ä¸ª thenï¼Œéç›´æ¥é€ä¼ çš„æœ‰ 2 ä¸ª thenï¼Œæ‰“å°ç»“æœï¼Œå…ˆ 2ï¼Œå 1ã€‚å› ä¸ºé€ä¼ çš„å¤šäº†ä¸€å±‚ then ç°åœ¨æˆ‘ä»¬æ¥æ”¹é€ MyPromise thenå¯èƒ½æ³¨å†Œäº†onResolvedï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œæ²¡æœ‰åˆ™éœ€è¦é€ä¼ ç»ˆå€¼ï¼Œè¦æ”¹çŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var deferred = null; // resolveçš„å·¥ä½œæ˜¯å°†çŠ¶æ€åˆ‡æ¢ä¸ºresolved function resolve(newV) &#123; state = &#x27;resolved&#x27;; value = newV; // æ”¹é€ 4ï¼šdeferredåœ¨æ”¹é€ 3ä¸­å·²ç»æ˜¯ä¸ªå¯¹è±¡äº†ï¼Œè¿™ä¸ªå¯¹è±¡å°±äº¤ç»™handleæ¥å¤„ç†å°±è¡Œäº† if (deferred) &#123; handle(deferred); &#125; &#125; // ç»Ÿä¸€è°ƒåº¦è°ƒç”¨onResolved // æ”¹é€ 3ï¼šæ¥æ”¶çš„æ˜¯ä¸ªå¯¹è±¡äº†ï¼Œæ‰€ä»¥è¦æ”¹ function handle(handler) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = handler; return; &#125; var handledValue = value; // å¦‚æœæœ‰ä¸Šä¸ªthenæ³¨å†Œçš„onResolvedæ–¹æ³•ï¼Œåˆ™è°ƒç”¨ï¼Œè·å–åˆ°å¤„ç†åçš„ç»ˆå€¼ if (handler.onResolved) &#123; handledValue = handler.onResolved(handledValue); &#125; // å°†å¤„ç†è¿‡æˆ–é»˜è®¤çš„ç»ˆå€¼ä¼ é€’ç»™èƒ½å¤Ÿç¡®å®šç»ˆå€¼å’ŒçŠ¶æ€çš„resolve handler.resolve(handledValue); &#125; // then æ³¨å†Œä¸€ä¸ªonResolvedæ–¹æ³•ï¼Œæ¥æ”¶ç»ˆå€¼ this.then = function (onResolved) &#123; // æ”¹é€ 1ï¼š è¿”å›ä¸€ä¸ªpromiseï¼Œpromiseæ¥æ”¶resolveå‡½æ•°ï¼Œç”¨äºæ”¹å˜è¿™ä¸ªè¿”å›çš„æ–°promiseçš„çŠ¶æ€ï¼Œå¹¶æ›´æ”¹å…¶ç»ˆå€¼ã€‚ return new MyPromise((resolve) =&gt; &#123; // æ”¹é€ 2ï¼šå¦‚æœonResolvedï¼ˆå‰ä¸€ä¸ªpromise.thenæ³¨å†Œçš„å¤„ç†ç»ˆå€¼çš„æ–¹æ³•ï¼‰å­˜åœ¨ï¼Œéœ€è¦è°ƒç”¨ï¼Œè·å–åˆ°å¤„ç†åçš„ç»ˆå€¼ç»™åˆ°è¿™ä¸ªæ–°çš„promiseã€‚å¦‚æœonResolvedæ²¡æœ‰ï¼Œéœ€è¦é€ä¼ ï¼Œé€ä¼ åˆ™è°ƒç”¨resolveè¿™ä¸ªæ–¹æ³•ï¼ˆå°±æ˜¯function resolveï¼‰æ–¹æ³•å•¦ï¼ // å› ä¸ºæˆ‘ä»¬æœ‰ä¸ªhandleæ–¹æ³•ç»Ÿä¸€è°ƒåº¦onResolvedæˆ–deferredã€‚æˆ‘ä»¬è¿˜æ˜¯äº¤ç»™å®ƒæ¥è°ƒåº¦ã€‚è¦æ”¹é€ ä¸‹handleäº†ã€‚ handle(&#123; onResolved, resolve, &#125;); &#125;); &#125;; fn(resolve);&#125; æˆ‘ä»¬æ¥è°ƒç”¨è¯•è¯•ã€‚ 123456789101112131415161718192021222324var p1 = new MyPromise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p1.then() .then() .then() .then((v) =&gt; &#123; console.log(v); // 1 &#125;);var p2 = new MyPromise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p2.then((v) =&gt; &#123; return v + 1;&#125;).then((v) =&gt; &#123; console.log(v); // 2&#125;); æ³¨æ„æ‰“å°é¡ºåºæ˜¯ 1ï¼Œ2ï¼Œå¹¶éåŸç”Ÿçš„ 2ï¼Œ1ã€‚å› ä¸ºæˆ‘ä»¬æ¨¡æ‹Ÿçš„å‡½æ•°é‡Œå¹¶æ²¡æœ‰è®© then å¼‚æ­¥å¤„ç†ï¼Œè€Œæ˜¯åŒæ­¥çš„ã€‚ å¦‚æœ then è¿”å›çš„æ˜¯ promiseä¸Šé¢çš„é“¾å¼è°ƒç”¨ï¼Œåªå¤„ç†äº†æ™®é€šçš„ç»ˆå€¼ï¼Œå¦‚æœç»ˆå€¼æœ¬èº«å°±æ˜¯promiseçš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨thenä¸­å¯¹ç»ˆå€¼åœ¨è¿›è¡Œthençš„å†™æ³•ï¼ŒåµŒå¥—ä¼šè¶Šæ¥è¶Šæ·±ã€‚å¦‚ï¼š 1234567p.then(promise1 =&gt; &#123; promise1.then(promise2 =&gt; &#123; promise2.then(promise3 =&gt; &#123; promise3.then(...) &#125;) &#125;)&#125;) çœ‹çœ‹åŸç”Ÿæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚ 12345678910111213141516171819var time = [];var p = new Promise((resolve) =&gt; &#123; time.push(Date.now()); setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p.then( () =&gt; new Promise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(2); &#125;, 2000); &#125;)).then((v) =&gt; &#123; time.push(Date.now()); console.log(v, time[1] - time[0]); // 2 3000&#125;); åŸç”Ÿçš„ promise.thenè¿”å›çš„å¦‚æœæ˜¯æ–°çš„promiseï¼Œåˆ™åç»­çš„é“¾éƒ½æ˜¯ä»¥è¿™ä¸ªæ–°çš„promiseçš„resolvedåçš„ç»ˆå€¼æ¥ä¼ é€’äº†ï¼Œè·Ÿæœ€å¼€å§‹çš„æ—§promiseæ— å…³äº†ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å¯¹thenè¿”å›çš„æ˜¯promiseåšä¸ªåˆ¤æ–­å¤„ç†ï¼Œå¦‚æœthenè¿”å›çš„æ˜¯ä¸€ä¸ªpromiseï¼Œç­‰å¾…å…¶resolvedåï¼Œä¼ é€’å®ƒçš„ç»ˆå€¼ã€‚ å› ä¸ºæ— è®ºæœ‰æ²¡æœ‰ä¸Šä¸€ä¸ªpromiseæ³¨å†Œçš„onResolvedæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°resolveæ¥ç¡®å®šæ–°promiseçš„çŠ¶æ€å’Œç»ˆå€¼ï¼Œæˆ‘ä»¬å°±åœ¨resolveåšåˆ¤æ–­å¤„ç†å°±å¥½äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var deferred = null; // resolveçš„å·¥ä½œæ˜¯å°†çŠ¶æ€åˆ‡æ¢ä¸ºresolved function resolve(newV) &#123; // æ”¹é€ 5ï¼šå¦‚æœæ¥æ”¶åˆ°çš„ç»ˆå€¼æ˜¯ä¸€ä¸ªpromiseï¼Œåˆ™è°ƒç”¨å…¶thenæ–¹æ³•ï¼Œç»ˆæ­¢æ—§çš„promiseï¼Œå¼€å¯åŸºäºè¿”å›çš„æ–°çš„promiseè¿›è¡Œä¼ é€’ if (newV &amp;&amp; typeof newV.then === &#x27;function&#x27;) &#123; newV.then(resolve); return; &#125; state = &#x27;resolved&#x27;; value = newV; // æ”¹é€ 4ï¼šdeferredåœ¨æ”¹é€ 3ä¸­å·²ç»æ˜¯ä¸ªå¯¹è±¡äº†ï¼Œè¿™ä¸ªå¯¹è±¡å°±äº¤ç»™handleæ¥å¤„ç†å°±è¡Œäº† if (deferred) &#123; handle(deferred); &#125; &#125; // ç»Ÿä¸€è°ƒåº¦è°ƒç”¨onResolved // æ”¹é€ 3ï¼šæ¥æ”¶çš„æ˜¯ä¸ªå¯¹è±¡äº†ï¼Œæ‰€ä»¥è¦æ”¹ function handle(handler) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = handler; return; &#125; var handledValue = value; // å¦‚æœæœ‰ä¸Šä¸ªthenæ³¨å†Œçš„onResolvedæ–¹æ³•ï¼Œåˆ™è°ƒç”¨ï¼Œè·å–åˆ°å¤„ç†åçš„ç»ˆå€¼ if (handler.onResolved) &#123; handledValue = handler.onResolved(handledValue); &#125; // å°†å¤„ç†è¿‡æˆ–é»˜è®¤çš„ç»ˆå€¼ä¼ é€’ç»™èƒ½å¤Ÿç¡®å®šç»ˆå€¼å’ŒçŠ¶æ€çš„resolve handler.resolve(handledValue); &#125; // then æ³¨å†Œä¸€ä¸ªonResolvedæ–¹æ³•ï¼Œæ¥æ”¶ç»ˆå€¼ this.then = function (onResolved) &#123; // æ”¹é€ 1ï¼š è¿”å›ä¸€ä¸ªpromiseï¼Œpromiseæ¥æ”¶resolveå‡½æ•°ï¼Œç”¨äºæ”¹å˜è¿™ä¸ªè¿”å›çš„æ–°promiseçš„çŠ¶æ€ï¼Œå¹¶æ›´æ”¹å…¶ç»ˆå€¼ã€‚ return new MyPromise((resolve) =&gt; &#123; // æ”¹é€ 2ï¼šå¦‚æœonResolvedï¼ˆå‰ä¸€ä¸ªpromise.thenæ³¨å†Œçš„å¤„ç†ç»ˆå€¼çš„æ–¹æ³•ï¼‰å­˜åœ¨ï¼Œéœ€è¦è°ƒç”¨ï¼Œè·å–åˆ°å¤„ç†åçš„ç»ˆå€¼ç»™åˆ°è¿™ä¸ªæ–°çš„promiseã€‚å¦‚æœonResolvedæ²¡æœ‰ï¼Œéœ€è¦é€ä¼ ï¼Œé€ä¼ åˆ™è°ƒç”¨resolveè¿™ä¸ªæ–¹æ³•ï¼ˆå°±æ˜¯function resolveï¼‰æ–¹æ³•å•¦ï¼ // å› ä¸ºæˆ‘ä»¬æœ‰ä¸ªhandleæ–¹æ³•ç»Ÿä¸€è°ƒåº¦onResolvedæˆ–deferredã€‚æˆ‘ä»¬è¿˜æ˜¯äº¤ç»™å®ƒæ¥è°ƒåº¦ã€‚è¦æ”¹é€ ä¸‹handleäº†ã€‚ handle(&#123; onResolved, resolve, &#125;); &#125;); &#125;; fn(resolve);&#125; æµ‹è¯•çœ‹çœ‹ 12345678910111213141516171819var time = [];var p = new MyPromise((resolve) =&gt; &#123; time.push(Date.now()); setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p.then( () =&gt; new MyPromise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(2); &#125;, 2000); &#125;)).then((v) =&gt; &#123; time.push(Date.now()); console.log(v, time[1] - time[0]); // 2 3009&#125;); å¤„ç†é”™è¯¯promiseçš„å¼‚å¸¸å¤„ç†rejectedï¼Œæˆ‘ä»¬æ¥åŠ ä¸Šã€‚ å…ˆçœ‹åŸç”Ÿçš„ç”¨æ³• 123456789101112var p = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; reject(new Error(&#x27;is a error&#x27;)); &#125;);&#125;);p.then( (v) =&gt; &#123;&#125;, (err) =&gt; &#123; console.log(err); // æ•è·å¼‚å¸¸æ‰“å° &#125;); æˆ‘ä»¬çœ‹åˆ°ï¼Œåˆå§‹åŒ–æ—¶åŠ å…¥äº†rejectå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªErrorç±»å‹çš„å€¼ã€‚åœ¨thenä¸­ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ¥æ¥æ”¶è¯¥é”™è¯¯ï¼Œå¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var deferred = null; function resolve(newV) &#123; if (newV &amp;&amp; typeof newV.then === &#x27;function&#x27;) &#123; newV.then(resolve); return; &#125; state = &#x27;resolved&#x27;; value = newV; if (deferred) &#123; handle(deferred); &#125; &#125; // æ”¹é€ 1ï¼šå¢åŠ rejectå‡½æ•°ï¼Œå°†çŠ¶æ€å˜ä¸º rejectedã€‚ function reject(err) &#123; state = &#x27;rejected&#x27;; value = err; if (deferred) &#123; handle(deferred); &#125; &#125; function handle(handler) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = handler; return; &#125; var handledValue = value; // æ”¹é€ 6ï¼šhandleræ¯”ä¹‹å‰å¤šäº†onRejectedå’Œrejectï¼Œæ ¹æ®stateçŠ¶æ€è°ƒç”¨å¯¹åº”çš„thenå¤„ç†å‡½æ•° var handleCallback; if (state === &#x27;resolved&#x27;) &#123; handleCallback = handler.onResolved; &#125; else if (state === &#x27;rejected&#x27;) &#123; handleCallback = handler.onRejected; &#125; if (handleCallback) &#123; handledValue = handleCallback(handledValue); &#125; handler.resolve(handledValue); &#125; // æ”¹é€ 4ï¼šthenæ–¹æ³•æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°å¤„ç†error this.then = function (onResolved, onRejected) &#123; return new MyPromise((resolve) =&gt; &#123; handle(&#123; onResolved, resolve, // æ”¹é€ 5ï¼šå°†ä¸Šä¸€ä¸ªå¤„ç†å¼‚å¸¸çš„onRejectedå’Œå½“å‰rejectäº¤ç»™handleæ¥ç»Ÿä¸€è°ƒåº¦ onRejected, reject, &#125;); &#125;); &#125;; //æ”¹é€ 3ï¼šæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°reject fn(resolve, reject);&#125; æµ‹è¯•ä¸‹ 1234567891011121314var p = new MyPromise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; reject(new Error(&#x27;hello&#x27;)); &#125;, 1000);&#125;);p.then( (v) =&gt; &#123; console.log(&#x27;succ&#x27;, v); &#125;, (err) =&gt; &#123; console.log(&#x27;fail&#x27;, err); // fail Error: hello &#125;); promise.catchå¹³æ—¶æ•è·å¼‚å¸¸ç”¨çš„æœ€å¤šçš„åº”è¯¥è¿˜æ˜¯promise.catchã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹åŸç”Ÿçš„ç”¨æ³• 12345678910111213141516// å·²çŸ¥é”™è¯¯var p = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; reject(&#x27;123&#x27;); &#125;, 1000);&#125;);p.then().catch((err) =&gt; &#123; console.log(err); // 123&#125;);// æœªçŸ¥é”™è¯¯ï¼Œé€šå¸¸åœ¨resolveæ‰§è¡Œä¸­ï¼Œæˆ–thençš„onResolvedå‡ºé”™ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ•è·ã€‚var p2 = new Promise((resolve) =&gt; &#123; resolve(a);&#125;); å°è¯•å®ç°ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; // æ”¹é€ 5ï¼šæ ‡å¿—ç¬¦ï¼Œç”¨æ¥æ§åˆ¶å®ä¾‹åŒ–promiseæ—¶æœ‰æ— æ³¨å†Œcatchæ¥æ§åˆ¶æŠ›é”™è¿˜æ˜¯ç”¨catch(å®é™…ä¸Šå°±æ˜¯thenä¸­çš„onResovled)å¤„ç† var catcher = null; var deferred = null; function resolve(newV) &#123; // æ”¹é€ 1ï¼šæ•è·resolveå¯èƒ½å‡ºç°çš„é—®é¢˜ try &#123; if (newV &amp;&amp; typeof newV.then === &#x27;function&#x27;) &#123; newV.then(resolve); return; &#125; state = &#x27;resolved&#x27;; value = newV; if (deferred) &#123; handle(deferred); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125; function reject(err) &#123; state = &#x27;rejected&#x27;; value = err; if (deferred) &#123; handle(deferred); &#125; else &#123; setTimeout(() =&gt; &#123; if (!catcher) &#123; throw value; &#125; &#125;, 0); &#125; &#125; function handle(handler) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = handler; return; &#125; // æ”¹é€ 3ï¼šå› ä¸ºpromiseæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€æœ‰æ“ä½œéœ€è¦å¼‚æ­¥å¤„ç† var handledValue = value; var handleCallback; // æ”¹é€ 2ï¼šæ•è·handleä¼ å…¥çš„å¤„ç†å‡½æ•°æ—¶å¯èƒ½å‡ºç°çš„é—®é¢˜ try &#123; if (state === &#x27;resolved&#x27;) &#123; handleCallback = handler.onResolved; &#125; else if (state === &#x27;rejected&#x27;) &#123; handleCallback = handler.onRejected; &#125; if (handleCallback) &#123; handledValue = handleCallback(handledValue); &#125; &#125; catch (err) &#123; handler.reject(err); &#125; handler.resolve(handledValue); &#125; this.then = function (onResolved, onRejected) &#123; return new MyPromise((resolve) =&gt; &#123; handle(&#123; onResolved, resolve, onRejected, reject, &#125;); &#125;); &#125;; // catchæ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªpromiseï¼Œå®é™…ä¸Šå°±ç­‰äºthenæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¼ ï¼Œç¬¬äºŒä¸ªå‚æ•°å¤„ç†err this.catch = function (fn) &#123; // å¦‚æœæ³¨å†Œäº†catchï¼Œåˆ™å¼‚å¸¸äº¤ç»™catchæ¥åš catcher = true; // æ³¨å†Œcatch this.then(null, fn); &#125;; // æ”¹é€ 4ï¼šåˆå§‹åŒ–promiseæ—¶ä¹Ÿå¯èƒ½å‡ºé”™ï¼Œè‹¥å‡ºé”™ï¼Œç›´æ¥è°ƒç”¨reject try &#123; fn(resolve, reject); &#125; catch (err) &#123; reject(err); &#125;&#125; promise éœ€è¦å¼‚æ­¥PromiseA+è§„èŒƒè¦æ±‚è§£å†³ç¨‹åºï¼Œä¹Ÿå°±æ˜¯ resolve å’Œ reject çš„æ‰§è¡Œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹handleå‡½æ•°åšå¼‚æ­¥è°ƒç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨setTimeoutæ¨¡æ‹Ÿã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687function MyPromise(fn) &#123; var state = &#x27;pedding&#x27;; var value; var catcher = null; var deferred = null; function resolve(newV) &#123; try &#123; if (newV &amp;&amp; typeof newV.then === &#x27;function&#x27;) &#123; newV.then(resolve); return; &#125; state = &#x27;resolved&#x27;; value = newV; if (deferred) &#123; handle(deferred); &#125; &#125; catch (err) &#123; reject(err); &#125; &#125; function reject(err) &#123; state = &#x27;rejected&#x27;; value = err; if (deferred) &#123; handle(deferred); &#125; else &#123; setTimeout(() =&gt; &#123; if (!catcher) &#123; throw value; &#125; &#125;, 0); &#125; &#125; function handle(handler) &#123; if (state === &#x27;pedding&#x27;) &#123; deferred = handler; return; &#125; // æ”¹é€ ï¼šå› ä¸ºpromiseæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€æœ‰æ“ä½œéœ€è¦å¼‚æ­¥å¤„ç† setTimeout(() =&gt; &#123; var handledValue = value; var handleCallback; try &#123; if (state === &#x27;resolved&#x27;) &#123; handleCallback = handler.onResolved; &#125; else if (state === &#x27;rejected&#x27;) &#123; handleCallback = handler.onRejected; &#125; if (handleCallback) &#123; handledValue = handleCallback(handledValue); &#125; &#125; catch (err) &#123; handler.reject(err); &#125; handler.resolve(handledValue); &#125;, 0); &#125; this.then = function (onResolved, onRejected) &#123; return new MyPromise((resolve) =&gt; &#123; handle(&#123; onResolved, resolve, onRejected, reject, &#125;); &#125;); &#125;; this.catch = function (fn) &#123; catcher = true; this.then(null, fn); &#125;; try &#123; fn(resolve, reject); &#125; catch (err) &#123; reject(err); &#125;&#125; Promise.all æ–¹æ³• æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æˆå‘˜éƒ½æ˜¯promiseã€‚ æ•°ç»„ä¸­æ‰€æœ‰çš„promiseéƒ½resolvedï¼Œæ•´ä½“æ‰èƒ½resolveï¼Œå¦åˆ™rejectæ‰ç¬¬ä¸€ä¸ªå‡ºé”™çš„æ•°ç»„æˆå‘˜promiseã€‚ è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„promiseï¼Œç»ˆå€¼æ˜¯æ‰€æœ‰æ•°ç»„æˆå‘˜çš„ç»ˆå€¼æ„æˆçš„æ•°ç»„ã€‚ 123456789101112131415MyPromise.all = function (arr) &#123; var resArr = []; return new MyPromise((resolve, reject) =&gt; &#123; for (let i = 0; i &lt; arr.length; i++) &#123; arr[i] .then((r) =&gt; &#123; resArr.push(r); &#125;) .catch((err) =&gt; &#123; reject(err); &#125;); &#125; resolve(resArr); &#125;);&#125;; æ€»ç»“è¿™ä¸ªç‰ˆæœ¬çš„å®ç°è™½ç„¶å¯ä»¥è¾¾åˆ°promiseåŸºæœ¬çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ€è·¯æœ‰ç‚¹ç»•ã€‚ è€Œä¸”æœ‰ä¸ªbugï¼Œæœªå®ç°catchå’ŒonRejectedå‡½æ•°çš„è¯ï¼Œä¸ä¼šæŠ›é”™ï¼Œå†…éƒ¨é€»è¾‘é‡Œhandleå‡½æ•°åˆ¤æ–­å·²ç»rejectäº†ï¼Œä¸åœ¨ä¼šè®¾ç½®deferredï¼Œå¯¼è‡´é™é»˜æŠ¥é”™äº†ã€‚","categories":[],"tags":[]},{"title":"æ¢ç©¶JSåŸå‹","slug":"2020/æ¢ç©¶åŸå‹","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:35:54.647Z","comments":true,"path":"2020/12/30/2020/æ¢ç©¶åŸå‹/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E6%8E%A2%E7%A9%B6%E5%8E%9F%E5%9E%8B/","excerpt":"","text":"è¯¦ç»†åˆ†æåŸå‹å¯¹è±¡çš„æ„æˆå’Œä½œç”¨ï¼Œç†æ¸…prototypeï¼Œ__proto__ç›¸å…³çš„å…³ç³»ã€‚ prototypeåŸå‹æ˜¯ JS è¯ç”Ÿå°±æœ‰çš„ï¼Œ ä½†æ˜¯åŸå‹çš„è®¿é—®æ–¹å¼ï¼Œåœ¨â€œè¿œå¤â€æ—¶ä»£ï¼Œå”¯ä¸€å¯é çš„æ–¹æ³•å°±æ˜¯é€šè¿‡æ„é€ å‡½æ•°çš„prototypeå±æ€§æ¥è·å–å’Œè®¾ç½®åŸå‹å¯¹è±¡ã€‚ ä¸æ˜¯åŸå‹ï¼Œåªæ˜¯æ™®é€šå±æ€§å‡½æ•°åˆ›å»ºæ—¶ï¼Œé»˜è®¤ä¼šæœ‰ä¸€ä¸ªåä¸ºprototypeçš„å¸¸è§„æ™®é€šå±æ€§ï¼Œè¿™ä¸ªå±æ€§åªæœ‰åœ¨ å‡½æ•°å½“åšæ„é€ å‡½æ•°ï¼Œä¸”é€šè¿‡newåˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶æ‰æœ‰ç”¨ã€‚ new F()è°ƒç”¨æ—¶ï¼Œå¦‚æœæœ‰F.prototypeï¼Œåˆ™ä¼šå°†F.prototypeä½œä¸ºå®ä¾‹å¯¹è±¡çš„[[Prototype]]ã€‚ 12345function Parent() &#123;&#125;var person = new Parent();person.__proto__ === Parent.prototype; // true ä½†å¦‚æœä¹‹åä¿®æ”¹äº†F.prototype = other Objectï¼Œåˆ™åç»­new F()æ‰€åˆ›å»ºçš„å®ä¾‹å¯¹è±¡åˆ™ä¼šä½¿ç”¨æ–°çš„å¯¹è±¡æ¥ä½œä¸º[[Prototype]]ï¼ŒåŸæœ¬å·²ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡çš„åŸå‹è¿˜ä¼šä¿ç•™æ—§å€¼ã€‚ 12345function Parent() &#123;&#125;var person1 = new Parent();Parent.prototype = &#123;&#125;;var person2 = new Parent();person1.__proto__ === person2.__proto__; // false è‡³äºä¸ºä»€ä¹ˆè¯´prototypeä¸æ˜¯åŸå‹ï¼Œè€Œåªæ˜¯æ™®é€šå±æ€§ï¼Œé‚£æ˜¯å› ä¸ºä¸ä½œä¸ºnew F()ä½¿ç”¨çš„è¯ï¼Œå®ƒçœŸçš„ä¸æ™®é€šå±æ€§æ— å·®å¼‚ï¼Œæ²¡æœ‰ä»»ä½•é­”æ³•ã€‚ 1234var parent = &#123; prototype: &#x27;æ™®é€šå±æ€§&#x27;,&#125;;parent.prototype; // æ™®é€šå±æ€§ F.prototype çš„æ„æˆæ‰€æœ‰å‡½æ•°åˆ›å»ºæ—¶å…·æœ‰ä¸€ä¸ªé»˜è®¤çš„prototypeå±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘çš„å¯¹è±¡é‡Œåªæœ‰ä¸€ä¸ªæ„é€ å™¨å±æ€§constructorã€‚ constructorè¯¥å±æ€§æŒ‡å‘æ„é€ å‡½æ•°æœ¬èº«ã€‚ 12function Parent() &#123;&#125;Parent.prototype.constructor === Parent; // true å¦‚æœä¸å»æ”¹å˜prototypeï¼Œé€šè¿‡æ„é€ å‡½æ•°ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨constructorï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¯¥å®ä¾‹å±äºå“ªä¸ªç±»ï¼ˆç”±å“ªä¸ªæ„é€ å™¨ç”Ÿæˆï¼‰ 123function Parent() &#123;&#125;var person = new Parent();person.constructor === Parent; // true ä½†constructoræœ¬èº«å¹¶ä¸å¯é ï¼Œå› ä¸ºprototypeå¯ä»¥éšæ„æ›´æ”¹ï¼Œå¯¼è‡´æ— æ³•åˆ¤æ–­å®ä¾‹å¯¹è±¡åˆ°åº•æ˜¯ç”±è°å®ç°ã€‚ 1234function Parent() &#123;&#125;Parent.prototype = &#123;&#125;;var person = new Parent();person.constructor === Parent(); // false è‡ªå®šä¹‰å±æ€§ã€æ–¹æ³•å¦‚ä¸Šæ‰€è¯´ï¼Œé»˜è®¤çš„prototypeå±æ€§æ‰€æŒ‡çš„å¯¹è±¡ï¼Œåªæœ‰ä¸€ä¸ªconstructorã€‚å› æ­¤æˆ‘ä»¬ä¼šå¯¹prototpyeè¿›è¡Œæ‰©å±•ï¼Œå½“é€šè¿‡new F()åˆ›å»ºå®ä¾‹æ—¶ï¼Œå®ä¾‹å°†ä¼šè·å¾—ï¼ˆåŸå‹ç»§æ‰¿ï¼‰æˆ‘ä»¬æ‰©å±•çš„æ–¹æ³•ï¼Œå±æ€§ç­‰ç­‰ï¼Œè¿™æ˜¯prototypeæœ€é‡è¦çš„ä½œç”¨ã€‚ 123456function Parent() &#123;&#125;Parent.prototype.run = function () &#123; console.log(&#x27;run&#x27;);&#125;;var parent = new Parent();parent.run(); // run __proto__ ã€setPrototypeOfã€getPrototypeOfå‰ä¸€ç¯‡æ–‡ç« ä»‹ç»è¿‡ï¼Œ__proto__æ˜¯æµè§ˆå™¨è‡ªå·±å®ç°çš„è®¿é—®å’Œä¿®æ”¹åŸå‹çš„è®¿é—®å™¨å±æ€§ï¼Œè€ŒsetPrototypeOfå’ŒgetPrototypeOfæ˜¯æ ‡å‡†ä¸­åˆ¶å®šçš„æ–¹æ³•ï¼Œä»–ä»¬çš„æ•ˆæœä¸€æ ·ã€‚ 12345var a = &#123;&#125;;a.__proto__;function b() &#123;&#125;b.__proto__; å¯ä»¥çœ‹åˆ° a å¯¹è±¡å’Œ b å‡½æ•°çš„åŸå‹ä¸å¤ªä¸€æ ·ã€‚ æ™®é€šå­—é¢é‡å¯¹è±¡çš„åŸå‹å­—é¢é‡å¯¹è±¡å®é™…ä¸Šæ˜¯ç”± JS å¼•æ“è°ƒç”¨åŸç”Ÿæ„é€ å‡½æ•°Objectæ¥ç”Ÿæˆçš„ã€‚ 12345678910var a = &#123;&#125;; // ç›¸å½“äº var a = new Object();// é€šè¿‡new Objectï¼Œå› æ­¤Object.prototype åˆ†é…ç»™äº†å®ä¾‹ a çš„[[Prototype]]a.__proto__ === Object.prototype; // true// aå®ä¾‹ç”±Objectå‡½æ•°æ„é€ ç”Ÿæˆï¼Œæ‰€ä»¥å…¶constructor å°±æ˜¯ Objecta.constructor === Object; // true// Object.prototypeé™¤äº†constructorå¤–è¿˜æœ‰è®¸å¤šæ–¹æ³•ï¼Œæ¯”å¦‚toStringï¼Œå› æ­¤aå¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼ˆaä¸Šä¸å­˜åœ¨ï¼Œé¡ºç€åŸå‹æŸ¥æ‰¾ï¼‰a.toString(); // [object Object] å‡½æ•°çš„åŸå‹å½“æ‰“å°å‡½æ•°çš„åŸå‹ï¼Œå‘æ˜¯ä¸€ä¸ªåŸç”Ÿçš„å‡½æ•°æ–¹æ³•â€“!ã€‚ 12function b() &#123;&#125;b.__proto__; // f() &#123; [native code] &#125; ä¸è¦æ…Œï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ™®é€šå­—é¢é‡çš„æ–¹å¼çŒœæƒ³ï¼Œb å‡½æ•°è¿™ç§å†™æ³•ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨äº†å†…å»ºFunctionæ¥åˆ›å»ºçš„ã€‚æ¯”å¦‚new Function()ï¼Œæ‰€ä»¥ b å‡½æ•°æ˜¯å†…å»ºFunctionçš„å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡º b å‡½æ•°çš„åŸå‹ç»§æ‰¿äº†Function.prototype 12345function b() &#123;&#125;b.__proto__ === Function.prototype; // true ç»“æœè¯æ˜æ˜¯å¯¹çš„// å› æ­¤æˆ‘ä»¬çš„bå‡½æ•°å¯ä»¥ä½¿ç”¨ Function.prototypeä¸Šçš„æ–¹æ³•ï¼Œå¸¸è§çš„å¦‚å‡½æ•°çš„apply,call,bindç­‰ç­‰ã€‚Function.prototype.apply; // f() &#123; [native code] &#125; è¿™ä¹Ÿä½è¯äº†ä¸Šé¢æ‰€æåˆ°çš„ï¼Œprototypeå¹¶ä¸æ˜¯åŸå‹å¯¹è±¡æœ¬èº«ã€‚ 12function b() &#123;&#125;b.prototype === b.__proto__; // false æ˜¯çš„ï¼Œb.prototypeçœŸçš„å°±åªæ˜¯ä¸€ä¸ªæ™®æ™®é€šé€šï¼Œç®€ç®€å•å•çš„å¸¸è§„å±æ€§è€Œå·²ï¼Œå®ƒè·Ÿ__proto__æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªä¸è¿‡protoypeæœ‰é»˜è®¤çš„å¯¹è±¡å€¼&#123;constructor: f b() &#123;&#125;&#125; é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å»æ‹“å±•b.prototypeå‘¢ï¼Ÿå®ƒæ ¹æœ¬ä¸æ˜¯åŸå‹ï¼Œæ‰©å±•çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æ²¡é”™ï¼Œ**protototypeä¸æ˜¯åŸå‹ï¼Œä½†æ˜¯å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥ä½œä¸ºå®ä¾‹çš„åŸå‹ã€‚å½“ä½ é€šè¿‡new b()å½¢å¼åˆ›å»ºå‡ºä¸€ä¸ªå®ä¾‹å¯¹è±¡æ—¶ï¼Œb.prototypeè¢«ä½œä¸ºå®ä¾‹å¯¹è±¡çš„[[Prototype]]å•¦ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å¾€prototypeä¸Šå»æ‰©å±•çš„åŸå› ï¼Œä»å®ä¾‹çš„è§’åº¦æ¥çœ‹ï¼Œprototypeåˆæ˜¯åŸå‹**ï¼Œå¦‚ä¸‹è¯æ˜ï¼š 123function Parent() &#123;&#125;var parent = new Parent();parent.__proto__ === Parent.prototype; // true æ€»ç»“ æ—©æœŸï¼Œè®¿é—®åŸå‹å¯¹è±¡çš„æ–¹æ³•ï¼Œæ˜¯é€šè¿‡F.prototypeï¼Œåªæœ‰å‡½æ•°æ‰æœ‰è¿™ä¸ªå±æ€§ã€‚åæœŸæµè§ˆå™¨å‚å•†å®ç°äº†__proto__è®¿é—®å™¨ï¼Œä»¥åŠ ES æ ‡å‡†setPrototypeOfå’ŒgetPrototypeOfã€‚ å‡½æ•°åˆ›å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨å¸¦æœ‰prototypeå±æ€§ï¼Œå±æ€§å€¼æ˜¯ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«construnctorï¼ŒconstructoræŒ‡å‘äº†å‡½æ•°æœ¬èº«ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­å®ä¾‹ç”±è°æ„é€ ç”Ÿæˆï¼Œä½†å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºprototypeå¯ä»¥è¢«æ›´æ”¹ã€‚ç¨³å¦¥çš„åšæ³•æ˜¯ï¼Œä¸è¦é‡å†™prototypeå¯¹è±¡ï¼Œè€Œåªæ˜¯åœ¨å…¶ä¸Šå¢åŠ å±æ€§å’Œæ–¹æ³•ã€‚ F.prototypeåªæ˜¯ä¸€ä¸ªå¸¸è§„å±æ€§ï¼Œå¹¶æ— é­”æ³•ã€‚åªæœ‰åœ¨é€šè¿‡new F()æ¥åˆ›å»ºå®ä¾‹æ—¶æ‰æœ‰ç”¨ï¼ŒF.prototypeä¼šè¢«ç”¨ä½œåˆ›å»ºå®ä¾‹çš„[[Prototype]]ã€‚ å­—é¢é‡å¯¹è±¡çš„åŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå‡½æ•°çš„åŸå‹æ˜¯ä¸€ä¸ªå†…å»ºå‡½æ•°ã€‚è€Œä¸”å‡½æ•°çš„åŸå‹å¹¶ä¸ç­‰äºF.prototypeï¼Œä¾§é¢è¯æ˜äº†prototypeåªæ˜¯ä¸€ä¸ªæ™®é€šå±æ€§ã€‚ ä»ç”Ÿæˆçš„å®ä¾‹çš„è§’åº¦å»çœ‹æ„é€ å‡½æ•°çš„prototypeï¼Œå®ƒåˆæ˜¯åŸå‹å¯¹è±¡ã€‚","categories":[],"tags":[]},{"title":"æ¢ç©¶JSç»§æ‰¿","slug":"2020/æ¢ç©¶ç»§æ‰¿","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:35:44.757Z","comments":true,"path":"2020/12/30/2020/æ¢ç©¶ç»§æ‰¿/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E6%8E%A2%E7%A9%B6%E7%BB%A7%E6%89%BF/","excerpt":"","text":"JS ä¸–ç•Œçš„ç»§æ‰¿å¦‚ä½•å®ç°ï¼ŒåŸå‹åœ¨ç»§æ‰¿ä¸­çš„ä½œç”¨ï¼Œä»¥å‰çš„ç»§æ‰¿å’Œç°åœ¨çš„ç»§æ‰¿ã€‚ åŸå‹æŸ¥æ‰¾æœºåˆ¶JS ä¸­ç»§æ‰¿ä¾èµ–åŸå‹å®ç°ï¼Œè®¿é—®ä¸€ä¸ªå®ä¾‹ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œä¼šå»å®ä¾‹çš„åŸå‹å¯¹è±¡ä¸ŠæŸ¥æ‰¾ã€‚ 1234function Parent() &#123;&#125;Parent.prototype.run = true;var person = new Parent();person.run; // true å¦‚æœå®ä¾‹åŸå‹ä¸Šä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»å®ä¾‹åŸå‹çš„åŸå‹ä¸ŠæŸ¥æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ç›´åˆ°åŸå‹é¡¶ç«¯ï¼Œä¹Ÿå°±æ˜¯ nullã€‚ 123var a = &#123;&#125;;a.__proto__; // Object.prototypea.__proto__.__proto__; // ä¹Ÿå°±æ˜¯ Object.prototype.__proto__ = null JS ä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼Œå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬çœ‹çœ‹å‡½æ•°çš„åŸå‹é“¾ï¼ˆåŸå‹-åŸå‹-åŸå‹-â€¦è¿™ç§é“¾å¼ï¼Œè¢«ç§°ä¸ºåŸå‹é“¾ï¼‰ 1234function b() &#123;&#125;b.__proto__ === Function.prototype; // true f () &#123; [native code] &#125; ä¹Ÿå°±æ˜¯ Function.prototypeb.__proto__.__proto__ === Object.prototype; // true ä¹Ÿå°±æ˜¯Function.prototype.__proto__ï¼Œåˆ«å¿˜äº†Function.prototypeä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å…¶åŸå‹æ˜¯ Object.prototypeã€‚è¿™ä¹Ÿè¯´æ˜äº†ï¼ŒJSä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼b.__proto__.__proto__.__proto__ === null; // true Object.prototype.__proto__ === null åˆ°å¤´äº† é…åˆ JS åŸå‹é“¾æŸ¥æ‰¾æœºåˆ¶ï¼Œå› æ­¤å‡ºç°äº† JS ç‰ˆæœ¬çš„ç»§æ‰¿ã€‚ new å®ä¾‹åŒ–JS ä¸­é€šè¿‡æ„é€ å‡½æ•°æ¥æ¨¡æ‹Ÿç±»ï¼Œé€šè¿‡prototypeæ¥æ¨¡æ‹Ÿç»§æ‰¿ã€‚ç±»çš„å®ä¾‹åŒ–åˆ™éœ€è¦ç”¨newå…³é”®å­—ï¼Œnew F()ã€‚æˆ‘ä»¬çœ‹çœ‹newåšäº†äº›ä»€ä¹ˆï¼š 12function Person() &#123;&#125;var a = new Person(); ç›®å‰æˆ‘ä»¬å°±çœ‹åˆ°newåšäº†ä¸‰ä»¶äº‹ï¼š åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ è¿”å›äº†è¯¥å¯¹è±¡**èµ‹å€¼ç»™äº†aå˜é‡ã€‚ å¹¶ä¸” a å®ä¾‹çš„[[Prototype]]å…³è”åˆ°äº†Person.prototypeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ a.xx è®¿é—®åˆ°Person.prototypeçš„æ–¹æ³•å’Œå±æ€§ï¼Œè¿˜è®°å¾—å§ï¼ å› ä¸ºæ„é€ å‡½æ•°æ¨¡æ‹Ÿäº†ç±»ï¼Œç±»æ˜¯å¯ä»¥æœ‰å±æ€§å’Œæ–¹æ³•çš„ï¼Œæˆ‘ä»¬æ¥ç»™ä¸Šé¢çš„Personç±»åŠ ç‚¹æ–™ 123456789101112131415function Person(name) &#123; this.name = name; // ç±»å±æ€§ this.sayHi = function () &#123; // ç±»æ–¹æ³• console.log(`Hi $&#123;this.name&#125;`); &#125;;&#125;var a = new Person(&#x27;Jack&#x27;);a.name; // Jacka.sayHi(); // Hi Jackvar b = new Person(&#x27;Loose&#x27;);b.name; // Looseb.sayHi(); // Hi Loose å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡Personç±»ï¼Œæˆ‘ä»¬å£°æ˜äº† 2 ä¸ªå®ä¾‹ a å’Œ bï¼Œåˆ†åˆ«è®¿é—® name å’Œ sayHi æ–¹æ³•ï¼Œä½¿ç”¨äº†å®ä¾‹è‡ªå·±çš„ name å€¼ï¼Œæ‰€ä»¥Personç±»åœ¨å®ä¾‹åŒ–æ—¶ï¼Œé‡Œé¢çš„ this æŒ‡å‘äº†å®ä¾‹å¯¹è±¡ã€‚ æ‰€ä»¥newä¸€å…±åšäº†å››ä»¶äº‹ã€‚ å®ä¾‹åŒ–æ—¶å°† this æŒ‡å‘æ–°çš„å¯¹è±¡ã€‚ æ¨¡æ‹Ÿå®ç°ä¸€ä¸ªç®€å•çš„new 1234567// function myNew(Constructor, Params) : objectfunction myNew(fn) &#123; var obj = &#123;&#125;; obj.__proto__ = fn.prototype; // æˆ–è€… var obj = Object.create(fn.prototype) var result = fn.apply(obj, [].slice.call(arguments, 1)); // è°ƒç”¨æ„é€ å‡½æ•°fnï¼Œå¹¶ä¸”æ³¨æ„ç»‘å®šthisåˆ°æ–°å¯¹è±¡ï¼Œè¿™é‡Œå°±æ˜¯objã€‚ç»™æ„é€ å‡½æ•°fnçš„å…¶ä»–å‚æ•°è¦æ’é™¤fnè‡ªèº«ã€‚ return typeof result === &#x27;object&#x27; ? result : obj;&#125; è°ç»§æ‰¿è°åªæœ‰ä¸€ä¸ªç±»ï¼Œè°ˆä¸ä¸Šç»§æ‰¿ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªçˆ¶ç±»ï¼Œä¸€ä¸ªå­ç±»ç»§æ‰¿çˆ¶ç±»ã€‚JS ç»§æ‰¿ä¾èµ–çš„æ˜¯åŸå‹ï¼Œè¯·ç‰¢è®°ï¼ æ¥ç€ï¼Œå…ˆçœ‹ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ 1234567891011121314function Parent() &#123;&#125;function Son() &#123;&#125;Son.prototype = Parent.prototype; // è¿™ä¸æ˜¯ç»§æ‰¿ï¼Œè¿™æ˜¯èµ¤è£¸è£¸çš„è®©å­ç±»åŸå‹ å’Œ çˆ¶ç±»åŸå‹ æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Son.prototype.constructor = Son; // çº æ­£ä¸Šé¢ä¸€è¡Œå¯¼è‡´constructorè¢«æ”¹å†™çš„é—®é¢˜ï¼Œè®©å®ƒæŒ‡å‘æ­£ç¡®å€¼var son = new Son();son.constructor === Son; // true æ²¡é—®é¢˜ï¼Œæ¯•ç«Ÿä¸Šé¢é‡å†™äº†constructorson.__proto__ === Son.prototype; // trueson.__proto__ === Parent.prototype; // trueson.__proto__.__proto__ === Object.prototype; // true// è€Œä¸”var parent = new Parent();parent.constructor === Parent; // false å› ä¸ºçˆ¶å­ç±»åŸå‹éƒ½ç›¸ç­‰äº†ï¼Œä¸”ä¸ŠSon.prototype.constructor = Sonï¼Œå¯¼è‡´çˆ¶ç±»å®ä¾‹ç°åœ¨å‡ºé—®é¢˜äº†ã€‚ ä¸Šé¢çš„ä¾‹å­å¹¶æ²¡æœ‰ä½“ç°Sonç»§æ‰¿äº†Parentï¼Œè€Œæ˜¯ç›´æ¥è®©çˆ¶å­ç±»çš„åŸå‹ç›¸ç­‰äº†ï¼Œè¿˜å¯¼è‡´çˆ¶ç±»å®ä¾‹çš„constructoræŒ‡å‘åˆ°äº†Sonä¸Šï¼Œå®Œå…¨é”™è¯¯ï¼ åŸå‹ç»§æ‰¿è¦è¾¾åˆ°çš„æ˜¯å­ç±»åŸå‹ ç»§æ‰¿è‡ª çˆ¶ç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯son.__proto__.__proto__ === Parent.prototypeï¼Œä¸”çˆ¶ç±»å®ä¾‹å’Œå­ç±»å®ä¾‹çš„constructoréƒ½è¦æŒ‡å‘æ­£ç¡®çš„å€¼æ‰å¯¹ã€‚ æˆ‘ä»¬çœ‹çœ‹æ­£ç¡®çš„å†™æ³• 123456789101112function Parent() &#123;&#125;function Son() &#123;&#125;Son.prototype = new Parent(); // è¿™é‡Œå®ç°ç»§æ‰¿ï¼new Parent()è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç©ºçš„&#123;&#125;ï¼Œä½†æ˜¯å…¶åŸå‹æŒ‡å‘çš„æ—¶Parent.prototypeå¯¹è±¡å“¦ï¼Œä¹Ÿå°±æ˜¯&#123;constructor: Parent&#125;Son.prototype.constructor = Son;var son = new Son();son.constructor === Son; // trueson.__proto__ === Son.prototype; // trueson.__proto__.__proto__ === Parent.prototype; // truevar parent = new Parent();parent.constructor === Parent; // true è¿™ä¸‹æ²¡é—®é¢˜äº†ï¼Œå¯ä»¥çœ‹åˆ°sonå®ä¾‹çš„åŸå‹æŒ‡å‘Sonç±»ï¼Œè€ŒSonç±»åˆç»§æ‰¿è‡ªParentç±»ã€‚å„è‡ªç±»å®ä¾‹çš„constructoræŒ‡å‘ä¹Ÿæ­£ç¡®ã€‚ ç»§æ‰¿ç‰ˆæœ¬æ¼”è¿›å¸¸è§å½¢å¼ï¼ˆåŸå‹ç»§æ‰¿ï¼‰æœ€å¸¸è§çš„å½¢å¼æ˜¯å°†å±æ€§å†™åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ–¹æ³•å†™åœ¨åŸå‹å¯¹è±¡ä¸Šã€‚ 123456789101112131415161718192021function Parent() &#123; this.arr = [];&#125;Parent.prototype.print = function () &#123; console.log(this.arr);&#125;;function Son() &#123;&#125;Son.prototype = new Parent(); // *Son.prototype.constructor = Son;var son = new Son();son.arr.push(1);son.print(); // [1]var son2 = new Son();son2.print(); // [1] son2 ä¸åº”è¯¥æ‰“å°å‡º[1]ã€‚åŸå› æ˜¯ä¸Šé¢*æ‰€åœ¨çš„ä»£ç å¯¼è‡´ï¼ŒSon.prototypeç­‰äº&#123;arr: []&#125;ï¼Œåé¢å®ä¾‹åŒ–çš„son1 son2è®¿é—®çš„éƒ½æ˜¯åŸå‹ä¸Šçš„arrï¼Œå¼•ç”¨ç±»å‹ï¼Œå› æ­¤son2.arrä¹Ÿæ‰“å°[1]ã€‚ å­ç±»å®ä¾‹å…±äº«äº†åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œè¿™ç§ç»§æ‰¿æ˜¯æœ‰é—®é¢˜çš„ã€‚æ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯å…±äº«å±æ€§ç§»åˆ°æ¯ä¸ªå®ä¾‹è‡ªå·±èº«ä¸Šå°±å¯ä»¥äº†ã€‚ ç»„åˆç»§æ‰¿æ¨¡å¼ï¼ˆå€Ÿç”¨æ„é€ å‡½æ•°+åŸå‹ç»§æ‰¿ï¼‰å€Ÿç”¨æ„é€ å‡½æ•°ï¼Œæ„æ€æ˜¯Parentåœ¨Sonä¸­è°ƒç”¨ï¼Œç±»ä¼¼classç»§æ‰¿ä¸­çš„superè°ƒç”¨ã€‚æ³¨æ„å¤„ç†thisæŒ‡å‘ï¼Œæ¯•ç«Ÿæ˜¯å€Ÿç”¨ï¼Œthiséœ€è¦æŒ‡å‘Sonï¼Œä¸ç„¶å€Ÿç”¨æ— æ„ä¹‰ã€‚å¦å¤–ï¼Œå€Ÿç”¨è¿˜è®©æˆ‘ä»¬æœ‰æœºä¼šå¾€çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚ã€‚ 1234567891011121314151617181920212223242526function Parent(name) &#123; this.arr = []; this.name = name;&#125;Parent.prototype.print = function () &#123; console.log(this.arr);&#125;;Parent.prototype.say = function () &#123; console.log(`Hi $&#123;this.name&#125;`);&#125;;function Son(name) &#123; Parent.call(this, name); // *&#125;Son.prototype = new Parent();Son.prototype.constructor = Son;var son1 = new Son(&#x27;1st son&#x27;);son1.arr.push(1); // [1]var son2 = new Son(&#x27;2rd son&#x27;);son2.print(); // []son1.arr === son2.arr; // falseson1.say(); // 1st sonson2.say(); // 2rd son ä¸Šé¢çš„*å®ç°äº†å€Ÿç”¨æ„é€ åŠŸèƒ½ï¼Œè°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘çš„æ˜¯ son å®ä¾‹æœ¬èº«ï¼Œå› æ­¤Parentæ„é€ å‡½æ•°ä¸­çš„ä»£ç ä¼šå¾€å®ä¾‹æœ¬èº«æ·»åŠ arrå’Œnameå±æ€§ã€‚Sonå®ä¾‹å„è‡ªæ‹¥æœ‰è‡ªèº«å±æ€§ï¼Œä½†æ–¹æ³•ä¾æ—§å…±äº«Parent.prototypeä¸Šçš„ã€‚ è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹åœ¨äºï¼š Parentè¢«è°ƒç”¨äº† 2 æ¬¡ï¼Œä¸€æ¬¡æ˜¯Sonå†…å€Ÿç”¨ï¼Œä¸€æ¬¡æ˜¯Son.prototypeè®¾ç½® arrå’Œnameå±æ€§ä¹Ÿè¢«åˆ›å»ºäº† 2 æ¬¡ï¼Œå› ä¸ºParentè°ƒç”¨äº† 2 æ¬¡ã€‚åœ¨Sonçš„å®ä¾‹èº«ä¸Šå’ŒSon.prototypeåŸå‹èº«ä¸Šåˆ†åˆ«åˆ›å»ºäº†ï¼Œç„¶å é®è”½æ•ˆåº” è®©æˆ‘ä»¬åœ¨è®¿é—® son1.arræ—¶ï¼Œä¼˜å…ˆä»è‡ªèº«æ‰¾åˆ°arrå±æ€§ï¼Œè€Œä¸æ˜¯åŸå‹ä¸Šçš„ã€‚ä»ä¸‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºã€‚ å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ä¸Šé¢çš„ç»„åˆç»§æ‰¿çš„ç¼ºç‚¹å°±æ˜¯è°ƒç”¨äº† 2 æ¬¡ï¼Œé‚£æˆ‘ä»¬å°±æƒ³åŠæ³•åªè°ƒç”¨ä¸€æ¬¡Parentå°±å¯ä»¥äº†ã€‚ åˆ†æä¸‹ï¼ŒSonåœ¨é€šè¿‡newå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œéœ€è¦å°†å±æ€§æŒ‚è½½åˆ°å®ä¾‹èº«ä¸Šï¼Œå¦åˆ™å¤šä¸ªå®ä¾‹å°±å…±ç”¨äº†å±æ€§ï¼Œæ‰€ä»¥Sonå†…çš„å€Ÿç”¨æ„é€ å‡½æ•°ä¸èƒ½çœç•¥ï¼Œè¿™æ˜¯è®©Sonå®ä¾‹æœ‰è‡ªèº«å±æ€§çš„å”¯ä¸€åŠæ³•ã€‚é‚£å°±åªèƒ½ä»Son.prototype = new Parent()èº«ä¸Šæƒ³åŠæ³•ï¼Œç”¨åˆ«çš„æ–¹å¼æ¥ç»§æ‰¿ã€‚ Object.create(proto[, propertiesObject])è¿™ä¸ªæ˜¯ ES æ ‡å‡†ä¸­çš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ä¼ å…¥çš„protoä½œä¸ºåŸå‹ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰æ–°å¯¹è±¡çš„ä¸€äº›å±æ€§ï¼Œå’ŒObject.definePropertiesæ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚ 123456789var parentProto = &#123; say: function () &#123; console.log(&#x27;say hi&#x27;); &#125;,&#125;;var obj = Object.create(parentProto);obj.say(); // say hiobj.__proto__ === parentProto; // true ä½†è¿™ä¸ªæ–¹æ³•ä¹Ÿæœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å¼•ç”¨ç±»å‹å€¼å…±äº«äº†ã€‚ 12345678var parentProto = &#123; arr: [],&#125;;var o1 = Object.create(parentProto);var o2 = Object.create(parentProto);o1.arr.push(1);console.log(o2.arr); // [1] å› ä¸ºè®¿é—®çš„éƒ½æ˜¯åŸå‹å¯¹è±¡ä¸Šçš„arrã€‚ æ¨¡æ‹Ÿ Object.createIE9 ä»¥ä¸‹æ˜¯ä¸æ”¯æŒè¿™ä¸ªæ–¹æ³•çš„ï¼Œæ‰€ä»¥è€ƒè™‘åˆ°æµè§ˆå™¨å…¼å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿè¿™ä¸ªæ–¹æ³•ã€‚ æ¨¡æ‹Ÿçš„å…³é”®å°±æ˜¯ç†è§£Object.createå¹²äº†ä»€ä¹ˆäº‹ã€‚ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ å°†å‚æ•°è®¾ç½®ä¸ºæ–°å¯¹è±¡çš„åŸå‹ è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚ 12345function ObjectCreate(proto) &#123; function F() &#123;&#125; F.prototype = proto; return new F();&#125; åŠŸèƒ½å¦‚Object.create 1234567891011121314function ObjectCreate(proto) &#123; function F() &#123;&#125; F.prototype = proto; return new F();&#125;var parentProto = &#123; say: function () &#123; console.log(&#x27;say hi&#x27;); &#125;,&#125;;var obj = ObjectCreate(parentProto);obj.say(); // say hi å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿éœ€è¦ç”¨åˆ°çš„å…³è”åŸå‹æˆ‘ä»¬å·²ç»è¯´æ¸…æ¥šï¼Œè¯¥åŠŸèƒ½å°±æ˜¯ç”¨æ¥è§£å†³å¯„ç”Ÿç»„åˆç»§æ‰¿å¼€ç¯‡è¯´åˆ°çš„Parentè¢«å¤šnewäº†ä¸€æ¬¡æ¥å…³è”åŸå‹ã€‚ æˆ‘ä»¬æ¥ç”¨å¯„ç”Ÿç»„åˆæ¨¡å¼é‡å†™ç»„åˆç»§æ‰¿æ¨¡å¼ä¸­ demoã€‚ 123456789101112131415161718192021222324252627function Parent(name) &#123; this.arr = []; this.name = name;&#125;Parent.prototype.print = function () &#123; console.log(this.arr);&#125;;Parent.prototype.say = function () &#123; console.log(`Hi $&#123;this.name&#125;`);&#125;;function Son(name) &#123; Parent.call(this, name);&#125;// Son.prototype = new Parent();Son.prototype = Object.create(Parent.prototype); // åŸå‹å…³è”æ–¹æ³•æ”¹é€ ã€‚å…¼å®¹IE9ä»¥ä¸‹å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æ¨¡æ‹ŸObject.createå‡½æ•°ObjectCreateSon.prototype.constructor = Son;var son1 = new Son(&#x27;1st son&#x27;);son1.arr.push(1); // [1]var son2 = new Son(&#x27;2rd son&#x27;);son2.print(); // []son1.arr === son2.arr; // falseson1.say(); // 1st sonson2.say(); // 2rd son ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œå±æ€§æ²¡æœ‰é‡å¤å£°æ˜äº†ã€‚ ES6+çš„ç»§æ‰¿è‡ªä» ES6 æ¨å‡ºäº†classå’Œextendsè¯­æ³•åï¼ŒJS ä¸­ç»§å˜å¾—ç®€å•äº†ï¼Œå¯ä»¥å°†æ–°çš„è¯­æ³•çœ‹æˆæ˜¯å‡½æ•°ç»§æ‰¿çš„è¯­æ³•ç³–ï¼Œæ ¸å¿ƒåŠŸèƒ½è¿˜æ˜¯é€šè¿‡prototpyeæ¥å®ç°ç»§æ‰¿ï¼Œä¹‹å¤–æœ‰äº›è¡¨ç°æ˜¯ä¸åŒäº ES5 çš„ç»§æ‰¿ã€‚ ä½¿ç”¨æ–°è¯­æ³•æ”¹å†™ä¸Šé¢çš„çˆ¶å­ç±» demo 1234567891011121314151617181920212223class Parent &#123; constructor(name) &#123; this.arr = []; this.name = name; &#125; print() &#123; console.log(this.arr); &#125; say() &#123; console.log(`Hi $&#123;this.name&#125;`); &#125;&#125;class Son extends Parent &#123; constructor(name) &#123; super(name); &#125;&#125;let son1 = new Son(&#x27;1st son&#x27;);let son2 = new Son(&#x27;2rd son&#x27;); æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ classå¿…é¡»é€šè¿‡newè°ƒç”¨ classä¸Šæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œå‡ä¸å¯æšä¸¾ã€‚ classå­˜åœ¨å£°æ˜æå‡ï¼ˆèµ‹å€¼æ²¡æœ‰ï¼‰ classç»§æ‰¿ï¼Œå­ç±»constructoré‡Œå¿…é¡»å…ˆè°ƒç”¨super()è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ã€‚å› ä¸ºå­ç±»æœŸæœ›çˆ¶ç±»çš„constructoræ¥å®Œæˆ new F()å¹²çš„äº‹ï¼Œå¦åˆ™æ²¡æœ‰æ–°å¯¹è±¡ï¼Œæ— æ³•èµ‹å€¼this å› ä¸ºå‡½æ•°å°±æ˜¯å†…ç½®Functionçš„å®ä¾‹ï¼Œæ‰€ä»¥Son.__proto__æŒ‡å‘çš„æ˜¯Function.prototypeï¼Œè€Œç±»å†™æ³•Son.__proto__æŒ‡å‘çš„æ˜¯Parentï¼Œå› ä¸ºSonç»§æ‰¿è‡ªParentä¹ˆï¼Œåˆ©ç´¢å½“ç„¶åŸå‹åº”è¯¥æŒ‡å‘Parentï¼Œåœ¨é€šè¿‡babelè½¬æ¢è¯­æ³•åï¼Œå¯ä»¥çœ‹åˆ°å®ç°æ˜¯ï¼š 12function Parent() &#123;&#125;var Son = Object.create(Parent); æ€»ç»“ ç»§æ‰¿çš„æ ¹æœ¬å°±æ˜¯åŸå‹é“¾çš„ç»§æ‰¿ï¼ˆå§”æ‰˜ï¼‰ï¼Œä¸ç®¡æ˜¯ ES5 è¿˜æ˜¯ ES6+æ—¶ä»£ã€‚ ES5 æ—¶ä»£å‰çš„ç»§æ‰¿æ˜¯é€šè¿‡å‡½æ•°æ¥æ¨¡æ‹Ÿå®ç°çš„ã€‚å…¶ä¸­æœ€å®Œç¾çš„æ–¹å¼æ˜¯å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯åŸºäºprototypeæ¥ä¹¦å†™å…¬å…±æ–¹æ³•ï¼ŒåŸºäºObject.createï¼ˆæ¨¡æ‹Ÿå‡½æ•°ï¼‰æ¥è®©å­ç±»å…³è”çˆ¶ç±»çš„åŸå‹å¯¹è±¡ã€‚ æˆ‘ä»¬åœ¨ ES5 ç»§æ‰¿æ¨¡å¼ä¸­ï¼Œé¡ºå¸¦ä¹Ÿæ¸…æ¥šäº†è§£çš„newçš„å·¥ä½œä»¥åŠæ¨¡æ‹Ÿnewçš„å®ç°ï¼Œè¿˜æœ‰Object.createçš„å·¥ä½œåŠå…¶æ¨¡æ‹Ÿå®ç°ã€‚ ES6 æ—¶ä»£çš„classè¯­æ³•ï¼Œç»§æ‰¿å®ç°ï¼Œä»¥åŠå®ƒå’Œå‡½æ•°ç»§æ‰¿çš„ä¸€äº›å·®åˆ«ã€‚","categories":[],"tags":[]},{"title":"å­¦ä¹ Redux","slug":"2020/ææ‡‚redux","date":"2020-12-29T16:00:00.000Z","updated":"2021-11-06T07:35:00.566Z","comments":true,"path":"2020/12/30/2020/ææ‡‚redux/","link":"","permalink":"https://690554125.github.io/2020/12/30/2020/%E6%90%9E%E6%87%82redux/","excerpt":"","text":"ä¸ºä»€ä¹ˆæœ‰è¿™ç¯‡æ–‡ç« ï¼Ÿå› ä¸ºä½¿ç”¨ react æŠ€æœ¯æ ˆæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œç›¸åº”çš„ redux çŠ¶æ€ç®¡ç†åº“ä¹Ÿä½¿ç”¨å¾ˆä¹…ï¼Œå¶å°”ä¸€æ®µæ—¶é—´ä¸ç”¨ï¼Œå‘ç°å°±ä¼šå¿˜è®°æŸäº› apiï¼Œç”šè‡³æ˜¯çœ‹è¿‡çš„ä¸»è¦æ˜¯å®ç°åŸç†åˆå¿˜çš„ä¸€å¹²äºŒå‡€ã€‚æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œä»¥ä¾¿å¿˜è®°åæŸ¥é˜…ï¼Œè¿…é€Ÿè®©å¤§è„‘æœ‰ä¸ªå°è±¡ã€‚ æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ªå•å‘æ•°æ®æµçš„çŠ¶æ€ç®¡ç†åº“ã€‚ ä¸€äº›æ¦‚å¿µAPP åº”ç”¨æ•´ä¸ªçš„çŠ¶æ€éƒ½å­˜æ”¾åœ¨å•ä¸€çš„Storeä¸­å¿ƒï¼Œä¿®æ”¹Storeçš„å”¯ä¸€é€”å¾„å°±æ˜¯å‘èµ·Actionï¼ŒActionåˆ°è¾¾Storeåï¼Œä¼šæ ¹æ®Actionæä¾›çš„åŠ¨ä½œç±»å‹ï¼Œæ–°çš„æ•°æ®ï¼Œç»“åˆæ—§çš„çŠ¶æ€åˆæˆä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œè¿™ä¸ªåˆæˆæ–°çŠ¶æ€çš„è¿‡ç¨‹ç§°ä¸ºReducerã€‚ Reducer å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç›¸åŒè¾“å…¥ï¼Œå¾—åˆ°ç›¸åŒè¾“å‡ºï¼Œè¾“å‡º stateã€‚ 12345function reducer() &#123; return &#123; count: 0 &#125;;&#125; Action å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‡æ³¨çš„ JS å¯¹è±¡ï¼Œå…·æœ‰typeå±æ€§ï¼Œè¿™æ˜¯çº¦å®šçš„ï¼ŒåŠ¨ä½œçš„ç±»å‹ï¼Œä»¥ä¾¿reduceré’ˆå¯¹ä¸åŒåŠ¨ä½œï¼Œå¤„ç†ä¸åŒé€»è¾‘è¿”å›æ–°çš„ stateã€‚ 1234const addAction = &#123; type: &#x27;add&#x27;, otherData: &#x27;add num&#x27;&#125;; æ³¨æ„ï¼šä¸èƒ½ç›´æ¥ä¿®æ”¹æ—§Storeï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä»½æ–°çš„Storeã€‚ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿè·Ÿè¸ªçŠ¶æ€å˜åŒ–ï¼Œä¸€åˆ‡æœ‰è¿¹å¯å¾ªã€‚ åŸºæœ¬ä½¿ç”¨æ­é…Reactæ•°æ®é©±åŠ¨è§†å›¾æ¡†æ¶ï¼Œé£Ÿç”¨æ›´ä½³ï¼ åˆ›å»ºæ•°æ®ä¸­å¿ƒStoreã€‚æ¥æ”¶ä¸€ä¸ª reducers å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºç”ŸæˆçŠ¶æ€æ•°æ®ï¼Œæ— ä»»ä½•actionæ—¶ï¼Œreducerçš„è®¡ç®—å°†é»˜è®¤è¿”å›å®ƒæ‰€æ‹¥æœ‰çš„æ‰€æœ‰stateã€‚ 12345import &#123; createStore &#125; from &#x27;redux&#x27;;const Store = createStore(reducers);export default Store; åˆ›å»ºcreateStoreæ‰€éœ€çš„reducersã€‚reducers æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›storeã€‚é€šå¸¸æˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šé¡µé¢å’Œç»„ä»¶ï¼Œæ¯ä¸ªé¡µé¢æˆ–ç»„ä»¶æœ‰è‡ªå·±çš„reducerç”Ÿæˆçš„stateï¼Œå°†å¤šä¸ªreduceråˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„reducerså°±æ˜¯æ•´ä¸ª APP åº”ç”¨éœ€è¦çš„storeã€‚è¿™ç§æ‹†åˆ†æ–¹å¼æ–¹ä¾¿æˆ‘ä»¬å¯¹stateä¸šåŠ¡æ•°æ®æ¨¡å—åŒ–ï¼Œæ¯ä¸ªæ¨¡å—åªè¦è´Ÿè´£ç»´æŠ¤éƒ¨åˆ†æ•°æ®å³å¯ã€‚ 12345678910111213141516171819202122// reduceråªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡å¯¹ä¹‹å‰çš„stateå’Œå½“å‰actionçš„ç±»å‹åŠå‚æ•°çš„å¤„ç†ï¼Œè¿”å›æ–°çš„çš„statefunction reducerOne(preState, action) &#123; // ä¸€èˆ¬æƒ¯ç”¨switch caseå½¢å¼ // ä½ ä¹Ÿå¯ä»¥ç”¨if else if const &#123; type &#125; = action; if (type === &#x27;add&#x27;) &#123; return &#123; count: preState + 1 &#125;; &#125; else &#123; return &#123; count: 0 &#125;; &#125;&#125;function reducerTwo(preState, action) &#123; // ... return &#123; name: &#x27;hello&#x27; &#125;;&#125; å› ä¸ºcreateStoreåªæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨reduxæä¾›çš„combineReducersï¼Œè‡ªåŠ¨è°ƒç”¨å¤šä¸ªreducerï¼Œè·å–å®ƒä»¬çš„stateåˆå¹¶ä¸€ä¸‹ã€‚","categories":[],"tags":[]},{"title":"Babel7 å¸¸è§é…ç½®å’Œæ¦‚å¿µã€‚","slug":"2019/babel7","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:30:45.361Z","comments":true,"path":"2019/12/30/2019/babel7/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/babel7/","excerpt":"","text":"å®‰è£…æˆ‘è¿™é‡Œå°±ç”¨yarnäº†ï¼Œnpmä¸€æ · 12yarn add @babel/core @babel/cli @babel/preset-env -Dyarn add @babel/polyfill å¤§è‡´å…ˆè¯´ä¸‹è£…äº†äº›å•¥ï¼Œcoreæ ¸å¿ƒï¼Œcliå·¥å…·ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œæ¥è¿è¡Œbabelå‘½ä»¤ã€‚ preset-envä¸»è§’ä¹‹ä¸€ï¼Œenv æ˜¯å·²ç»åœ¨æµè§ˆå™¨æ ‡å‡†ä¸­çš„æ„æ€ï¼ŒBabel å®˜æ–¹çš„ä¸€ä¸ªæ–° API æ’ä»¶é›†åˆï¼Œå¯ä»¥å°†ä¸€äº› ES6+çš„æ–° API è½¬æ¢æˆ ES5ã€‚æ­é…polyfillä¸»è§’ä¹‹ä¸€ï¼Œæ¨¡æ‹Ÿä¸€ä¸ª ES6+çš„ç¯å¢ƒï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°çš„ç‰¹æ€§ã€‚å¦‚promiseç­‰ã€‚ æ€ä¹ˆé…ç½® Babelå®˜æ–¹æ¨èç”¨babel.config.jsï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢å†™ JSï¼Œæ¯”å¦‚å¯¹ç¯å¢ƒENVä¸åŒï¼Œåšä¸€äº›ä¸åŒçš„é…ç½®ã€‚ä¹Ÿæ”¯æŒ.babelrcæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œé€šå¸¸è·Ÿæ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å†™åœ¨package.jsonä¸­ï¼Œä»¥babelä¸ºkeyæ¥å†™é…ç½®ã€‚ å¤§æŠµæœ€ç»ˆå¯¼å‡ºçš„å…¶å®å°±ä¸¤æ ·ä¸œè¥¿ï¼Œpluginså’Œpresets: 1234&#123; presets: [], plugins: []&#125; Plugins é…ç½®æ•°ç»„æ ¼å¼ï¼Œå¯ä»¥çœç•¥babel-plugin- 123456&#123; &quot;plugins&quot;: [ &quot;myPlugin&quot;, // åŒç­‰ &quot;babel-plugin-myPlugin&quot; ]&#125; å¯¹åŸŸçš„å†™æ³•åŒæ ·é€‚åˆ 123456&#123; &quot;plugins&quot;: [ &quot;@babel/babel-plugin-name&quot;, // åŒç­‰ &quot;@babel/name&quot; ]&#125; å¦‚æœå•ç‹¬æŸä¸ªæ’ä»¶éœ€è¦é…ç½®é¡¹ï¼Œåˆ™åœ¨æ•°ç»„ç¬¬äºŒä¸ªä½ç½®å†™ä¸ªé…ç½®å¯¹è±¡ã€‚æ¯ä¸ªæ’ä»¶å³ä¸€ä¸ªæ•°ç»„ï¼š 1234567&#123; &quot;plugins&quot;: [ [&quot;transform-async-to-module-method&quot;, &#123; &quot;module&quot;: &quot;bluebired&quot; &#125;] ]&#125; åŒç†ï¼Œpresetsä¹Ÿæ˜¯è¿™æ ·å¯¹å•ç‹¬é¡¹å†™é…ç½®ã€‚ æ³¨æ„åŠ è½½é¡ºåº pluginsæ˜¯ä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªã€‚ presetsæ˜¯ä»æœ€åä¸€ä¸ªåˆ°ç¬¬ä¸€ä¸ªã€‚åŸå› å®˜æ–¹è¯´æ˜¯å¤§éƒ¨åˆ†ç”¨æˆ·ä¼šå–œæ¬¢es2015å†™åœ¨å‰é¢ï¼Œ æ’ä»¶åœ¨presetsä¹‹å‰å¼€å§‹ã€‚ Presetsé¡¾åæ€ä¹‰ï¼Œé¢„è®¾ã€‚å®˜æ–¹æä¾›çš„@babel/preset-envç­‰å…¶å®æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ’ä»¶æ•°ç»„è€Œå·²ï¼Œæ— éæ˜¯ç”¨äº†å“ªäº›æ’ä»¶ã€‚æ”¯æŒåŒ…å«å¸¦é€‰é¡¹çš„pluginæˆ–å…¶ä»–presets 123456789101112131415module.exports = function() &#123; return &#123; plugins: [ &#x27;pluginA&#x27;, &#x27;pluginB&#x27;, [ &#x27;pluginC&#x27;, &#123; opt: 1 &#125; ] ], presets: [require(&#x27;@babel/preset-env&#x27;)] &#125;;&#125;; å…³äºè·¯å¾„è¿™å—ï¼Œå¯ä»¥ç»å¯¹ï¼Œç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å…¨åï¼ˆä»node_modulesä¸Šæ‰¾ï¼‰ã€‚ è‡³äºé…ç½®çš„å†™æ³•ï¼Œåœ¨Pluginsä¸­å·²ç»è¯´è¿‡ã€‚è¿™é‡Œå†æé†’ä¸‹ï¼Œpresetsæ˜¯å€’åºçš„ã€‚ å…³äºé…ç½®æ–‡ä»¶è¿™é‡Œæ³¨æ„ä¸‹æœ‰ä¸ªMonorepoçš„ç›®å½•æ¨¡å¼ã€‚å¤§è‡´æ„æ€å°±æ˜¯å¤šä¸ª repoï¼Œåœ¨åŒä¸€ä¸ª package ä¸­ç®¡ç†ã€‚ Polyfillä¹‹å‰æåˆ°è¿‡ï¼Œæ¨¡æ‹Ÿ ES5+çš„ç¯å¢ƒã€‚ä¹Ÿä¼šå°‘é‡çš„åœ¨åŸå‹é“¾å¦‚ String ä¸Šæ·»åŠ ä¸€äº›æ–¹æ³•ï¼Œå¦‚includesã€‚å®˜æ–¹æ¨èä½¿ç”¨@babel/preset-envï¼Œå¹¶ä¸”è®¾ç½®è¯¥presetsé€‰é¡¹çš„é…ç½®useBuildInsä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥è¾¾åˆ°çš„æ•ˆæœï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥æˆ‘ä»¬ç”¨åˆ°çš„polyfillä»£ç ã€‚ å¦‚æœä½ éœ€è¦æ‰€æœ‰çš„ES5+çš„é™æ€æ–¹æ³•ï¼Œå®ä¾‹æ–¹æ³•å·²ç»æ–°çš„APIï¼Œé‚£ä½ å°±éœ€è¦æ‰‹åŠ¨åœ¨å…¥å£æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥@babel-polyfillï¼Œç¼ºç‚¹æ˜¯ï¼Œè¿™æ ·å­æ˜¯ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒçš„ã€‚ ä½¿ç”¨ä½ç½®ä¸ç®¡æ˜¯CommonJSè¿˜æ˜¯ES6 Modulesï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨åº”ç”¨çš„å…¥å£æ–‡ä»¶çš„é¡¶éƒ¨ï¼ŒåŠ è½½@babel/polyfillã€‚ å’Œwebpackæ„å»ºå·¥å…·ä¸€èµ·ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬æœ‰ 3 ç§æ–¹å¼å¼•å…¥polyfillã€‚åœ¨.babelrcä¸­å¯¹presetsé‡Œçš„envè¿›è¡Œé…ç½®é¡¹è®¾ç½®ï¼Œè®¾ç½®useBuildInsã€‚ é»˜è®¤æ˜¯falseï¼Œç›¸å½“äºç€åœ¨webpack.config.jsçš„entryæ•°ç»„å¤´éƒ¨ç›´æ¥åŠ å…¥ã€‚ 123module.exports = &#123; entry: [&#x27;@babel/polyfill&#x27;, &#x27;./app.js&#x27;]&#125;; è®¾ä¸ºusageï¼Œä¸ä¼šåœ¨ä»»ä½•åœ°æ–¹å¯¼å…¥@babel/polyfillï¼Œè€Œæ˜¯ç”¨åˆ°å“ªäº›å¯¼å“ªäº›ï¼Œä½†ä¾æ—§éœ€å®‰è£…@babel/polyfill è®¾ä¸ºentryï¼Œåœ¨å…¥å£æ–‡ä»¶çš„å¤´éƒ¨åŠ è½½ã€‚ æ³¨æ„åœ¨Babel6.xä¸­ï¼ŒuseBuildInsåªæœ‰trueå’Œfalseã€‚ plugin-transform-runtimeè¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥é‡ç”¨Babelæ³¨å…¥çš„è¾…åŠ©ä»£ç ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘ä»£ç ä½“ç§¯ã€‚ 12345// å¼€å‘ä¾èµ–`yarn add @babel/plugin-transform-runtime -D`// ç”Ÿäº§ä¾èµ–`yarn add @babel/runtime` å‰è€…ä¸»è¦æ˜¯å°†helperä»£ç è‡ªåŠ¨ä»babel-runtime/core-jsä¸­å¼•å…¥ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å†™ã€‚åè€…ç›¸å½“äºä¸€ä¸ªç‹¬ç«‹å‡ºæ¥çš„æ¨¡æ‹ŸES5+çš„ç¯å¢ƒåŒ…ï¼Œæ˜¯åœ¨æ‰“åŒ…çš„æ—¶å€™éœ€è¦ç”¨åˆ°çš„ï¼Œä½†ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€ï¼Œä¸€äº›å®ä¾‹å±æ€§ä¸èƒ½ä½¿ç”¨ã€‚æ‰€ä»¥è¿™ä¸¤è€…æ˜¯æ­é…ä½¿ç”¨çš„ã€‚ å¸¸ç”¨å®è·µå¸Œæœ›è¾¾åˆ°ï¼Œå¤ç”¨ä»£ç ï¼Œç¼©å°ä»£ç ä½“ç§¯ï¼ŒåŠŸèƒ½è¿˜èƒ½å¾ˆå…¨çš„ç›®æ ‡ã€‚ å¤ç”¨ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨transform-runtime-pluginï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œè‡ªåŠ¨é‡å†™æˆ‘ä»¬çš„å¯¼å…¥ä»£ç ï¼Œå…¨éƒ¨ä»babel/runtimeä¸­å¯¼å…¥ã€‚ ç¼©å°ä»£ç ä½“ç§¯ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰éœ€åŠ è½½ï¼Œtransform-runtime-pluginå’Œbabel/runtimeç»“åˆä½¿ç”¨å°±å¯ä»¥è¾¾åˆ°æŒ‰éœ€åŠ è½½ï¼Œæ’ä»¶ä¼šåˆ†ææˆ‘ä»¬ç”¨åˆ°äº†å“ªäº›æ–°çš„APIï¼Œå¦‚promiseï¼Œåˆ™ä»import promise2 from &#39;@babel/runtime/core-js/promiseï¼Œæ³¨æ„åˆ°è¿™é‡Œä½¿ç”¨çš„æ˜¯promise2ï¼Œæ‰€ä»¥é¿å…äº†å…¨å±€æ±¡æŸ“ã€‚ åŠŸèƒ½å…¨ï¼Œå…‰æœ‰@babel/runtimeï¼Œè¿˜ä¸å¤Ÿï¼Œå®ƒåªèƒ½å¸®æˆ‘ä»¬æ¨¡æ‹Ÿå‡ºå¤§éƒ¨åˆ†ES5+ç¯å¢ƒï¼Œä½†æ˜¯å¦‚&#39;hello&#39;.includes(&#39;h&#39;)ç­‰å®ä¾‹æ–¹æ³•ï¼Œæ˜¯æ²¡æœ‰çš„ï¼ŒåŸå› å°±æ˜¯ä¸æ±¡æŸ“å…¨å±€ç¯å¢ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦babel-polyfillï¼Œä½†æ˜¯babel-polyfillåŒ…å«äº†å®Œæ•´çš„ES5+ç¯å¢ƒï¼ŒåŒ…å¾ˆå¤§ï¼Œä¸”æ•°æ®å…¨å±€ç¯å¢ƒå¼•å…¥ï¼Œä¼šå¯¼è‡´æ±¡æŸ“ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªbabel-preset-envï¼Œè¿™ä¸ªé¢„ç½®å…¶å®å°±æ˜¯åŒ…å«äº†å¾ˆå¤špluginsï¼Œéœ€è¦å“ªä¸ªï¼Œæˆ‘ä»¬ç”¨å“ªä¸ªï¼Œå¯ä»¥æ ¹æ®å¼€å‘ç¯å¢ƒæ¥é€‰æ‹©ï¼Œå·²è¾¾åˆ°æœ€å°ä½¿ç”¨babel-polyfillï¼Œéœ€è¦è®¾ç½®useBuildInsä¸ºusageï¼Œæ„ä¸ºä¸ç›´æ¥å¼•å…¥babel-polyfillï¼Œè€Œåªå•ç‹¬åŠ è½½ç”¨åˆ°çš„ã€‚","categories":[],"tags":[]},{"title":"webpack æ¨¡å—åŒ–åŸç†ï¼ˆES+CJSï¼‰","slug":"2019/es-cjs-module","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:30:54.214Z","comments":true,"path":"2019/12/30/2019/es-cjs-module/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/es-cjs-module/","excerpt":"","text":"æ¥ç€ä¸Šä¸€ç¯‡**webpack æ¨¡å—åŒ–åŸç†(es)**ã€‚è¿™ç¯‡æˆ‘ä»¬çœ‹ä¸‹ es+cjsï¼Œ2 ç§æ¨¡å—æ··åˆä¹¦å†™ï¼Œwebpack æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚demo å’Œä¹‹å‰å·®ä¸å¤šã€‚ 1234567// src/index.jsimport print from &#x27;./print&#x27;;console.log(print); // åº”è¯¥æ˜¯&#123;res: 1&#125;// src/print.js cjså†™æ³•const res = 1;exports.res = res; é€šè¿‡ webpack ç¼–è¯‘åï¼Œä»£ç å¦‚ä¸‹ï¼ˆåŒæ ·ï¼Œåšäº†ä¸€äº›å¤„ç†ï¼Œå»é™¤åˆ†éš”ç¬¦ï¼Œå°†æ¨¡å—çš„å†…éƒ¨å‡½æ•°æ ¼å¼åŒ–ä¸‹ï¼‰å¤§éƒ¨åˆ†è·Ÿä¸Šä¸€ç¯‡ä¸­è§£é‡Šçš„ä¸€æ ·ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä¸‹å‡ ä¸ªä¸œè¥¿ï¼Œåœ¨è¿™ä¸ªç¼–è¯‘åçš„ bundle ä¸­æœ‰ä½¿ç”¨åˆ°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149(function (modules) &#123; // webpackBootstrap // The module cache var installedModules = &#123;&#125;; // The require function function __webpack_require__(moduleId) &#123; // Check if module is in cache if (installedModules[moduleId]) &#123; return installedModules[moduleId].exports; &#125; // Create a new module (and put it into the cache) var module = (installedModules[moduleId] = &#123; i: moduleId, l: false, exports: &#123;&#125;, &#125;); // Execute the module function modules[moduleId].call( module.exports, module, module.exports, __webpack_require__ ); // Flag the module as loaded module.l = true; // Return the exports of the module return module.exports; &#125; // expose the modules object (__webpack_modules__) __webpack_require__.m = modules; // expose the module cache __webpack_require__.c = installedModules; // define getter function for harmony exports // å¤„ç†cjsæ¨¡å—çš„è¾…åŠ©å‡½æ•°ã€‚é€šè¿‡ç»™å…·ä½“å®ç°exportså¯¹è±¡æ–°å¢ä¸€ä¸ªgetterå±æ€§ã€‚ __webpack_require__.d = function (exports, name, getter) &#123; if (!__webpack_require__.o(exports, name)) &#123; Object.defineProperty(exports, name, &#123; enumerable: true, get: getter &#125;); &#125; &#125;; // define __esModule on exports __webpack_require__.r = function (exports) &#123; if (typeof Symbol !== &#x27;undefined&#x27; &amp;&amp; Symbol.toStringTag) &#123; Object.defineProperty(exports, Symbol.toStringTag, &#123; value: &#x27;Module&#x27; &#125;); &#125; Object.defineProperty(exports, &#x27;__esModule&#x27;, &#123; value: true &#125;); &#125;; // create a fake namespace object // mode &amp; 1: value is a module id, require it // mode &amp; 2: merge all properties of value into the ns // mode &amp; 4: return value when already ns object // mode &amp; 8|1: behave like require __webpack_require__.t = function (value, mode) &#123; if (mode &amp; 1) value = __webpack_require__(value); if (mode &amp; 8) return value; if (mode &amp; 4 &amp;&amp; typeof value === &#x27;object&#x27; &amp;&amp; value &amp;&amp; value.__esModule) return value; var ns = Object.create(null); __webpack_require__.r(ns); Object.defineProperty(ns, &#x27;default&#x27;, &#123; enumerable: true, value: value &#125;); if (mode &amp; 2 &amp;&amp; typeof value != &#x27;string&#x27;) for (var key in value) __webpack_require__.d( ns, key, function (key) &#123; return value[key]; &#125;.bind(null, key) ); return ns; &#125;; // getDefaultExport function for compatibility with non-harmony modules // é’ˆå¯¹eså’Œcjsçš„é»˜è®¤å¯¼å‡ºï¼Œåšä¸€äº›å¤„ç†ã€‚è®©å¤§å®¶éƒ½ç»Ÿä¸€ã€‚ // æ¯”å¦‚å¦‚æœæ¨¡å—æºç æ˜¯esçš„ï¼Œé‚£ä¹ˆæ¨¡å—çš„exports.__esModuleå°±ä¼šä¸ºtrueï¼Œåœ¨ä¸Šä¸€ç¯‡æœ‰è§£é‡Šè¿‡ã€‚ // è¯¥å‡½æ•°é€šè¿‡åˆ¤æ–­module.exportsä¸Šæœ‰æ²¡æœ‰__esModuleï¼Œæ¥åŒºåˆ†æš´éœ²é»˜è®¤å¯¼å‡ºåº”è¯¥æ€ä¹ˆæš´éœ²ã€‚ // å¦‚æœæ˜¯cjsï¼Œå®ƒæ˜¯æ²¡æœ‰é»˜è®¤å¯¼å‡ºè¿™ä¸ªæ¦‚å¿µçš„å®é™…ä¸Šæš´éœ²çš„éƒ½æ˜¯å¾€module.exports = exportsï¼Œä¹Ÿå°±æ˜¯exportsèº«ä¸ŠæŒ‚å±æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯æ¨¡å—æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œå‡½æ•°æ¥æ”¶çš„å‚æ•°moduleï¼Œç›´æ¥æš´éœ²å°±å¥½äº†ã€‚ // å¦‚æœæ˜¯esï¼Œå®ƒæœ‰é»˜è®¤å¯¼å‡ºï¼Œè¿˜æœ‰éƒ¨åˆ†å¯¼å‡ºï¼Œé»˜è®¤å¯¼å‡ºæŒ‚åœ¨äº†module.exports.defaultå±æ€§ä¸Šï¼Œå…¶ä»–çš„æŒ‚è½½modulex.exports[xx]ä¸Šã€‚æ‰€ä»¥æš´éœ²çš„æ—¶å€™è¦æš´éœ²defaultsè¿™ä¸ªå±æ€§å€¼ï¼ˆè¿™ä¸ªå‡½æ•°æ¥çš„å‚æ•°å˜é‡ï¼Œå®é™…ä¸Šå°±æ˜¯&#123;moduleId: xx, l: false, exports: &#123;&#125;&#125;ä¸­çš„exportsï¼Œå› ä¸ºæ¨¡å—åŠ è½½å‡½æ•°å·²ç»åœ¨åº•éƒ¨è¿”å›äº†å•Š, return module.exportsï¼‰ã€‚ // è¿™é‡Œç¨åï¼ˆå…ˆå»çœ‹1ï¼Œ2ä¸¤æ­¥éª¤ï¼Œåœ¨ä¸‹é¢ï¼‰è®©æˆ‘ä»¬æˆ‘ä»¬ç»“åˆprint.jsæ¥è®²è§£ // 3. moduleå‚æ•°å°±æ˜¯&#123;res: 1&#125;ã€‚å› ä¸ºprintæ¨¡å—æºç æ˜¯cjså†™çš„ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰è¢«æ‰“ä¸Š__esModule=trueçš„æ ‡è®°ã€‚ // å› æ­¤ï¼Œgetterå°±æ˜¯ç¬¬äºŒä¸ªå‡½æ•°getModuleExportsï¼Œè¿™ä¸ªå‡½æ•°å®é™…ä¸Šå°±ç›´æ¥è¿”å›äº†&#123;res: 1&#125; // æ¥ç€ï¼Œè°ƒç”¨äº†dæ–¹æ³•ï¼Œç»™getModuleExportsè¿™ä¸ªå‡½æ•°ï¼Œèµ‹äº†ä¸€ä¸ªaçš„getterå±æ€§ï¼Œå½“ä½ è®¿é—®è¿™ä¸ªaæ—¶ï¼Œå°±æ˜¯è°ƒç”¨getModuleExportsè¿™ä¸ªå‡½æ•°ï¼Œç„¶ååˆæ‹¿åˆ°äº†&#123;res: 1&#125;ã€‚å¯ä»¥çœ‹å‡ºæ¥å°±æ˜¯è¿™æ ·a: &#123;res: 1&#125; // dæ–¹æ³•è¿”å›çš„å°±æ˜¯getModuleExportsè¿™ä¸ªå‡½æ•°ã€‚ __webpack_require__.n = function (module) &#123; var getter = module &amp;&amp; module.__esModule ? function getDefault() &#123; return module[&#x27;default&#x27;]; &#125; : function getModuleExports() &#123; return module; &#125;; __webpack_require__.d(getter, &#x27;a&#x27;, getter); return getter; &#125;; // Object.prototype.hasOwnProperty.call // å€Ÿç”¨äº†hasOwnPropertyæ–¹æ³•è€Œå·²ã€‚ __webpack_require__.o = function (object, property) &#123; return Object.prototype.hasOwnProperty.call(object, property); &#125;; // __webpack_public_path__ __webpack_require__.p = &#x27;&#x27;; // Load entry module and return exports // å¼€å§‹åŠ è½½å…¥å£å‡½æ•° return __webpack_require__((__webpack_require__.s = &#x27;./src/index.js&#x27;));&#125;)(&#123; &#x27;./src/index.js&#x27;: /*! no exports provided */ function (module, __webpack_exports__, __webpack_require__) &#123; &#x27;use strict&#x27;; eval( &#x27;__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _print__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./print */ &quot;./src/print.js&quot;);\\n/* harmony import */ var _print__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_print__WEBPACK_IMPORTED_MODULE_0__);\\n\\nconsole.log(_print__WEBPACK_IMPORTED_MODULE_0___default.a);\\n\\n//# sourceURL=webpack:///./src/index.js?&#x27; ); // __webpack_require__.r(__webpack_exports__) // 1ã€è¿™é‡Œå…ˆç”¨webpackè‡ªå·±çš„æ¨¡å—åŠ è½½å‡½æ•°æ¥åŠ è½½print.jsï¼Œè¿™é‡Œå‡½æ•°è¿˜æ˜¯ä¼šè¿”å›module.exportsï¼Œåªä¸è¿‡æˆ‘ä»¬çœ‹print.jsæ¨¡å—å‡½æ•°å®ç°å¯ä»¥çœ‹åˆ°exports.res = resã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ‹¿åˆ°çš„å°±æ˜¯&#123;res: 1&#125;è¿™ä¸ªå¯¹è±¡è€Œå·²ã€‚ // var _print__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__( // &#x27;./src/print.js&#x27; // ) // 2. æ‰€ä»¥è¿™é‡Œ__webpack_require__.n(&#123;res: 1&#125;)ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢è¿™ä¸ªnå‡½æ•°å¹²äº†äº›å•¥ï¼Ÿ // var _print__WEBPACK_IMPORTED_MODULE_0___default = __webpack_require__.n( // _print__WEBPACK_IMPORTED_MODULE_0__ // ) // 4. ä¸Šé¢çš„nå‡½æ•°è°ƒç”¨å®Œäº†ï¼Œè¿”å›çš„æ˜¯getModuleExportsè¿™ä¸ªå‡½æ•°ï¼Œä¸”è¿™ä¸ªå‡½æ•°è¿˜æœ‰ä¸ªaå±æ€§çš„getter // 5. èµ‹å€¼ç»™_print__WEBPACK_IMPORTED_MODULE_0___defaultåï¼Œæˆ‘ä»¬å»è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„aå±æ€§ï¼Œä¸è¨€è€Œå–»ï¼Œå°±æ˜¯&#123;res: 1&#125;ã€‚è‡³æ­¤å¤§åŠŸå‘Šæˆï¼ã€‚ // console.log(_print__WEBPACK_IMPORTED_MODULE_0___default.a) &#125;, &#x27;./src/print.js&#x27;: /*! no static exports found */ function (module, exports) &#123; eval( &#x27;var res = 1;\\nexports.res = res;\\n\\n//# sourceURL=webpack:///./src/print.js?&#x27; ); // var res = 1 // å› ä¸ºæºç æ˜¯cjsæ¨¡å—ï¼Œéesæ¨¡å—ï¼Œæ‰€ä»¥æ²¡æœ‰ç»™exportsé…__esModule=trueçš„å±æ€§ï¼ˆè¿™ä¸ªé…ç½®æ˜¯é€šè¿‡__webpack_exports__.rå‡½æ•°å®ç°çš„ï¼‰ // exports.res = res &#125;,&#125;);","categories":[],"tags":[]},{"title":"webpack æ¨¡å—åŒ–åŸç†ï¼ˆES çš„ï¼‰","slug":"2019/es-module","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:31:14.755Z","comments":true,"path":"2019/12/30/2019/es-module/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/es-module/","excerpt":"","text":"å†™äº†ä¸€ä¸ªæœ€ç®€å•çš„ demoï¼Œwebpack é…ç½®ä¹Ÿæ˜¯æœ€ç®€çš„ï¼Œä¸»è¦æ˜¯å¼„æ¸…æ¥š webpack å¦‚ä½•å®ç°æ¨¡å—çš„åŠ è½½ã€‚ 1234567// src/index.jsimport print from &#x27;./print&#x27;;console.log(print);// src/print.jsconst res = 1;export default res; æ¥ä¸‹æ¥é€šè¿‡ webpack æ‰“åŒ…ï¼Œè´´ä¸Šæ‰“åŒ…çš„ä»£ç ï¼ˆå¯¹æ‰“åŒ…çš„ä»£ç ç¨å¾®å¤„ç†äº†ä¸‹ï¼Œå»æ‰äº†ä¸€äº›åˆ†éš”ç¬¦ï¼Œå¹¶ä¸”å°† 2 ä¸ªæ¨¡å—ä¸­çš„ä»£ç æ ¼å¼åŒ–äº†ä¸‹ï¼Œæ‰“åŒ…çš„æ˜¯é€šè¿‡ eval æ¥æ‰§è¡Œçš„ï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175// å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªIIFEå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°modules// è¿™é‡Œçš„moduleså°±æ˜¯æœ€ä¸‹é¢è‡ªæ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­åŒ…å«äº†index.js å’Œ print.jsé€šè¿‡webpackåŠ å·¥åçš„çš„å…·ä½“å®ç°ä»£ç ã€‚(function (modules) &#123; // webpackBootstrap // The module cache // å®˜æ–¹æ³¨é‡Šï¼šæ¨¡å—çš„ç¼“å­˜å¯¹è±¡ï¼Œä¸»è¦æ˜¯å¸Œæœ›åŠ è½½è¿‡çš„æ¨¡å—ä¸åœ¨æ‰§è¡Œç¬¬äºŒéã€‚ var installedModules = &#123;&#125;; // The require function // æ¨¡å—çš„åŠ è½½å‡½æ•°ï¼Œæ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ç°äº†æ¨¡å—çš„åŠ è½½ã€‚ // æ¥æ”¶ä¸€ä¸ªå‚æ•°æ¨¡å—idï¼Œè¿™é‡Œå…¶å®å°±æ˜¯&#x27;./src/index.js&#x27;å’Œ&#x27;./print/index.js&#x27;ã€‚ function __webpack_require__(moduleId) &#123; // Check if module is in cache // ç¬¬ä¸€æ­¥ï¼Œæ£€æŸ¥æ¨¡å—ç¼“å­˜å¯¹è±¡æ˜¯å¦å·²ç»æœ‰è¿‡äº†ï¼Œå¦‚æœæœ‰äº†ï¼Œå°±æ˜¯è¿”å›å‡ºå»ã€‚ if (installedModules[moduleId]) &#123; return installedModules[moduleId].exports; &#125; // Create a new module (and put it into the cache) // å¦‚æœæ²¡æœ‰ï¼Œå°±æŠŠæ¨¡å—åˆ›å»ºå‡ºæ¥ï¼Œå¹¶ä¸”ä¹ŸæŒ‚åˆ°ç¼“å­˜æ¨¡å—å¯¹è±¡installedModulesä¸Šã€‚ // è¿™é‡Œåˆ©ç”¨äº†=çš„è¿”å›å€¼çš„æŠ€å·§ã€‚æ—¢å°†æ¨¡å—å¯¹è±¡&#123;i: xx, l: xx, exports: xx&#125;èµ‹å€¼ç»™äº†ç¼“å­˜æ¨¡å—ä¸Šå¯¹åº”çš„æ¨¡å—keyä¸Šï¼Œä¹Ÿèµ‹å€¼ç»™äº†moduleå˜é‡ var module = (installedModules[moduleId] = &#123; // å°±æ˜¯æ ‡è®°æ¨¡å—çš„IDï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯&#x27;./src/index.js&#x27;ï¼Œ&#x27;./src/main.js&#x27; i: moduleId, // æ¨¡å—æ˜¯å¦åŠ è½½è¿‡ï¼Œä¸€ä¸ªæ ‡å¿—ç¬¦ã€‚ l: false, // æ¨¡å—çš„å…·ä½“å®ç°ï¼Œä¼šæœ‰defaultså’Œå…¶ä»–æœªæŒ‚è½½åˆ°defaultsä¸Šçš„æ–¹æ³•ï¼Œæ¯”å¦‚exports function hello() &#123;&#125; // é‚£ä¹ˆexportså¯¹è±¡å°±ä¼šè¢«å¡«å……ä¸ºexports: &#123;defaults: xxx, hello: xxx&#125; // è‡³äºè¿™é‡Œexportså¯¹è±¡çš„å¡«å……ï¼Œæ˜¯åœ¨æœ€ä¸‹é¢çš„è‡ªæ‰§è¡Œå‡½æ•°ä¼ å‚çš„å‚æ•°ä¸­å†™çš„ã€‚ exports: &#123;&#125;, &#125;); // Execute the module function // æ‰§è¡Œæ¨¡å—å‡½æ•°ï¼Œå¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬æ‰“åŒ…åçš„ä»£ç ï¼ˆæ¯ä¸ªæ¨¡å—ï¼‰éƒ½è¢«å¤„ç†ä¸ºäº†å‡½æ•° // æ­£äº‹å¼€å§‹äº†ï¼Œæ‰§è¡Œæˆ‘ä»¬å†™çš„ä»£ç ã€‚ä½¿ç”¨callæ–¹æ³•ï¼Œå°†thisæŒ‡å‘æ¨¡å—çš„exportsï¼Œå› ä¸ºexportsé‡Œæ‰æ˜¯çœŸæ­£çš„ä»£ç å®ç°ã€‚ // ç„¶åä¼ é€’3ä¸ªå‚æ•°ï¼Œæ¨¡å—æ•´ä½“ï¼Œæ¨¡å—çš„exportsï¼Œè¿˜æœ‰æ¨¡å—åŠ è½½å‡½æ•°ã€‚ modules[moduleId].call( module.exports, module, module.exports, __webpack_require__ ); // Flag the module as loaded // å‡½æ•°æ‰§è¡Œå®Œåï¼Œå°†ä¸Šé¢æœ€å¼€å§‹åˆ›å»ºæ–°æ¨¡å—æ‰€å£°æ˜çš„lï¼Œä¹Ÿå°±æ˜¯æ¨¡å—åŠ è½½æ ‡å¿—ç¬¦è®¾ä¸ºtrueï¼Œå› ä¸ºæ˜¯å¯¹è±¡ï¼Œå¼•ç”¨å…³ç³»ï¼Œç¼“å­˜æ¨¡å—å¯¹è±¡ä¸­å¯¹åº”çš„é‚£ä¸ªæ¨¡å—çš„åŠ è½½æ ‡å¿—ä¹Ÿå·²ç»æ˜¯trueäº† module.l = true; // Return the exports of the module // è¿™æ­¥ä¹Ÿå¾ˆå…³é”®ã€‚ // æµè§ˆå™¨ç›®å‰ä¸è®¤è¯†es6å’Œcjsçš„æ¨¡å—åŠ è½½ï¼Œæ‰€ä»¥æƒ³è¦å®ç°æ¨¡å—çš„åŠ è½½ï¼Œè‚¯å®šæ˜¯é€šè¿‡å‡½æ•°æ¥å®ç°ã€‚ // æ¯ä¸ªæ¨¡å—éœ€è¦æš´éœ²å‡ºè‡ªå·±çš„å€¼æˆ–APIç­‰ï¼Œè€Œä¸Šé¢ä¸€ç›´åœ¨è¯´æ¨¡å—ä»£ç çš„å…·ä½“å®ç°ï¼Œæ˜¯å†™åœ¨exportsé‡Œçš„ï¼Œæ‰€ä»¥ï¼Œæš´éœ²å®ƒï¼Œè®©å…¶ä»–æ¨¡å—èƒ½ä½¿ç”¨è¢«æš´éœ²æ¨¡å—çš„å€¼ã€‚ // åœ¨ä¸‹é¢çš„&#x27;./src/index.js&#x27;ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨webpackæ¨¡å—åŠ è½½å‡½æ•°å¼•å…¥äº†&#x27;./src/print/js&#x27;ï¼Œå¹¶ä¸”ä½¿ç”¨äº†print.jsä¸­çš„å€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯è¿™é‡Œreturnæš´éœ²å‡ºå»çš„ã€‚ return module.exports; &#125; // expose the modules object (__webpack_modules__) // æ¨¡å—éƒ½æŒ‚åˆ°æ¨¡å—åŠ è½½å‡½æ•°çš„å±æ€§mä¸Šã€‚å…·ä½“ä½œç”¨æ²¡çœ‹å‡ºæ¥ã€‚ __webpack_require__.m = modules; // expose the module cache // ç¼“å­˜æ¨¡å—å¯¹è±¡ä¹ŸæŒ‚åˆ°æ¨¡å—åŠ è½½å‡½æ•°çš„cå±æ€§ä¸Šã€‚ __webpack_require__.c = installedModules; // define getter function for harmony exports // å®ç°äº†ä¸€ä¸ªæ–¹æ³•ã€‚çœ‹ç€åƒæ˜¯å®šä¹‰å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œå¹¶å°†è¯¥å±æ€§é…ç½®ä¸ºå¯æšä¸¾ï¼Œä¸”ç»™ä»–äº†ä¸€ä¸ªgetterå®ç°ã€‚ __webpack_require__.d = function (exports, name, getter) &#123; if (!__webpack_require__.o(exports, name)) &#123; Object.defineProperty(exports, name, &#123; enumerable: true, get: getter &#125;); &#125; &#125;; // define __esModule on exports // æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°äº†å¯¹æ¨¡å—çš„ä¸€ä¸ªç±»å‹å®šä¹‰ï¼Œæ˜¯ä¸æ˜¯esæ¨¡å—ã€‚ __webpack_require__.r = function (exports) &#123; if (typeof Symbol !== &#x27;undefined&#x27; &amp;&amp; Symbol.toStringTag) &#123; Object.defineProperty(exports, Symbol.toStringTag, &#123; value: &#x27;Module&#x27; &#125;); &#125; Object.defineProperty(exports, &#x27;__esModule&#x27;, &#123; value: true &#125;); &#125;; // create a fake namespace object // mode &amp; 1: value is a module id, require it // mode &amp; 2: merge all properties of value into the ns // mode &amp; 4: return value when already ns object // mode &amp; 8|1: behave like require // è¿™ä¸ªå‡½æ•°æ²¡çœ‹å‡ºæ¥æœ‰ä»€ä¹ˆä½œç”¨ã€‚ __webpack_require__.t = function (value, mode) &#123; if (mode &amp; 1) value = __webpack_require__(value); if (mode &amp; 8) return value; if (mode &amp; 4 &amp;&amp; typeof value === &#x27;object&#x27; &amp;&amp; value &amp;&amp; value.__esModule) return value; var ns = Object.create(null); __webpack_require__.r(ns); Object.defineProperty(ns, &#x27;default&#x27;, &#123; enumerable: true, value: value &#125;); if (mode &amp; 2 &amp;&amp; typeof value != &#x27;string&#x27;) for (var key in value) __webpack_require__.d( ns, key, function (key) &#123; return value[key]; &#125;.bind(null, key) ); return ns; &#125;; // getDefaultExport function for compatibility with non-harmony modules // è·å–é»˜è®¤å¯¼å‡ºçš„å‡½æ•°ï¼Œå¥½åƒæ˜¯é’ˆå¯¹äºå“ªäº›ä¸åè°ƒçš„æ¨¡å—ã€‚ __webpack_require__.n = function (module) &#123; var getter = module &amp;&amp; module.__esModule ? function getDefault() &#123; return module[&#x27;default&#x27;]; &#125; : function getModuleExports() &#123; return module; &#125;; __webpack_require__.d(getter, &#x27;a&#x27;, getter); return getter; &#125;; // Object.prototype.hasOwnProperty.call // å¯¹è±¡åŸå‹ä¸Šä¸€ä¸ªå‡½æ•°çš„å¤ç”¨è€Œå·²ã€‚ __webpack_require__.o = function (object, property) &#123; return Object.prototype.hasOwnProperty.call(object, property); &#125;; // __webpack_public_path__ __webpack_require__.p = &#x27;&#x27;; // Load entry module and return exports // åŠ è½½å…¥å£å‡½æ•°ï¼Œæ¯”è¾ƒé‡è¦ï¼Œå‰é¢çš„ä¸€äº›è¾…åŠ©å‡½æ•°ç­‰éƒ½å·²ç»å£°æ˜å®Œäº†ã€‚ // è¿™é‡Œå¼€å§‹ä»å…¥å£å‡½æ•°åŠ è½½ï¼Œå¼€å§‹æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç äº†ã€‚ // æ¨¡å—åŠ è½½å‡½æ•°ï¼Œè¿™é‡Œä¹Ÿç”¨äº†=çš„è¿”å›çš„æŠ€å·§ã€‚ // æˆ‘ä»¬å°†&#x27;./src/index.js&#x27;ä»£å…¥åˆ°ä¸Šé¢çš„æ¨¡å—åŠ è½½å‡½æ•°ä¸­å»ï¼Œé€»è¾‘è§£é‡Šå¦‚ä¸‹ï¼š // 1. æ£€æŸ¥ç¼“å­˜æ¨¡å—å¯¹è±¡æ˜¯å¦å·²ç»æœ‰äº†&#x27;./src/index.js&#x27;è¿™ä¸ªé”®åå¯¹åº”çš„æ¨¡å—ï¼Œæœ‰åˆ™è¿”å›å®ƒçš„å…·ä½“å®ç°ï¼Œä¹Ÿå°±æ˜¯exportså¯¹è±¡ã€‚ // 2. å…¥å£å‡½æ•°é¦–æ¬¡å¹¶æ²¡æœ‰è¢«åŠ è½½è¿‡ï¼Œæ‰€ä»¥å¼€å§‹æ‰§è¡Œç”Ÿæˆæ–°æ¨¡å—çš„åŠ¨ä½œã€‚var module = &#123;moduleId: &#x27;./src/index.js&#x27;, l: false, exports: &#123;&#125;&#125; // 3. å¼€å§‹æ‰§è¡Œè¿™ä¸ªæ¨¡å—ä¹Ÿå°±æ˜¯&#x27;./src/index.js&#x27;å¯¹åº”çš„å‡½æ•°ã€‚ç”¨callçš„æ–¹å¼æ¥è°ƒç”¨ï¼Œä¼ é€’äº†3ä¸ªå‚æ•°ã€‚åœ¨ä¸‹é¢çš„index.jså…·ä½“å®ç°ä¸­å¯ä»¥çœ‹åˆ°ã€‚æˆ‘ä»¬æ¥è§£è¯»ã€‚ return __webpack_require__((__webpack_require__.s = &#x27;./src/index.js&#x27;));&#125;)(&#123; &#x27;./src/index.js&#x27;: /*! no exports provided */ function (module, __webpack_exports__, __webpack_require__) &#123; &#x27;use strict&#x27;; eval( &#x27;__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _print__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./print */ &quot;./src/print.js&quot;);\\n\\nconsole.log(_print__WEBPACK_IMPORTED_MODULE_0__[&quot;default&quot;]);\\n\\n//# sourceURL=webpack:///./src/index.js?&#x27; ); // 4. é¦–å…ˆè°ƒç”¨å®šä¹‰æ¨¡å—æ˜¯å¦æ˜¯esçš„å‡½æ•°ï¼Œå°†æˆ‘ä»¬çš„&#x27;./src/index.js&#x27;è¿™ä¸ªæ¨¡å—å¯¹è±¡&#123;moduleId: xx, l: false, exports: &#123;&#125;&#125;åœ¨æ·»åŠ ä¸€ä¸ª__esModule: trueçš„å±æ€§ã€‚çš„ç¡®æˆ‘ä»¬åœ¨å†™ä»£ç æ—¶ä¹Ÿå°±æ˜¯ç”¨çš„esæ¨¡å—ã€‚ // __webpack_require__.r(__webpack_exports__); // 5. æˆ‘ä»¬åœ¨index.jsä¸­å¼•å…¥äº†print.jsï¼Œè¿™é‡Œä½¿ç”¨äº†æ¨¡å—åŠ è½½å™¨å‡½æ•°æ¥åŠ è½½printã€‚åŠ è½½çš„é€»è¾‘è§£æï¼Œã€å¦‚ä¸Šé¢çš„1ï¼Œ2ï¼Œ3æ­¥éª¤ã€‘ã€‚æˆ‘ä»¬è®¤ä¸ºæ˜¯6,7,8ï¼ˆå¼€å§‹æ‰§è¡Œprint.jsä¸­çš„å…·ä½“å®ç°ï¼‰å§ï¼Œæ–¹ä¾¿é€»è¾‘çš„ç»§ç»­ã€‚ // var _print__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(&quot;./src/print.js&quot;); // 13. å•¦å•¦å•¦ï¼Œä¸Šé¢è¿™ä¸€è¡Œï¼Œ__webpack_require__åŠ è½½çš„print.jsï¼Œæ¥ä¸Šäº†ç¬¬12æ­¥æ‰”å‡ºæ¥çš„å¯¹è±¡&#123;default: 1, __esModule: true&#125; // 14. æ‰“å°äº†å¯¹è±¡çš„defaultï¼Œä¹Ÿå°±æ˜¯1ã€‚å¤§å·¥å‘Šæˆã€‚ // console.log(_print__WEBPACK_IMPORTED_MODULE_0__[&quot;default&quot;]); // è¿™é‡Œå› ä¸ºæˆ‘ä»¬åœ¨æºç æ²¡æœ‰åœ¨indexæ¨¡å—æš´éœ²ä»»ä½•ä¸œè¥¿ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œè½¬æ¢åçš„å®ç°ï¼Œwebpackä¹Ÿå¹¶æ²¡æœ‰å¯¹indexæ¨¡å—çš„exportsåšè¿‡å¤šçš„æ”¹é€ ã€‚ // å¥½äº†indexä¹Ÿæ‰§è¡Œå®Œäº†ï¼Œç»ˆäºä¹ŸæŠŠindexæ¨¡å—çš„&#123;l: false&#125; è®¾ä¸º trueäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œprintå…ˆè®¾ä¸ºtrueçš„ï¼Œindexæ˜¯æœ€åï¼Œå› ä¸ºprintçš„è°ƒç”¨å’Œæ‰§è¡Œéƒ½åœ¨indexä¸­åšçš„ï¼Œå±äºindexå‡½æ•°çš„ä¸€éƒ¨åˆ†å“¦ï¼ &#125;, &#x27;./src/print.js&#x27;: /*! exports provided: default */ function (module, __webpack_exports__, __webpack_require__) &#123; &#x27;use strict&#x27;; eval( &#x27;__webpack_require__.r(__webpack_exports__);\\nvar res = 1;\\n/* harmony default export */ __webpack_exports__[&quot;default&quot;] = (res);\\n\\n//# sourceURL=webpack:///./src/print.js?&#x27; ); // 9. å°†print.jsè¿™ä¸ªæ¨¡å—å¯¹è±¡&#123;moduleId: &#x27;./src/print.js&#x27;, l: false, exports: &#123;&#125;&#125;ä¹ŸåŠ ä¸€ä¸ª__esModule: trueçš„å±æ€§æ ‡è®°ã€‚ // __webpack_require__.r(__webpack_exports__); // 10. æˆ‘ä»¬print.jsæºç é‡Œå†™çš„ï¼Œå¯ä»¥çœ‹æœ€ä¸Šé¢çš„2ä¸ªæ–‡ä»¶æºç ã€‚ // var res = 1; // 11. æºç é‡Œæˆ‘ä»¬æ˜¯export defaultå½¢å¼æš´éœ²çš„resã€‚æ‰€ä»¥è¿™é‡Œå¸®æˆ‘ä»¬å°†è¿™ç§æš´éœ²æŒ‚åˆ°äº†exports.defaultä¸Šã€‚ // __webpack_exports__[&quot;default&quot;] = (res); // 12. è¿™æ­¥å®é™…ä¸Šå°±æ˜¯__webpack_require__å‡½æ•°æœ€åçš„returnï¼Œå°†exportså¯¹è±¡æ‰”äº†å‡ºå»ã€‚&#123;default: 1, __esModule: true&#125; // è¿™é‡Œè¦æ³¨æ„ï¼Œæ¨¡å—å‡½æ•°æ‰§è¡Œå®Œäº†ï¼Œæ­¤æ—¶printæ¨¡å—çš„ &#123;l: false&#125; å·²ç»å˜ä¸ºtrueäº†ã€‚ï¼ˆæ¨¡å—åŠ è½½å‡½æ•°ä¸­å†™çš„module.l = trueï¼Œåˆ«å¿˜äº†ã€‚ï¼‰ &#125;,&#125;);","categories":[],"tags":[]},{"title":"node æŸ¥è¯¢å’Œå…³é—­è¿›ç¨‹","slug":"2019/node-process","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:31:26.651Z","comments":true,"path":"2019/12/30/2019/node-process/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/node-process/","excerpt":"","text":"æ‰‹å¤´çš„ electron é¡¹ç›®ï¼Œéœ€è¦æŸ¥è¯¢å¹¶å…³é—­å¦å¤–çš„ç¨‹åºï¼Œç¨‹åºæœ¬èº«è™½ç„¶æ˜¯é€šè¿‡å­è¿›ç¨‹æ–¹å¼å¯åŠ¨ï¼Œä½†æ˜¯å¯åŠ¨çš„ä»…æ˜¯ä¸ªå£³ï¼Œå£³æœ¬èº«åˆè‡ªå·±å¯åŠ¨äº†å¦ä¸€ä¸ªç¨‹åº Zï¼Œå¯¼è‡´æ— æ³•é€šè¿‡å­è¿›ç¨‹å¯åŠ¨åçš„å¥æŸ„æ‹¿åˆ°çœŸæ­£å¯åŠ¨çš„ç¨‹åº Zã€‚æ‰€ä»¥æ— æ³•ç›‘æ§åˆ°ç¨‹åº Z ç›®å‰æ˜¯å¼€å¯è¿˜æ˜¯å…³é—­çš„ã€‚ è§£å†³æ–¹æ³•å°±æ˜¯ node å­è¿›ç¨‹æ¨¡å—çš„ spawn å»æ‰§è¡Œ windows çš„ cmd å‘½ä»¤ã€‚è¯¥é¡¹ç›®åªåœ¨ windows ç”µè„‘è¿è¡Œï¼Œæ‰€ä»¥è¦ç”¨ windows çš„å‘½ä»¤è¡Œè€Œé liunx å‘½ä»¤ã€‚ è¿™é‡Œé¡¹ç›®æœ¬èº«åªåœ¨ windows è¿è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œçš„å‘½ä»¤åº”è¯¥æ˜¯ windows ä¸‹çš„ï¼Œè€Œä¸æ˜¯ linux å‘½ä»¤ã€‚æ¯”å¦‚åˆ—å‡ºå½“å‰ç›®å½•æ–‡ä»¶ï¼Œwindows ä¸‹ç”¨çš„æ˜¯ dir ï¼Œè€Œ linux ä¸‹ç”¨çš„æ˜¯ ls ã€‚ä¸¤è€…æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºæˆ‘çš„ç”µè„‘å®‰è£…äº† cmder ï¼Œå³å¯ä»¥è°ƒç”¨ windows å‘½ä»¤ä¹Ÿå¯ä»¥è°ƒç”¨ linux å‘½ä»¤ã€‚win10 çš„è¯æœ‰ powershellï¼Œå¯èƒ½èƒ½æ”¯æŒ linux å‘½ä»¤ ç›´æ¥åœ¨ cmd é‡Œé¢è¿è¡ŒæŸ¥æ‰¾è¿›ç¨‹çš„å‘½ä»¤çš„è¯ï¼Œæ˜¯è¿™æ ·çš„ï¼š 12tasklist | findstr /i chrome.exe// tasklist æŸ¥æ‰¾ç³»ç»Ÿè¿›ç¨‹åï¼ŒæŸ¥æ‰¾çš„å†…å®¹é€šè¿‡ç®¡é“ç¬¦ | ä¼ é€’ç»™å¦ä¸€ä¸ªå‘½ä»¤ findstr ï¼Œè¿™ä¸ªå‘½ä»¤æ¥æ”¶å‚æ•°ï¼Œè¿™é‡Œæ¥å—äº†å¿½ç•¥å¤§å°å†™ï¼Œç„¶åæŸ¥æ‰¾chrome.exeå…³é”®å­—ï¼Œå¹¶è¿”å›ç»“æœã€‚ è¿™é‡Œçš„ /i æ„å‘³å¿½ç•¥å¤§å°å†™ã€‚ å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥æ‰¾è¿›ç¨‹åå­—å¦‚æœå¾ˆé•¿çš„è¯ï¼Œé€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼ŒæŸ¥æ‰¾å‡ºæ¥çš„è¿›ç¨‹åå­—ä¼šè¢«æˆªå–ï¼Œé™åˆ¶äº† 25 ä¸ªå­—ç¬¦å¥½åƒã€‚æ‰€ä»¥å¯ä»¥åŠ å¦ä¸€ä¸ªå‚æ•°ç»™ tasklistï¼Œ /fo csv ä»¥è¯¥æ¨¡å¼è¾“å‡ºï¼Œé¿å…æŸ¥æ‰¾å‡ºçš„ç»“æœè¢«æˆªå–ã€‚è¿™æ ·æŸ¥æ‰¾åçš„ç»“æœï¼Œæ˜¯è‡ªå¸¦â€â€çš„ï¼Œå¦‚ï¼š &quot;YoudaoDict.exe&quot;,&quot;5324&quot;,&quot;Console&quot;,&quot;1&quot;,&quot;37,028 K&quot; å¼€å§‹è¯´æ­£é¢˜ï¼Œnode çš„å­è¿›ç¨‹æ¨¡å—æä¾›äº† exec å’Œ spawn 2 ç§æ–¹å¼æ¥è°ƒç”¨ï¼Œå…¶ä¸­ exec ä¼šèµ·ä¸€ä¸ª shell æ¥æ‰§è¡Œä¼ å…¥çš„å‚æ•°ï¼Œè€Œ spawn ä¸ä¼šèµ· shellã€‚æ‰€ä»¥ä¸¤ç§æ–¹æ³•è°ƒç”¨æ˜¯æœ‰åŒºåˆ«çš„ã€‚ exec æ–¹å¼12345678exec(`tasklist /fo csv | findstr /i YouDaoDict.exe`, (err, stdout, stderr) =&gt; &#123; if (err) &#123; console.log(`tasklist error: $&#123;err&#125;`); return; &#125; console.log(`stdout $&#123;stdout&#125;`); console.log(`stderr $&#123;stderr&#125;`);&#125;); spawn æ–¹å¼ç›¸æ¯”ä¸Šé¢çš„å†™æ³•ï¼Œç•¥éº»çƒ¦ï¼Œæ³¨æ„ tasklist å’Œ findstr æ˜¯ 2 ä¸ªå‘½ä»¤ï¼Œæ­£å¦‚ä¸Šé¢è§£é‡Šçš„é‚£æ ·ï¼Œæ˜¯ tasklist è¿è¡Œè·å–çš„å€¼ç»™åˆ° findstr åœ¨åšçš„ç­›é€‰ã€‚å› æ­¤é€šè¿‡ spawn çš„æ–¹å¼ï¼Œéœ€è¦è¿™ä¹ˆå†™ï¼š è¿™é‡Œæ¶‰åŠåˆ°äº† stdin stdout çš„ä½¿ç”¨ï¼Œçœ‹èµ·æ¥åƒä¸ªæµï¼Œç®€å•ç†è§£ä¸‹ stdin å°±æ˜¯å‡½æ•°çš„å…¥å‚ï¼Œ stdout å°±æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚ 1234567891011121314151617181920212223242526272829303132333435const &#123; spawn &#125; = require(&#x27;child_process&#x27;);const tasklist = spawn(&#x27;tasklist&#x27;, [&#x27;/fo&#x27;, &#x27;csv&#x27;]);const findstr = spawn(&#x27;findstr&#x27;, [&#x27;/i&#x27;, &#x27;AsmanVR-Win64-Shipping&#x27;]);tasklist.stdout.on(&#x27;data&#x27;, (data) =&gt; &#123; // å¾€findstrçš„è¾“å…¥ä¸­å†™å…¥ tasklistçš„è¾“å‡ºæ•°æ®ã€‚ findstr.stdin.write(data);&#125;);tasklist.stderr.on(&#x27;data&#x27;, (data) =&gt; &#123; console.error(`tasklist stderr: $&#123;data&#125;`);&#125;);tasklist.on(&#x27;close&#x27;, (code) =&gt; &#123; if (code !== 0) &#123; console.log(`tasklistè¿›ç¨‹é€€å‡ºï¼Œé€€å‡ºç ï¼š$&#123;code&#125;`); &#125; findstr.stdin.end();&#125;);findstr.stdout.on(&#x27;data&#x27;, (data) =&gt; &#123; // ç›‘å¬findstrçš„è¾“å‡ºï¼ˆå°±æ˜¯è¿è¡Œè¿”å›çš„ç»“æœï¼‰ console.log(data.toString()); // è¿™é‡Œå°±æ˜¯çœŸæ­£è·å–åˆ°æŸ¥è¯¢ç»“æœçš„åœ°æ–¹ã€‚&#125;);findstr.stderr.on(&#x27;data&#x27;, (data) =&gt; &#123; console.log(`findstr stderr: $&#123;data&#125;`);&#125;);findstr.on(&#x27;close&#x27;, (code) =&gt; &#123; if (code !== 0) &#123; console.log(`findstrè¿›ç¨‹é€€å‡ºï¼Œé€€å‡ºç ï¼š$&#123;code&#125;`); &#125;&#125;);","categories":[],"tags":[]},{"title":"webpack çš„å„ç§æ³¨å…¥æ’ä»¶","slug":"2019/webpack-inject-plugins","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:32:32.720Z","comments":true,"path":"2019/12/30/2019/webpack-inject-plugins/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/webpack-inject-plugins/","excerpt":"","text":"webpack.DefinePlugin ç¼–è¯‘é˜¶æ®µï¼Œå¾€ JS æ³¨å…¥å®šä¹‰çš„å¸¸é‡ã€‚å®é™…ä¸Šå°±æ˜¯å­—ç¬¦ä¸²çš„ä¸€ä¸ªæ›¿æ¢è€Œå·²ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ³¨å…¥çš„æ—¶å€™ï¼Œå¿…é¡»æ³¨å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œéå€¼æœ¬èº«ã€‚ä¾‹å¦‚ 123456789plugins: [ new webpack.DefinePlugin(&#123; BUILD_ENV: &#x27;test&#x27;, BUILD_ENV: JSON.stringify(&#x27;test&#x27;), // å¦‚æœæ˜¯å¸ƒå°”å€¼ IS_TRUE: &#x27;true&#x27;, // ä¸æ˜¯ trueå“¦ï¼ IS_TRUE: JSON.stringify(true), &#125;),]; HtmlWebpackPlugin æ’ä»¶ï¼Œä¼—æ‰€å‘¨çŸ¥æ˜¯æ–¹ä¾¿åˆ›å»ºä¸€ä¸ªé…ç½®å¥½å„ç§è„šæœ¬æ³¨å…¥çš„ HTML æ–‡ä»¶çš„ï¼Œå¯ä»¥è‡ªå·±æä¾›ä¸€ä¸ª HTML æ¨¡æ¿ä½œä¸ºåŸºç¡€ï¼Œç„¶ååœ¨ä¸Šé¢è¿›è¡Œå„ç§æ³¨å…¥ï¼Œæ’ä»¶æ”¯æŒ EJS ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ HTML æ¨¡æ¿é‡Œä½¿ç”¨ &lt;%= HELLO %&gt; ã€‚æ’ä»¶æœ¬èº«æ”¯æŒäº† title å­—æ®µï¼Œä¹Ÿå°±æ˜¯ HTML çš„ title å¯ä»¥è¿›è¡Œæ›¿æ¢ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å…¶ä»–å­—æ®µï¼Œåœ¨ HTML æ¨¡æ¿é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ 123456789plugins: [ new HtmlWebpackPlugin(&#123; inject: true, // æ³¨å…¥JS title: &#x27;æ–‡ç« æ ‡é¢˜&#x27;, // custom key myName: &#x27;Jack&#x27;, flag: true, &#125;),]; 12345678&lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;&lt;% if(htmlWebpackPlugin.options.flag) &#123;%&gt;&lt;script&gt; console.log(&#x27;hello&#x27;);&lt;/script&gt;&lt;% &#125; %&gt; ...&lt;div&gt;&lt;%= myName%&gt;&lt;/div&gt; CRA è„šæ‰‹æ¶æä¾›äº†è‡ªå¸¦çš„ InterpolateHtmlPlugin ï¼Œæä¾›ç±»ä¼¼ä¸Šé¢çš„æ–¹æ³•æ³¨å…¥å˜é‡ï¼Œåªä¸è¿‡æ³¨å…¥åçš„å˜é‡ï¼Œè¿™ä¹ˆç”¨ï¼Œ %PRO_ENV% 12345678&lt;% if (&#x27;%PRO_ENV%&#x27; !== &#x27;pro&#x27; || &#x27;%NODE_ENV%&#x27; !== &#x27;development&#x27;) &#123;%&gt;&lt;script src=&quot;%PUBLIC_URL%/libs/vconsole/vconsole.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt; if (window.engine.isAttached) &#123; var vConsole = new VConsole(); &#125;&lt;/script&gt;&lt;% &#125; %&gt;","categories":[],"tags":[]},{"title":"React å’Œ Redux æŠ€æœ¯æ ˆå¿«é€Ÿæ¥å…¥ TS æŒ‡å—","slug":"2019/ts-react","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:32:14.482Z","comments":true,"path":"2019/12/30/2019/ts-react/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/ts-react/","excerpt":"","text":"TS çš„åŸºæœ¬çŸ¥è¯†è¿™é‡Œä¸åšè¿‡å¤šçš„ä»‹ç»ï¼Œè¯·è‡ªå·±å‚ç…§å…¥é—¨æ–‡æ¡£ï¼šTS å…¥é—¨æ–‡æ¡£ã€‚ æ¨èç›´æ¥ä½¿ç”¨create-react-appç›´æ¥ç”Ÿæˆæ”¯æŒ ts çš„é¡¹ç›®ï¼Œç„¶åè¿›è¡Œ TS ä»£ç æµ‹è¯•ï¼Œcreate-react-app myProject --typescriptã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨ TS å®˜æ–¹æä¾›çš„TS åœ¨çº¿æµ‹è¯•ã€‚ å¸¸ç”¨ React å†…å»ºå¸¸ç”¨ç±»å‹ å»ºè®®å…ˆæµè§ˆä¸€éæœ‰å°è±¡ React.FC&lt;Props&gt;ï¼Œå®šä¹‰å‡½æ•°ç»„ä»¶ç”¨ã€‚ React.Component&lt;Props, State&gt;ï¼Œå®šä¹‰ç±»ç»„ä»¶ç”¨ã€‚ React.ReactNodeï¼Œç”¨æ¥å®šä¹‰å„ç§ react èŠ‚ç‚¹ï¼Œæ¯”å¦‚&lt;div /&gt;, &lt;MyComp /&gt;, this is a just a text, null, 0â€¦ React.CSSPropertiesï¼Œç”¨æ¥å®šä¹‰å†…è”styleçš„ã€‚ React.HTMLProps&lt;HTMLXXXELEMENT&gt;ï¼Œè·å–å†…å»º html å…ƒç´ çš„å±æ€§ã€‚ React.PropsWithChildrenï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä½¿ç”¨ childrenï¼Œä½¿ç”¨è¯¥ç±»å‹åˆ›å»º propsï¼Œå¦‚ï¼šReact.PropsWithChildren&lt;&#123;a: string&#125;&gt;ã€‚ React.ReactEventHandler&lt;HTMLXXXELEMENT&gt;ï¼Œç”¨æ¥æè¿°å…ƒç´ çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚å¯ä»¥è‡ªè¡Œæ¨å¯¼å‡ºé€‚åˆçš„äº‹ä»¶å‡½æ•°æè¿°ã€‚ React.ChangeEventHandler&lt;HTMLXXXELEMENT&gt;ï¼Œæœ€å¸¸è§çš„å¦‚ input çš„ change äº‹ä»¶å‡½æ•°æè¿°ï¼Œäººä¸ºçš„åˆ¤å®šç±»å‹ã€‚åŒºåˆ«äºä¸Šé¢çš„ï¼Œè¿™é‡Œçš„ event å¯ç”¨ event.target.valueï¼Œä¸Šé¢çš„æ˜¯ event.currentTarget.valueã€‚ç±»ä¼¼è¿˜æœ‰MouseEventHandler, MouseEventHandlerç­‰ã€‚ å¸¸ç”¨çš„ TS å†…å»ºå·¥å…·æ³›å‹å’Œå…³é”®å­— å»ºè®®å…ˆæµè§ˆä¸€éæœ‰å°è±¡ typeofå…³é”®å­—ï¼Œè‡ªåŠ¨æ¨æ–­å‡ºç±»å‹ã€‚å¦‚typeof &#123;a: 1, b: &#39;hello&#39;&#125; å¾—åˆ° {a: number, b: string}ã€‚ keyofå…³é”®å­—ï¼Œç±»ä¼¼äºObject.keysã€‚keyof &#123;a: string, b: string&#125;å¾—åˆ°&#39;a&#39; | &#39;b&#39;ã€‚ inå…³é”®å­—ï¼Œç±»ä¼¼äºlet k in objï¼Œéå†ã€‚type Keys = &#39;a&#39; | &#39;b&#39;, type Obj = &#123;[p in Keys]: any&#125;ï¼Œéå†äº† Keysï¼Œp ç›¸å½“äº kï¼Œå¾—åˆ°çš„ Obj = {a: any, b: any}ã€‚ Partial&lt;T&gt;ï¼Œå°† T ç±»å‹å…¨éƒ¨å˜ä¸ºå¯é€‰ã€‚å¦‚Partial&lt;&#123;a: stirng, b: number&#125;&gt; å¾—åˆ° &#123;a: string | undefined, b: number | undefined&#125;ã€‚ Omit&lt;P, K&gt;ï¼Œä» P ä¸­æ’é™¤ Kï¼Œè¿”å›æ’é™¤åçš„ç»“æœã€‚å¦‚Omit&lt;&#123;a: string, b: number&#125;, &#39;a&#39;&gt; å¾—åˆ° &#123;b: number&#125;ã€‚ Pick&lt;T, K&gt;ï¼Œä» T ä¸­æŒ‘é€‰å‡º Kã€‚å¦‚Pick&lt;&#123;a: 1, b: 2, c: 3&#125;, &#39;a&#39; | &#39;b&#39; å¾—åˆ°&#123;a: 1, b: 2&#125;ã€‚ï¼ˆè¿™é‡Œç±»å‹å€¼å†™çš„æ˜¯ number ç±»å‹çš„æ•°å­—ï¼ŒTS ä¼šæ¨æ–­å‡º number ç±»å‹ï¼‰ã€‚ Exclude&lt;T, U&gt;ï¼Œä»ç±»å‹ T ä¸­æ’é™¤ä¸åœ¨ç±»å‹ U ä¸­çš„ã€‚å¦‚Exclude&lt;&#39;a&#39; | &#39;b&#39;, &#39;b&#39; | &#39;c&#39;&gt; å¾—åˆ° &#39;a&#39;ï¼Œå¦‚Exclude&lt;&#123;a: 1, b:2&#125;, &#123;a: 1, b:2, c: 3&#125;&gt; å¾—åˆ° &#123;a: 1, b: 2&#125;ã€è¿™é‡Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼šT å±äº U çš„ä¸€ç§å…·ä½“å®ç°åˆ™è¿”å› neverï¼Œä¸æ˜¯åˆ™è¿”å› Tã€‘ã€‚è‡ªå·±å®ç°type Exc&lt;T, U&gt; = T extends U ? never: Tã€‚ Extract&lt;T, U&gt;ï¼Œä»ç±»å‹ T ä¸­æå–å‡ºå¯ä»¥åˆ†é…ç»™ç±»å‹ U çš„éƒ¨åˆ†ã€‚å¦‚Extract&lt;&#39;a&#39; | &#39;b&#39;, &#39;b&#39; | &#39;c&#39;&gt; å¾—åˆ° &#39;b&#39;ï¼Œå¦‚Extract&lt;&#123;a: 1, b:2&#125;, &#123;a: 1, b:2, c: 3&#125;&gt; å¾—åˆ° neverã€‚ã€è¿™é‡Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼šT å±äº U çš„ä¸€ç§å…·ä½“å®ç°ï¼Œåˆ™è¿”å› Tï¼Œä¸æ˜¯åˆ™è¿”å› neverã€‘ã€‚è‡ªå·±å®ç°type Ext&lt;T, U&gt; = T extends U ? T : neverã€‚ é React æŠ€æœ¯æ ˆçš„å¸¸è§çš„ TS ç”¨æ³•ç±»å‹é¢„æµ‹iså…³é”®å­—ã€‚å¸¸ç”¨åœºæ™¯ï¼Œæ˜ç¡®ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹åï¼Œä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•ã€‚ 123function do(str) &#123; return str.length; // å¦‚æœ str æ˜¯ numberç±»å‹ï¼Œå°±ä¼šæŠ¥é”™ã€‚&#125; 12345// è¿™æ ·å†™åªèƒ½åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå½“ä½ ä¼ é€’çš„å‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹è€ŒæŠ¥é”™æç¤ºã€‚// å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ç»è¿‡è®¡ç®—æˆ–è€…å¼‚æ­¥è·å–ï¼Œæ— æ³•ä¿è¯æ—¶ï¼Œè¿è¡Œæ—¶ä¼šå¾ˆå¤§æ¦‚ç‡æŠ¥é”™ã€‚function do(str: string) &#123; return str.length;&#125; 123456function do(str: string) &#123; if (typeof str === &#x27;string&#x27;) &#123; // åšå¥½ç±»å‹åˆ¤æ–­åç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½ä¸ä¼šæŠ¥é”™ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½åˆ¤æ–­çš„è¯ï¼Œä»£ç å˜å¤šæœ‰ç‚¹éº»çƒ¦ã€‚ return str.length; &#125;&#125; é€šå¸¸ä¼šå°è£…ä¸€ä¸ªåˆ¤æ–­å‡½æ•° 12345678910// ä¸€ä¸ªåˆ¤æ–­å‡½æ•°function isString(val) &#123; return typeof val === &#x27;string&#x27;;&#125;function do(str: string) &#123; // è°ƒç”¨åˆ¤æ–­å‡½æ•° if (isString(str)) &#123; return str.length; &#125;&#125; 1234567// å¦‚æœdoå‡½æ•°çš„å…¥å‚æ— æ³•ç¡®è®¤ç±»å‹ã€‚æˆ‘ä»¬é€šå¸¸ä¼šç”¨anyã€‚function do(str: any) &#123; // è¿™é‡ŒTSå·²ç»å¿½ç•¥äº†å…¥å‚ç±»å‹ã€‚ if (isString(str)) &#123; return str.length; // å¦‚æœæ— lengthå±æ€§ä¹Ÿä¸ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™ï¼Œè¿™è·Ÿæˆ‘ä»¬ä½¿ç”¨TSçš„æ„¿æ™¯ä¸ä¸€è‡´ã€‚ &#125;&#125; 123456789// ä½¿ç”¨ç±»å‹é¢„æµ‹ str is stringã€‚function isString(str: any): str is string &#123; return typeof val === &#x27;string&#x27;&#125;function do(val: any) &#123; if(isString(val)) &#123; // è¿™é‡Œåœ¨è¿è¡Œæ—¶é˜¶æ®µä¹Ÿä¼šåˆ¤æ–­æ˜¯å¦æ˜¯æ˜¯stringï¼Œå†å†³å®šè¿›å…¥ifå†…çš„æ‰§è¡Œä»£ç ã€‚ return str.length // è¿™é‡Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ˆä¹¦å†™æ—¶ï¼‰ä¼šè·å¾—stringç±»å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•æç¤ºã€‚ &#125;&#125; str is string èƒ½å¦æ”¹ä¸º: booleanï¼Œå³ isString è¿”å›çš„æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Ÿä¸èƒ½ã€‚æ”¹æˆå•ä¸€çš„å¸ƒå°”ç±»å‹åï¼Œæ— æ³•è·å¾—æœŸæœ›çš„ string ç±»å‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•æ¨æ–­ã€‚ React å¸¸è§å†™æ³•å‡½æ•°ç»„ä»¶å†™æ³•123const FcComp: React.FC&lt;&#123; prop1: string &#125;&gt; = (&#123; prop1 &#125;) =&gt; &#123; return &lt;div&gt;&#123;prop1&#125;&lt;/div&gt;;&#125;; ç±»ç»„ä»¶å†™æ³•1234567891011interface IProps &#123; name: string;&#125;interface IState &#123; age: number;&#125;class ClsComp extends React.Component&lt;IProps, IState&gt; &#123; state = &#123; age: 18, &#125;;&#125; é»˜è®¤å‚æ•°å†™æ³•1234567891011121314151617interface IProps extends IDefaultProps &#123; name: string;&#125;type IDefaultProps = typeof DefComp.defaultProps; // è·å–åˆ°é»˜è®¤å±æ€§çš„typeç­¾åclass DefComp extends React.Component&lt;IProps, State&gt; &#123; static defaultProps = &#123; work: &#x27;docter&#x27;, &#125;; render() &#123; return ( &lt;div&gt; &#123;this.props.name&#125; is &#123;this.props.work&#125; &lt;/div&gt; ); &#125;&#125; å…¶ä»–å†™æ³•å‚ç…§é¡¹ç›®ä¸­defaultPropsæ–‡ä»¶å¤¹ é€šç”¨ç»„ä»¶å†™æ³•è¿™é‡Œæè¿°ä¸€ä¸ªæœ€å¸¸è§çš„æƒ…æ™¯ï¼Œä¸€ä¸ªåˆ—è¡¨ç»„ä»¶ã€‚åˆ©ç”¨æ³›å‹ï¼ˆé˜…è¯»å…¥é—¨ TS æ³›å‹éƒ¨åˆ†ï¼‰å®ç°ã€‚ 123456789101112131415161718// ç»„ä»¶å®šä¹‰interface IProps&lt;T&gt; &#123; lists: T[] renderItem: (item: T) =&gt; React.ReactNode // æœ€å¥½éƒ½ç”¨ReactNodeï¼Œè€Œä¸æ˜¯JSX.Elementã€‚&#125;class List&lt;T&gt; extends React.Component&lt;IProps&lt;T&gt;, &#123;&#125;&gt; &#123; render() &#123; const &#123;lists, renderItem&#125; = this.props return ( &lt;&gt; &lt;ul&gt;&#123;lists.map(renderItem)&#125;&lt;/ul&gt; &lt;/&gt; ) &#125;&#125;// è°ƒç”¨ç»„ä»¶ã€‚æ³¨æ„ï¼šè¿™é‡ŒListä¼ å…¥äº†ä¸€ä¸ªç±»å‹numberï¼Œé™åˆ¶äº†æ³›å‹Tçš„ç±»å‹ã€‚&lt;List&lt;number&gt; lists=&#123;[1, 2, 3]&#125; renderItem=&#123;item =&gt; &lt;li key=&#123;item&#125;&gt;&#123;item&#125;&lt;/li&gt;&#125;/&gt; é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰å†™æ³• React çš„é«˜é˜¶ç»„ä»¶å³ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚ è¿™é‡Œå†™ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ª withState å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ²¡æœ‰ count çŠ¶æ€çš„ç»„ä»¶ï¼ŒåŒ…è£…åï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰ count çŠ¶æ€çš„ç»„ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142/* withState.tsx */export interface InjectedProps &#123; count: number, onIncrement: () =&gt; void&#125;export const withState = &lt;P extends InjectedProps&gt;(WrappedComp: React.ComponentType&lt;P&gt;) =&gt; &#123; // ä½¿ç”¨Omitç»“åˆkeyofï¼Œå®ç°æ’é™¤æ‰IPropå’ŒInjectedPropsäº¤é›†çš„éƒ¨åˆ†(count, onIncrement) type HocProps = Omit&lt;IProp, keyof InjectedProps&gt; &amp; &#123; // è¿™é‡Œå¯ä»¥åšHOCçš„Propsçš„æ‰©å±•ã€‚ initialCount?: number &#125; type HocState = &#123; readonly count: number &#125; return class Hoc extends React.Component&lt;HocProps, HocState&gt; &#123; // ç»„ä»¶çš„åå­—ï¼Œæ–¹ä¾¿è°ƒè¯• static displayName = `withState($&#123;WrappedComp.name&#125;)` state: HocState = &#123; count: Number(this.props.initialCount) || 0 &#125; handleInc = () =&gt; &#123; this.setState(&#123; count: this.state.count + 1 &#125;) &#125; render() &#123; const &#123; ...restProps &#125; = this.props const &#123; count &#125; = this.state return ( &lt;WrappedComp count=&#123;count&#125; onIncrement=&#123;this.handleInc&#125; // HOCç»„ä»¶ï¼Œåº”è¯¥é€ä¼ ä¸HOCæ— å…³çš„Propç»™è¢«åŒ…è£¹çš„ç»„ä»¶ã€‚è¿™é‡Œçš„å†™æ³•æ˜¯å› ä¸ºTSæœ¬èº«çš„BUGï¼Œå¦‚æœä¸æ–­è¨€ï¼Œåˆ™ç±»å‹æŠ¥é”™ã€‚ &#123;...(restProps as IProp)&#125; &gt;&lt;/WrappedComp&gt; ) &#125; &#125;&#125; 123456789101112131415/* FcCounter.tsx */export const FcCounter: React.FC&lt;Props&gt; = (props) =&gt; &#123; const &#123; label, count, onIncrement &#125; = props; const handleIncrement = () =&gt; &#123; onIncrement(); &#125;; return ( &lt;div&gt; &lt;span&gt; &#123;label&#125;:&#123;count&#125; &lt;/span&gt; &lt;button type=&quot;button&quot; onClick=&#123;handleIncrement&#125;&gt;&#123;`Increment`&#125;&lt;/button&gt; &lt;/div&gt; );&#125;; 1234567/* è°ƒç”¨ç»„ä»¶ */import &#123; FcCounter &#125; from &#x27;./FcCounter&#x27;import &#123; withState &#125; from &#x27;./withState&#x27;const HocCounterWithState = withState(FcCounter)&lt;HocCounterWithState initialCount=&#123;10&#125; label=&quot;HocCounterWithState&quot; /&gt; é»˜è®¤ props çš„å†™æ³•123456789101112131415161718192021222324252627282930313233343536373839// ç±»ç»„ä»¶å†™æ³•interface IProps extends defaultProps &#123; age: number;&#125;// ä½¿ç”¨typeofè·å–åˆ°ç±»ç»„ä»¶çš„é»˜è®¤å‚æ•°ç±»å‹type defaultProps = typeof DefaultPropsComp.defaultProps;class DefaultPropsComp extends React.Component&lt;IProps&gt; &#123; static defaultProps = &#123; name: &#x27;jack&#x27;, &#125;; echoProps = () =&gt; &#123; // è¿™é‡Œä¹Ÿå¯ä»¥è·å¾—TSæç¤º const &#123; age, name &#125; = this.props; &#125;; render() &#123; return &lt;p&gt;this is how to set default props of class component&lt;/p&gt;; &#125;&#125;// å‡½æ•°ç»„ä»¶å†™æ³•const defaultProps = &#123; work: &#x27;doctor&#x27;,&#125;;interface IProps extends defaultPropsType &#123; age: number;&#125;type defaultPropsType = typeof defaultProps;function DefaultPropsFC(props: IProps) &#123; // è¿™é‡Œå¯ä»¥è·å¾—æç¤º const &#123; work, age &#125; = props; return &lt;p&gt;&#123;`The $&#123;work&#125; is $&#123;age&#125;`&#125;&lt;/p&gt;;&#125;// æ³¨æ„ï¼šä¸€å®šè¦æŒ‚è½½é»˜è®¤å±æ€§ï¼Œå¦åˆ™è°ƒç”¨ç»„ä»¶çš„åœ°æ–¹é»˜è®¤å€¼ä¹Ÿéœ€è¦ä¼ å…¥DefaultPropsFC.defaultProps = defaultProps; æ–­è¨€ç®€å•ç†è§£ä¸ºå¯ä»¥ 100%ç¡®å®šæ˜¯ä»€ä¹ˆç±»å‹ï¼Œè®© TS æŒ‰ç…§ç¡®å®šçš„ç±»å‹æ¥è¿›è¡Œ TS æç¤ºï¼Œæ¨æ–­ç­‰ã€‚ JSX ä¸­åªæ”¯æŒç”¨ as æ–­è¨€å†™æ³•ã€‚ä¸æ”¯æŒ**&lt;&gt;**å†™æ³•ï¼Œå¦‚var a = &lt;string&gt;bã€‚è·Ÿ jsx å†²çªï¼Œä¼šå½“æˆæ ‡ç­¾ã€‚ 123456789101112131415161718192021222324252627type UserA = &#123; name: string, age: number&#125;type UserB = &#123; name: string, sex: string&#125;type IProps = &#123; user: UserA | UserB&#125;class AssertComp extends React.Component&lt;IProps, &#123;&#125;&gt; &#123; render() &#123; // è¿™é‡Œå¦‚æœä¸åšç±»å‹æ–­è¨€ï¼Œä¼šæç¤ºUserAä¸Šæ²¡æœ‰sexå±æ€§ // const user = this.props.user const userB = this.props.user as UserB const userA = this.props.user as UserA return &lt;div&gt; &lt;p&gt;this is a user: &#123;userA.age&#125;&lt;/p&gt; &lt;p&gt;this is a user: &#123;userB.sex&#125;&lt;/p&gt; &lt;/div&gt; &#125;&#125; Context å†™æ³•ç”¨ React å®˜æ–¹ DOC é‡Œçš„æ›´æ”¹æŒ‰é’®é¢œè‰²ä¸»é¢˜åšä¾‹å­ã€‚ 12345678910111213141516171819202122232425/* ctx.tsx */export type Theme = React.CSSPropertiestype Themes = &#123; dark: Theme light: Theme&#125;export const themes: Themes = &#123; dark: &#123; color: &#x27;black&#x27;, backgroundColor: &#x27;white&#x27; &#125;, light: &#123; color: &#x27;white&#x27;, backgroundColor: &#x27;black&#x27; &#125;&#125;// è¿™é‡Œå®šä¹‰Contextçš„ç­¾åexport type ThemeContextProps = &#123; theme: Theme; toggleTheme?: () =&gt; void &#125;// createContext&lt;T&gt;éœ€è¦ä¸€ä¸ªç±»å‹ï¼ŒæŠŠå®šä¹‰å¥½çš„Contextç­¾åä¼ é€’è¿›å»const ThemeContext = React.createContext&lt;ThemeContextProps&gt;(&#123; theme: themes.light&#125;) 12345678910111213141516171819202122/* themeButton.tsx */import ThemeContext from &#x27;./ctx&#x27;// contextType v16.6+æ”¯æŒexport default class ToggleThemeButton extends React.Component&lt;&#123;&#125;&gt; &#123; static contextType = ThemeContext // åé¢éœ€è¦é€šè¿‡this.contextè®¿é—®åˆ°ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å®šä¹‰ä¸€ä¸ªç±»å±æ€§ // è¿™é‡Œä½¿ç”¨!æ˜ç¡®å‘Šè¯‰TSï¼Œè¯¥å‚æ•°ä¸€å®šæœ‰ã€‚ // è¿™é‡Œä¸èƒ½ä½¿ç”¨ï¼Ÿï¼Œå› ä¸ºcontextæ˜¯å¿…é€‰é¡¹ context!: React.ContextType&lt;typeof ThemeContext&gt; render() &#123; // å‰é¢contextå¿…é¡»è¿™ä¹ˆå†™ï¼Œè¿™é‡Œæ‰èƒ½è·å–TSæç¤º const &#123; theme, toggleTheme &#125; = this.context return ( &lt;button style=&#123;theme&#125; onClick=&#123;toggleTheme&#125; &#123;...this.props&#125;&gt; button &lt;/button&gt; ) &#125;&#125; 12345678910111213141516171819202122232425/* providerç»„ä»¶ */import ThemeContext, &#123; Theme, themes &#125; from &#x27;./ctx&#x27;;import ThemeButton from &#x27;./themeButton&#x27;;export default class ThemeProvider extends React.Component&lt;&#123;&#125;, State&gt; &#123; state: State = &#123; theme: themes.light, &#125;; toggleTheme = () =&gt; &#123; this.setState((state) =&gt; (&#123; theme: state.theme === themes.light ? themes.dark : themes.light, &#125;)); &#125;; render() &#123; const &#123; theme &#125; = this.state; const &#123; toggleTheme &#125; = this; return ( &lt;ThemeContext.Provider value=&#123;&#123; theme, toggleTheme &#125;&#125;&gt; &lt;ThemeButton /&gt; &lt;/ThemeContext.Provider&gt; ); &#125;&#125; å¤šç±»å‹å‚æ•°ï¼ˆé‡è½½ï¼‰å‡è®¾ç»„ä»¶æ¥æ”¶ 2 ç§ç±»å‹çš„ propsã€‚å¯ä»¥ä¼ &#123;a: string, config?: number&#125;ï¼Œæˆ–è€…&#123;b: string&#125;ã€‚ä¼ é€’ config æ—¶ï¼Œè¯´æ˜æ˜¯ç”¨çš„ç¬¬ä¸€ç§ç±»å‹ Propsï¼Œä¹Ÿä¸€å®šéœ€è¦ä¼ é€’ a. 123456789101112131415161718192021222324252627282930313233343536373839404142434445// å®šä¹‰typestype CommonProps = &#123; children: React.ReactNode as: &#x27;p&#x27; | &#x27;span&#x27; | &#x27;h1&#x27;&#125;type NoTrucateProps = CommonProps &amp; &#123; truncate?: false&#125;type TrucateProps = CommonProps &amp; &#123; truncate: true expanded?: boolean&#125;// å®šä¹‰ä¸€ä¸ªç±»å‹åˆ¤æ–­ï¼Œè¿è¡Œæ—¶å¯ç”¨ï¼Œè¿™é‡Œä½¿ç”¨äº†isæŠ€å·§ã€‚const isTrucateProps = ( props: TrucateProps | NoTrucateProps): props is TrucateProps =&gt; &#123; return !!props.truncate&#125;// è¿™é‡Œæ˜¯å…³é”®ï¼Œå‡½æ•°é‡è½½ï¼Œçº¦å®šå…¥å‚å’Œåå‚ã€‚ï¼ˆå¹¶ä¸æ˜¯å…·ä½“ä»£ç å®ç°ï¼‰è°ƒç”¨ç»„ä»¶çš„åœ°æ–¹å³å¯è·å–æ­£ç¡®æç¤ºã€‚function Text(props: NoTrucateProps): JSX.Elementfunction Text(props: TrucateProps): JSX.Element// è¿™é‡Œæ‰æ˜¯Textå‡½æ•°çš„çœŸæ­£å®ç°ã€‚function Text(props: NoTrucateProps | TrucateProps) &#123; console.log(props) if (isTrucateProps(props)) &#123; const &#123; children, as: Tag, truncate, expanded, ...others &#125; = props const classNames = truncate ? &#x27;.truncate&#x27; : &#x27;&#x27; return ( &lt;Tag className=&#123;classNames&#125; aria-expanded=&#123;!!expanded&#125; &#123;...others&#125;&gt; &#123;children&#125; &lt;/Tag&gt; ) &#125; const &#123; children, as: Tag, ...others &#125; = props return &lt;Tag &#123;...others&#125;&gt;&#123;children&#125;&lt;/Tag&gt;&#125;Text.defaultProps = &#123; as: &#x27;p&#x27;&#125; 123// è°ƒç”¨åœ°// è¿™é‡Œä¼ é€’äº†expandedï¼Œä½†æœªä¼ å…¥truncateï¼Œä¼šè·å¾—æç¤ºã€‚^_^&lt;OptionalProps expanded&gt;truncate-able but expanded&lt;/OptionalProps&gt; é›¶ç¢ï¼Œä½†é¢‘ç‡é«˜çš„ React ç”¨æ³•åŒ…æ‹¬ï¼šstyle æ ·å¼å®šä¹‰ï¼Œæ¥æ”¶ React èŠ‚ç‚¹å®šä¹‰ï¼Œäº‹ä»¶å‡½æ•°å®šä¹‰ï¼Œå›ºå®šå¯é€‰å‚æ•°é…ç½®ï¼Œç±»å±æ€§å®šä¹‰ï¼ŒRef å®šä¹‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768/* usefulReactProp.tsx */interface IProps extends DefaultProps &#123; descText: string // åŸºæœ¬çš„ç±»å‹ style?: React.CSSProperties // å¯ä»¥åœ¨è°ƒç”¨ç»„ä»¶çš„åœ°æ–¹ï¼Œè·å¾—styleçš„å®Œç¾æç¤ºã€‚ additionDom?: React.ReactNode // æ¥æ”¶ä»»ä½•ç±»å‹çš„ReactèŠ‚ç‚¹ renderReactNode?: () =&gt; React.ReactNode // æ¥æ”¶ä¸€ä¸ªä»¥å‡½æ•°æ–¹å¼è¿”å›çš„ReactèŠ‚ç‚¹ onChange: React.FormEventHandler&lt;HTMLInputElement&gt; // ä¼˜å…ˆæ¨èè¿™ç§å†™æ³•ï¼Œè®©TSè‡ªå·±æ¨æ–­ã€‚ä¸‹é¢çš„æ–¹æ³•å®šä¹‰åŒæ ·å¯ä»¥ã€‚ // onChange: (event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; void buttonSize: &#x27;small&#x27; | &#x27;middle&#x27; | &#x27;big&#x27; // å¯é€‰å‚æ•°&#125;type DefaultProps = typeof UsefulReactProp.defaultPropsinterface IState &#123; value: string&#125;export default class UsefulReactProp extends React.Component&lt;IProps, IState&gt; &#123; static defaultProps = &#123; initVal: &#x27;è¾“å…¥å†…å®¹&#x27; &#125; // å®šä¹‰ä¸€ä¸ªdomå¼•ç”¨ã€‚ä½¿ç”¨å¦‚ä¸‹å®šä¹‰æ–¹å¼ static aDom = React.createRef&lt;HTMLDivElement&gt;() // å®šä¹‰ä¸€ä¸ªç±»å±æ€§ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶åœ¨èµ‹å€¼ä½¿ç”¨ static classProp?: string // å®šä¹‰ä¸€ä¸ªç±»å±æ€§ï¼Œåœ¨å®šä¹‰æ—¶å³å¤åˆ¶ static classProp2 = &#x27;hello&#x27; state = &#123; value: this.props.initVal &#125; defaultOnChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; &#123; const &#123; onChange &#125; = this.props this.setState(&#123; value: e.target.value &#125;) this.classProp = &#x27;hello world&#x27; onChange(e) &#125; render() &#123; const &#123; onChange, style, additionDom, renderReactNode &#125; = this.props const &#123; value &#125; = this.state // å¦‚ä¸‹ä»£ç æç¤ºåªæœ‰3ç§ä¸Šè¿°å®šä¹‰è¿‡çš„å€¼ã€‚ const btnSize = this.props.buttonSize === &#x27;big&#x27; ? &#x27;100px&#x27; : this.props.buttonSize === &#x27;small&#x27; ? &#x27;60px&#x27; : &#x27;80px;&#x27; return ( &lt;div&gt; &lt;input type=&quot;text&quot; value=&#123;value&#125; onChange=&#123;this.defaultOnChange&#125; /&gt; &lt;p className=&quot;desc&quot; style=&#123;style&#125;&gt; è¿™æ˜¯ä¸ªå¸¦æ ·å¼çš„æé†’ &lt;/p&gt; &lt;div className=&quot;additional&quot;&gt;&#123;additionDom&#125;&lt;/div&gt; &lt;div className=&quot;by-func-rcnode&quot;&gt; &#123;renderReactNode ? renderReactNode() : null&#125; &lt;/div&gt; &lt;button style=&#123;&#123; width: btnSize &#125;&#125;&gt;æŒ‰é’®å°ºå¯¸ï¼šè”åˆç±»å‹æç¤º&lt;/button&gt; &lt;/div&gt; ) &#125;&#125; 1234567891011121314/* è°ƒç”¨ */// å¦‚ä¸‹éƒ½å¯ä»¥è·å–ç±»å‹æç¤ºã€‚&lt;UsefulReactProp descText=&quot;ä¸€ä¸ªç®€å•çš„æè¿°&quot; onChange=&#123;(e) =&gt; &#123; console.log(e.currentTarget.value); &#125;&#125; style=&#123;&#123; fontSize: 14, fontWeight: &#x27;bold&#x27; &#125;&#125; additionDom=&#123;&lt;p&gt;this is additional tag&lt;/p&gt;&#125; renderReactNode=&#123;() =&gt; &#123; return &lt;p&gt;è¿™æ˜¯é€šè¿‡å‡½æ•°è¿”å›çš„ReactNode&lt;/p&gt;; &#125;&#125; buttonSize=&quot;big&quot;/&gt;","categories":[],"tags":[]},{"title":"React PureComponent çš„æµ…æ¯”è¾ƒ","slug":"2019/react-purecompent-diff","date":"2019-12-29T16:00:00.000Z","updated":"2021-11-06T07:31:45.034Z","comments":true,"path":"2019/12/30/2019/react-purecompent-diff/","link":"","permalink":"https://690554125.github.io/2019/12/30/2019/react-purecompent-diff/","excerpt":"","text":"åœ¨ä½¿ç”¨ antd çš„ form ç»„ä»¶æ—¶ï¼Œä½¿ç”¨åˆ°äº† getFiledDecorator å»åŒ…è£…äº†è¡¨å•ç»„ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªè¡¨å•ç»„ä»¶æ˜¯é¢œè‰²é€‰æ‹©å™¨ï¼Œé¢œè‰²é€‰æ‹©å™¨è¿™ä¸ªè¡¨å•ç»„ä»¶æ˜¯æŒ‰ antd è‡ªå®šä¹‰è¡¨å•ç»„ä»¶çš„æ–¹å¼ï¼ŒåŒæ—¶è¯¥ç»„ä»¶ä¹Ÿæ˜¯ç”¨ PureComponent å£°æ˜çš„ã€‚ ç„¶åæˆ‘åœ¨ä½¿ç”¨ setFiledValue å»ä¿®æ”¹å¦ä¸€ä¸ªè¡¨å•ç»„ä»¶ A çš„å€¼æ—¶ï¼Œå‘ç°ï¼Œä¹Ÿä¼šè§¦å‘é¢œè‰²é€‰æ‹©å™¨ç»„ä»¶çš„ render ã€‚åŸä»¥ä¸ºåªä¼šè§¦å‘æˆ‘ä¿®æ”¹çš„ A çš„æ¸²æŸ“æ‰å¯¹ã€‚ æµ‹è¯•å‘ç°ï¼Œå¦‚æœä¸ä½¿ç”¨ getFiledDecorator çš„è¯ï¼Œæ˜¯ä¸ä¼šç»™ç»„ä»¶æ·»åŠ é¢å¤–çš„ props çš„ï¼Œæ­¤æ—¶ä½ å»ä¿®æ”¹ A ç»„ä»¶çš„å€¼ï¼Œé¢œè‰²é€‰æ‹©å™¨é…åˆ PureComponent å£°æ˜çš„æ–¹å¼ï¼Œæ¥æ”¶åˆ°çš„æ–°æ—§ props éƒ½æ˜¯ &#123;&#125; ã€‚å¦‚æœä½¿ç”¨äº† getFieldDecorator è¿›è¡ŒåŒ…è£…çš„è¯ï¼Œå³ä¾¿æ˜¯ PureComponent ä¹Ÿä¼šæ¸²æŸ“ç»„ä»¶ï¼Œå¾—åˆ°çš„æ–°æ—§ props å¦‚ä¸‹ï¼š ç„¶åæ‰¾äº†ä¸‹ PureComponent ç»„ä»¶é»˜è®¤çš„æµ…æ¯”è¾ƒæ–¹å¼ï¼Œå‘ç°çš„ç¡®ä¼šå‡ºç°ä»¥ä¸Šæè¿°çš„æƒ…å†µã€‚ è‡ªå¸¦çš„æµ…æ¯”è¾ƒå‡½æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­ is å‡½æ•°æ˜¯ Object.is çš„å®ç°ï¼Œåªä¸è¿‡å¤„ç†äº† 2 ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œå³è®© +0 === -0 , è®© NaN !== NaN ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243if (ctor.prototype &amp;&amp; ctor.prototype.isPureReactComponent) &#123; // å…ˆåˆ¤æ–­ç»„ä»¶æ˜¯å¦ç»§æ‰¿çš„PureComponent return !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState);&#125;function shallowEqual(objA: mixed, objB: mixed): boolean &#123; if (is(objA, objB)) &#123; // å…ˆç”¨Reactå®ç°çš„Object.iså»æ¯”è¾ƒ2ä¸ªå‚æ•°ï¼ŒåŸºæœ¬æ˜¯åŒç±»å‹ï¼ŒåŒå€¼ï¼ŒåŒå¼•ç”¨çš„æ¯”è¾ƒï¼Œå¦‚æœä¸åŒï¼Œåœ¨å¾€ä¸‹æ¯”è¾ƒã€‚ return true; &#125; // å¦‚æœæœ‰ä¸€ä¸ªå‚æ•°çš„ç±»å‹æ˜¯å¯¹è±¡ï¼Œåˆ™è‚¯å®šæ˜¯ä¸ç›¸ç­‰çš„ï¼ˆä»”ç»†ç†è§£ç¬¬ä¸€ä¸ªifçš„æ¯”è¾ƒï¼ŒåŒç±»å‹åŒå€¼åŒå¼•ç”¨ï¼Œå¦‚æœå¼•ç”¨ä¸åŒï¼Œè‚¯å®šä¸ç­‰ï¼Œé‚£å¯¹è±¡å’ŒJSçš„åŸºæœ¬ç±»å‹æ›´ä¸å¯èƒ½ç›¸ç­‰ï¼‰ if ( typeof objA !== &#x27;object&#x27; || objA === null || typeof objB !== &#x27;object&#x27; || objB === null ) &#123; return false; &#125; // æµ…æ¯”è¾ƒå¯¹è±¡å¼•ç”¨ï¼Œè·å–2ä¸ªå‚æ•°çš„é”®åé•¿åº¦ï¼Œä¸ä¸€è‡´è‚¯å®šä¸ç­‰ã€‚ä¸€è‡´çš„è¯ï¼Œåœ¨ä¸‹é¢è¿›è¡Œå¯¹è±¡çš„ç¬¬ä¸€å±‚æ¯”è¾ƒ const keysA = Object.keys(objA); const keysB = Object.keys(objB); if (keysA.length !== keysB.length) &#123; return false; &#125; for (let i = 0; i &lt; keysA.length; i++) &#123; if ( // æ¯”è¾ƒAçš„é”®åæ˜¯å¦å­˜åœ¨äºBå¯¹è±¡ä¸­ï¼Œç”¨çš„æ˜¯hasOwnPropertyã€‚ !hasOwnProperty.call(objB, keysA[i]) || // å¦‚æœå­˜åœ¨ï¼Œçœ‹çœ‹Aå’ŒBåŒé”®åçš„å€¼æ˜¯å¦å¼•ç”¨ç›¸åŒï¼ˆå¦‚æœæ˜¯å¯¹è±¡ï¼‰ï¼Œè¿™é‡Œç”¨iså‡½æ•°æ¥æå®šã€‚ !is(objA[keysA[i]], objB[keysA[i]]) ) &#123; return false; &#125; &#125; // æµ…æ¯”è¾ƒç»“æŸï¼Œè¿™é‡Œè¿”å›trur, è®¤ä¸ºä¸¤è€…ç›¸ç­‰ã€‚ return true;&#125; æ‰€ä»¥åœ¨è§£é‡Šå¼€ç¯‡æåˆ°çš„åœºæ™¯ï¼Œä¸¤ä¸ª &#123;&#125; çš„æ¯”è¾ƒï¼Œæ¯”è¾ƒåˆ°äº†æœ€åä¸€æ­¥ï¼Œfor å¾ªç¯æ—¶ï¼Œæ²¡æœ‰é•¿åº¦ï¼Œé‡Œé¢æ²¡æ³•èµ°ï¼Œç›´æ¥åˆ°æœ€å return true äº†ã€‚ ç„¶ååŒ…è£…åï¼ŒProps å˜å¤šäº†ï¼Œç„¶åå°±è¿›åˆ°äº† for å¾ªç¯é‡Œæ¯”è¾ƒï¼Œå‘ç°æ·±å±‚çš„å¯¹è±¡å¼•ç”¨ä¸ä¸€è‡´ã€‚ï¼ˆè¿™é‡Œæœ‰ä¸ªç–‘æƒ‘ï¼Œå¯èƒ½åœ¨ç¬¬ä¸€æ­¥ is(A,B)å°±å·²ç»åˆ¤æ–­å‡ºæ¥å¼•ç”¨ä¸åŒäº†ï¼Œå…·ä½“çœ‹ antd çš„ä¼ å‚ Props æ˜¯æ€ä¹ˆå†™çš„ï¼Œæ˜¯ä¸€ä¸ªå˜é‡è¿˜æ˜¯ä¸€ä¸ªæ‰‹å†™{}ï¼‰","categories":[],"tags":[]},{"title":"Vueä¸­åŸç”Ÿæ“ä½œSelect","slug":"2018/about-select-element","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:21:37.793Z","comments":true,"path":"2018/12/30/2018/about-select-element/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/about-select-element/","excerpt":"","text":"Vueä¸­é¼“åŠ±æ•°æ®é©±åŠ¨ï¼Œä»è€Œé¿å…è·Ÿä»¥å‰ä¸€æ ·ä½¿ç”¨jQueryæ¥æ“ä½œDOMçš„æ–¹å¼æ“ä½œselectã€‚ä¸šåŠ¡å¼€å‘ä¸­ç»å¸¸ç¢°åˆ°selectæ“ä½œï¼Œæ‰€ä»¥å†™ä¸€ç¯‡è®°å½•ä¸‹åŸç”Ÿæ“ä½œselectç›¸å…³çš„ã€‚ å®é™…å¼€å‘é‡åˆ°çš„æƒ…å†µå› ä¸ºoptioné€‰é¡¹å±•ç¤ºç»™ç”¨æˆ·çœ‹æ˜¯ä¸€ä¸ªæ–‡æ¡ˆï¼Œè€Œè·Ÿåç«¯çº¦å®šä¼ å€¼ï¼Œæ˜¯å¯¹åº”çš„codeã€‚å¦‚æœæ ¹æ®selectDataçš„å€¼åšä¸€ä¸ªåˆ¤æ–­ï¼Œå°‘çš„è¯è¿˜è¡Œï¼Œå¦‚æœæ˜¯åŸå¸‚é€‰æ‹©ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æœ‰è¿‡ç»éªŒï¼Œä¼ é€’çš„æ˜¯åŸå¸‚å¯¹åº”çš„codeï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªä¸ªåˆ¤æ–­ï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚ä¸‹æƒ…å†µï¼š 12345&lt;div id=&quot;app&quot;&gt; &lt;select v-model=&quot;selectData&quot;&gt; &lt;option v-for=&quot;item,index in options&quot; v-text=&quot;item.t&quot; :value=&quot;item.v&quot;&gt;&lt;/option&gt; &lt;/select&gt;&lt;/div&gt; 12345678910let vm = new Vue(&#123; data: &#123; selectData: &#x27;2&#x27;, options: [ &#123;t: &#x27;one&#x27;, v: 1&#125;, &#123;t: &#x27;two&#x27;, v: 2&#125;, &#123;t: &#x27;three&#x27;, v: 3&#125;, ] &#125;&#125;) è·å–å¯¹åº”valueçš„æ€è·¯ä¾èµ–äº†åŸç”Ÿæ“ä½œdomçš„æ–¹å¼ï¼Œå…ˆè·å–åˆ°selectï¼Œç„¶åè·å–å…¶selectedIndexå±æ€§å€¼ï¼Œè¯¥å€¼è¿”å›çš„å°±æ˜¯selectä¸­é€‰ä¸­çš„é‚£ä¸ªoptionçš„æ•°ç»„ä¸‹æ ‡ã€‚ è¿™é‡Œæœ‰å‡ ä¸ªå¹³æ—¶ç»å¸¸ä¼šå¼„é”™çš„åœ°æ–¹ã€‚ å…³äºv-modelçš„ç»‘å®šåº”è¯¥ç»‘å®šçš„æ˜¯selectï¼Œè€Œä¸æ˜¯å¾ªç¯ç»“æ„é‡Œçš„optionã€‚ å…³äº@changeäº‹ä»¶çš„ç»‘å®šä¹Ÿæ˜¯éœ€è¦ç»‘å®šåœ¨selectä¸Šï¼Œè€Œä¸æ˜¯optionã€‚ ä¸‹é¢çœ‹ä¸‹åŸç”Ÿæ–¹å¼è·å–å¯¹åº”optionçš„text 123&lt;select v-model=&quot;selectData&quot; @change=&quot;changeEvent&quot; ref=&quot;selectDom&quot;&gt; &lt;option v-for=&quot;item,index in options&quot; v-text=&quot;item.t&quot; :value=&quot;item.v&quot; ref=&quot;options&quot;&gt;&lt;/option&gt;&lt;/select&gt; 12345678910&#123; methods: &#123; changeEvent() &#123; let selectIndex = this.$refs.selectDom.selectedIndex; // è·å–é€‰ä¸­çš„index let selectOptionTxt = this.$refs.options[selectedIndex].textContent; console.log(selectOptionTxt); // æ‰“å°å‡ºå¯¹åº”çš„optionçš„text &#125; &#125;&#125; è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è·å–ï¼ŒæŸ¥çœ‹äº†ä¸‹***$refs.optionsï¼Œå®é™…ä¸Šå°±æ˜¯optionçš„domå…ƒç´ é›†åˆã€‚æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆoptionï¼‰æœ‰å¾ˆå¤šå±æ€§ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªselectedå±æ€§ï¼Œé€‰ä¸­çš„opitonï¼Œå…¶selectedå±æ€§å€¼ä¸ºtrueã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥éå†ä¸‹optionï¼ŒæŸ¥çœ‹å…¶selected***å±æ€§ï¼Œå¦‚æœæ˜¯trueï¼Œåˆ™é”å®šè¯¥optionã€‚ 123456789101112// ç¤ºæ„ä»£ç let selectOption = null;[].forEach.call(document.querySelectorAll(&#x27;option&#x27;), function(item, index)&#123; if (item.selected) &#123; selectOption = item; // ç¡®å®šäº†é€‰æ‹©çš„option &#125;&#125;)console.log(selectOption.textContent);// é¡ºæä¸€ä¸‹è·å–selectæœ€ç»ˆé€‰æ‹©çš„å€¼ã€‚Vueä¸­ï¼Œé€šå¸¸æ˜¯v-modelç»‘å®šäº†dataä¸­çš„ä¸€ä¸ªå±æ€§console.log(document.querySelector(&#x27;select&#x27;).value); æ€»ç»“å› ä¸ºæœ¬äººç»å¸¸ç¢°åˆ°æ­¤ç±»æƒ…å†µï¼Œæ¯æ¬¡åˆä¸èƒ½é¡ºåˆ©çš„æå®šè¯¥é—®é¢˜ï¼Œä¸æ˜¯ç»‘é”™äº†v-modelï¼Œå°±æ˜¯å…¶ä»–é—®é¢˜ï¼Œå› æ­¤è®°å½•è¯¥æ–‡ã€‚å¦‚æœå“ªä½æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼ˆæ¯”å¦‚ç”¨Vueçš„æ–¹å¼ï¼‰ï¼Œä¸åèµæ•™å•Š~","categories":[],"tags":[]},{"title":"å¼‚æ­¥å’ŒåŒæ­¥","slug":"2018/async-sync","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:21:43.735Z","comments":true,"path":"2018/12/30/2018/async-sync/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/async-sync/","excerpt":"","text":"åŒæ­¥å‡½æ•° è°ƒç”¨å³å¯ç«‹å³å¾—åˆ°ç»“æœï¼Œä¸ç”¨ç­‰å¾… 123function syncFn() &#123; console.log(&#x27;æˆ‘æ˜¯åŒæ­¥ï¼Œç«‹åˆ»å¾—åˆ°ç»“æœ&#x27;)&#125; å¼‚æ­¥å‡½æ•° è°ƒç”¨åä¸èƒ½ç«‹å³å¾—åˆ°ç»“æœï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æˆ–è€…æ˜¯ä¸‹ä¸€è½®tick(äº‹ä»¶å¾ªç¯çš„ä¸€è½®å«åšä¸€ä¸ªtick)è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¼‚æ­¥å‡½æ•°çš„ä»£ç é€šå¸¸æœ‰2ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç°åœ¨è¿è¡Œçš„ä»£ç å’Œå°†æ¥è¿è¡Œçš„ä»£ç ï¼Œå¼‚æ­¥å‡½æ•°å¹¶ä¸æ˜¯æ•´ä½“éƒ½æ˜¯å¼‚æ­¥çš„ã€‚ ç‚¹å‡»äº‹ä»¶12345function asyncFn1() &#123; document.querySelector(&#x27;.oDiv&#x27;).addEventListener(&#x27;click&#x27;, function()&#123; console.log(&#x27;åˆ«æƒŠè®¶ï¼Œç‚¹å‡»äº‹ä»¶ä¹Ÿç®—å¼‚æ­¥&#x27;); // å°†æ¥è¿è¡Œçš„ä»£ç  &#125;)&#125; å®šæ—¶å™¨äº‹ä»¶12345function asyncFn2() &#123; setTimeout(function()&#123; console.log(&#x27;å®šæ—¶å™¨ï¼Œç»å¯¹çš„å¼‚æ­¥å‡½æ•°&#x27;) // å°†æ¥è¿è¡Œçš„ä»£ç  &#125;, 0)&#125; ajaxäº‹ä»¶1234567891011121314function asyncFn3() &#123; // å‡è®¾å¼•å…¥äº†jQuery $.ajax(&#123; url: &#x27;xxx&#x27;, type: &#x27;post&#x27;, dataType: &#x27;json&#x27;, success: function()&#123; console.log(&#x27;ajaxå¼‚æ­¥è¯·æ±‚&#x27;) // å°†æ¥è¿è¡Œçš„ä»£ç  &#125;, fail: function()&#123; console.log(&#x27;wrong&#x27;) &#125; &#125;)&#125; Promise12345678910111213// ES6ä¸­æ–°å¢çš„Promisefunction asyncFn4() &#123; return new Promise(function(resolve, reject) &#123; // do something // å°†æ¥è¿è¡Œçš„ä»£ç  start â†“ if(true)&#123; resolve(data); &#125;else &#123; reject(error); &#125; // å°†æ¥è¿è¡Œçš„ä»£ç  end â†‘ &#125;)&#125; åŒæ­¥å’Œå¼‚æ­¥å‡½æ•°ä¹Ÿæ˜¯äº‹ä»¶å¾ªç¯ä¸­ä¸å¯ç¼ºå°‘çš„é‡è¦æ¦‚å¿µï¼Œå¯¹äº‹ä»¶å¾ªç¯çš„è¿è¡Œæœºåˆ¶æœ‰å¾ˆå¤§å¸®åŠ©ã€‚æ‰€ä»¥ä¸€å®šè¦æ¸…æ¥šè¾¨è®¤å“ªäº›æ˜¯å¼‚æ­¥ï¼Œå“ªäº›æ˜¯åŒæ­¥ã€‚","categories":[],"tags":[]},{"title":"äº‹ä»¶å¾ªç¯","slug":"2018/event-loop","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:22:42.994Z","comments":true,"path":"2018/12/30/2018/event-loop/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/event-loop/","excerpt":"","text":"ä¸ºä»€ä¹ˆä¼šæœ‰äº‹ä»¶å¾ªç¯Event Loop?å› ä¸ºJSæ˜¯å•çº¿ç¨‹çš„ï¼ˆæ‰§è¡ŒJSä»£ç çš„åªæœ‰1ä¸ªçº¿ç¨‹ï¼Œé€šå¸¸ä¼šè¯´ä¸»çº¿ç¨‹ï¼‰ã€‚ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¿‡å¤šä»»åŠ¡æˆ–è€…ä»»åŠ¡è¿‡å¤æ‚ï¼Œå°±ä¼šå‡ºç°é˜»å¡ï¼Œå› æ­¤æœ‰äº›å¦‚ajaxè€—æ—¶å‡½æ•°åˆ™äº¤ç”±å…¶ä»–çº¿ç¨‹å¤„ç†ï¼Œä¸€æ—¦æœ‰ç»“æœåˆ™ä¼šå°†ä¸ºå…¶äº‹ä»¶æ¡ä»¶æ»¡è¶³è®¾ç½®çš„å›è°ƒå‡½æ•°åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒEventLoopæ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œå½“å½“å‰æ‰§è¡Œæ ˆæ¸…ç©ºåï¼Œåˆ™ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æŸ¥è¯¢ä»»åŠ¡ï¼Œæ‹‰å‡ºæ¥æ‰§è¡Œï¼Œé‡å¤æ‰§è¡Œè¯¥è¿‡ç¨‹ã€‚ å›¾å½¢è¯EventLoopå›¾ç‰‡æ‘˜è‡ªæ˜é‡‘ä½œè€…ã€å¥‰çŒ®ã€‘çš„äº‹ä»¶å¾ªç¯æ–‡ç«  å›¾ä¸­æœ‰2ä¸ªæ–°çš„æ¦‚å¿µMacrotaskå’ŒMicrotask Macrotaské€šå¸¸æ‰€è¯´çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯Taskã€‚åœ¨ES6æå‡ºPromiseä¹‹å‰ï¼Œåº”è¯¥åªæœ‰Taskè¿™ä¸ªé˜Ÿåˆ—ï¼Œåæ¥è§„èŒƒè§„å®šæ¸…æ¥šäº†2ç§é˜Ÿåˆ—ï¼ŒTaskå°±æˆäº†Macrotaskï¼Œä¹Ÿå«å®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ»¡è¶³æ¡ä»¶çš„äº‹ä»¶ï¼Œåˆ™è¿›å…¥è¯¥é˜Ÿåˆ—ï¼Œå¦‚å®šæ—¶å™¨å‡½æ•°ï¼ˆsetTimeout, setInterval, setImmediateç­‰ï¼‰ï¼Œajaxå›è°ƒå‡½æ•°ï¼ŒUIäº¤äº’äº‹ä»¶ï¼ˆclickç­‰ï¼‰ Microtaskå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå«Jobï¼Œç²’åº¦æ¯”Taskå°ã€‚å­˜æ”¾Promise.nextTickï¼ŒPromise.then()ä¹‹æµçš„ä»»åŠ¡ã€‚ ä¸¤ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§å’Œæ’å…¥æ‰§è¡Œæ—¶æœºå¾®ä»»åŠ¡å¤„ç†ä¼˜å…ˆäºå®ä»»åŠ¡å¤„ç†ã€‚åªæœ‰å¤„ç†å®Œæ¸…ç©ºäº†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒEventLoopæ‰ä¼šä»Macrotaskå–ä¸€ä¸ªå®ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚å¾®ä»»åŠ¡ä¼šæ’å…¥åˆ°ä¸‹ä¸ªTickä¹‹å‰æ‰§è¡Œ äº‹ä»¶å¾ªç¯çš„ä¸€è½®æ€ä¹ˆç•Œå®šï¼Ÿè¿™ä¸ªé—®é¢˜å›°æ‰°æˆ‘æ¯”è¾ƒä¹…ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œä»ã€è¿™æ³¢èƒ½åæ€ã€‘ä½œè€…å†™çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ä¸­æ‰¾åˆ°äº†æ˜æ˜¾çš„ç­”æ¡ˆï¼Œç»“åˆå‚è€ƒäº†å…¶ä»–å¤šç¯‡äº‹ä»¶å¾ªç¯ä¸é”™çš„åšæ–‡ï¼Œå¦‚æ˜é‡‘çš„ã€ç‹ä¸‹é‚€æœˆç†Šã€‘å’Œã€å¥‰çŒ®ã€‘2ä½ä½œè€…çš„æ–‡ç« ã€‚ äº‹ä»¶å¾ªç¯çš„å¼€å§‹ï¼šJSå…¨å±€ä»£ç ï¼ˆç®—å®ä»»åŠ¡ï¼‰å…¥æ ˆã€‚ äº‹ä»¶å¾ªç¯çš„ç»“æŸï¼šå…¨å±€ä»£ç æ‰§è¡Œå®Œï¼Œæ£€æŸ¥Microæ˜¯å¦æœ‰å¾®ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œå°†å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­å‡½æ•°æ”¾å…¥æ‰§è¡Œæ ˆä¾æ¬¡æ‰§è¡Œå®Œã€‚æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚è‡³æ­¤ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ç»“æŸã€‚ç¬¬äºŒè½®ï¼Œå³ä»ä¸‹ä¸€ä¸ªMacroä»»åŠ¡å¼€å§‹ï¼Œå¦‚æ­¤å¾ªç¯ã€‚å›¾ç‰‡æ‘˜è‡ªæ˜é‡‘ã€ç‹ä¸‹é‚€æœˆç†Šã€‘çš„äº‹ä»¶å¾ªç¯æ–‡ç«  ä»£ç ä¸Šç†è§£ çº¯æ–‡å­—è§£é‡Šä¸å®¹æ˜“ç†è§£ï¼Œç»“åˆä»£ç  12345678910111213141516171819202122var beginEventFlag = &#x27;å¼€å§‹äº‹ä»¶å¾ªç¯&#x27;; console.log(beginEventFlag);setTimeout(() =&gt; &#123; // å¼‚æ­¥ console.log(&#x27;500sæ‰§è¡Œ&#x27;)&#125;,500)var p = new Promise(function(resolve, reject)&#123; resolve(5);&#125;)p.then(function(r)&#123; console.log(r); var p2 = new Promise(function(resolve, reject)&#123; resolve(&#x27;åˆæ˜¯5&#x27;) &#125;) p2.then(function(d) &#123; console.log(d) &#125;) setTimeout(() =&gt; &#123; console.log(&#x27;åˆæ˜¯500sæ‰§è¡Œ&#x27;) &#125;,1000)&#125;) Chromeä¸­æ‰“å°ç»“æœä¸ºï¼šâ€™å¼€å§‹æ—¶é—´å¾ªç¯â€™ï¼Œ5ï¼Œåˆæ˜¯5ï¼Œ500sæ‰§è¡Œï¼Œåˆæ˜¯500sæ‰§è¡Œã€‚ ç»“åˆæ¦‚å¿µä¸­æ¥åˆ†ææ­¤æ®µä»£ç ï¼š å…¨å±€ä»£ç ï¼ˆåŒæ­¥å‡½æ•°ï¼Œå®ä»»åŠ¡ï¼‰å…¥æ ˆï¼Œæ‰“å°â€˜å¼€å§‹äº‹ä»¶å¾ªç¯â€™ã€‚ é‡åˆ°setTimeoutï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼Œè®¡æ—¶äº¤ç”±æµè§ˆå™¨å¯¹åº”çš„å®šæ—¶å™¨çº¿ç¨‹ï¼Œå¹¶å°†å…¶å›è°ƒå¡å…¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ æ‰§è¡Œnew Promiseä»£ç ï¼Œç«‹åˆ»å†³è®®è¿™ä¸ªpã€‚å¹¶å°†å…¶p.thenæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ æ²¡æœ‰å…¶ä»–åŒæ­¥ä»£ç äº†ï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰§è¡Œï¼Œæ‰“å°â€˜5â€™ã€‚é‡åˆ°p2ï¼Œç«‹åˆ»å†³è®®ï¼Œå°†p2.thenå¡å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚é‡åˆ°setTimeoutï¼ˆç¬¬äºŒä¸ªï¼‰ï¼Œå¡å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚ ç»§ç»­æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°åˆšå¡å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—çš„p2.thenï¼Œæ‰§è¡Œï¼Œæ‰“å°â€˜åˆæ˜¯5â€™ã€‚è‡³æ­¤å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºå®Œæ¯•ã€‚ ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯å¼€å§‹ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªsetTimeoutçš„å›è°ƒæ‰§è¡Œï¼Œæ‰“å°â€˜500sæ‰§è¡Œâ€™ã€‚ æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ²¡æœ‰Jobéœ€è¦æ‰§è¡Œã€‚ å†ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯å¼€å§‹ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ç¬¬äºŒä¸ªsetTiemoutçš„å›è°ƒæ‰§è¡Œï¼Œæ‰“å°â€˜åˆæ˜¯500sæ‰§è¡Œâ€™ã€‚ æ€»ç»“æœ¬æ–‡å‚è€ƒäº†å¾ˆå¤šåšæ–‡ï¼Œç®€åŒ–ä¸å°‘ä¸œè¥¿ï¼Œç¬”è€…ä¸»è¦æ˜¯ä¸ºäº†è®°å½•å¹¶æ–¹ä¾¿è‡ªå·±çš„ç†è§£ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚","categories":[],"tags":[]},{"title":"webpackä¸­çš„lesså¼•å…¥","slug":"2018/less-module-in-webpack","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:21:50.841Z","comments":true,"path":"2018/12/30/2018/less-module-in-webpack/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/less-module-in-webpack/","excerpt":"","text":"é¡¹ç›®æœ¬èº«æ˜¯ç”¨vue-cliæ­å»ºçš„æ¨¡æ¿ã€‚ä½¿ç”¨äº†lesså†™æ ·å¼ã€‚è€ƒè™‘åˆ°å……åˆ†ä½¿ç”¨lessçš„ç‰¹æ€§ï¼Œæ‰€ä»¥è‚¯å®šä¼šæœ‰å¦‚mixin.lessï¼Œbase.lessä¹‹ç±»çš„å…¬ç”¨lessæ¨¡å—ã€‚ 12@import &#x27;../../common/style/base.less&#x27;;@import &#x27;../../common/style/mixin.less&#x27;; å½“ç„¶å¯ä»¥è¿™ä¹ˆå†™ï¼Œå®Œå…¨çš„ç›¸å¯¹è·¯å¾„ã€‚ç»æµ‹è¯•æ˜¯æ²¡é—®é¢˜çš„ã€‚ ä½†æ˜¯æ—¢ç„¶æ˜¯webpackï¼Œå½“ç„¶åº”è¯¥å……åˆ†åˆ©ç”¨å…¶ç‰¹æ€§ã€‚æˆ‘ä¹Ÿæ˜¯åœ¨çœ‹äº†å¦‚æ…•è¯¾ç½‘çš„å®æˆ˜æ•™ç¨‹åï¼Œæ‰äº†è§£è¿‡è¿˜æœ‰è¿™ç§å†™æ³•ã€‚ 12@import &#x27;~common/style/base.less&#x27;@import &#x27;~common/style/mixin.less&#x27; å¹³æ—¶ä¸€ç›´è¿™ä¹ˆå†™ï¼Œæ²¡æœ‰å…³æ³¨è¿‡~è¿™ä¸ªç¬¦å·åˆ°åº•ä»£è¡¨çš„æ˜¯ä»€ä¹ˆã€‚ç›´åˆ°æœ‰ä¸€æ¬¡å†™åˆ°ä¸€ä¸ªèƒŒæ™¯å›¾ç‰‡çš„lessé€šç”¨å‡½æ•°ï¼Œå‡ºäº†é—®é¢˜ï¼Œå¦‚ä¸‹ 123456789/*mixin.lessä¸­å£°æ˜çš„è¯¥lesså‡½æ•°ï¼Œè·¯å¾„æ˜¯åœ¨src/common/style/mixin.less*/.bg-set(@img) &#123; background-image: url(@img); background-repeat: no-repeat; background-size: 100%;&#125;/*åœ¨src/page/index/index.vueä¸­ä½¿ç”¨è¯¥å‡½æ•°ï¼Œå›¾ç‰‡å­˜æ”¾åœ¨src/page/index/arrow.png*/.bg-set(&#x27;./arrow.png&#x27;) ç»“æœæŠ¥é”™ï¼Œwebpackæç¤ºå¤§è‡´æ„æ€æ˜¯æ‰¾ä¸åˆ°Moduleï¼šarrow.pngã€‚çœ‹äº†ä¸‹æŠ¥é”™è¯¦ç»†ï¼Œå¼•ç”¨çš„arrow.pngè·¯å¾„å°½ç„¶æ˜¯src/common/style/arrow.pngï¼Œè€Œä¸æ˜¯ç†æƒ³ä¸‹çš„src/page/index/arrow.pngã€‚ è¿™ä¸ªé—®é¢˜çš„ç¡®ä¸å¥½æè¿°ï¼Œç½‘ä¸Šæœç´¢è¿‡ç›¸å…³é—®é¢˜ï¼ŒåŸºæœ¬æ²¡æœ‰ã€‚åæ¥åœ¨æ…•è¯¾ç½‘ä¸­å‘ç°æœ‰äººå›ç­”äº†è¯¥é—®é¢˜ã€‚ 123456/*mixin.lessä¸­å‡½æ•°æ”¹å†™ä¸º*/.bg-set(@img) &#123; background-image: ~&#x27;url(@&#123;img&#125;)&#x27;; background-size: 100%; background-repeat: no-repeat;&#125; è¿™é‡Œçš„å…³é”®å…¶å®å°±æ˜¯å¤šäº†ä¸ªï¼Œå› æ­¤é¡ºè…¾æ‘¸ç“œï¼Œä»webpackå®˜ç½‘æŸ¥æ‰¾ç›¸å…³çš„ï¼Œåœ¨å®˜æ–¹ä¸­æ–‡æ–‡æ¡£çš„LOADERSåˆ—è¡¨ä¸­ï¼Œå…³äºless-loaderä¸­æœ‰ä»‹ç»ï¼Œ~åˆ©ç”¨äº†webpackçš„é«˜çº§ç‰¹æ€§ï¼Œå°†æŸ¥è¯¢å‚æ•°ï¼ˆè¿™é‡Œåº”è¯¥å°±æ˜¯ä¼ é€’çš„å›¾ç‰‡è·¯å¾„ï¼‰ä¼ é€’ç»™webpack resolverï¼Œå‘Šè¯‰webpackä»¥æ¨¡å—æŸ¥æ‰¾çš„æ–¹å¼å¯¹å¾…è¯¥è·¯å¾„ã€‚æœ‰ç‚¹æ‡µé€¼ï¼Œæ²¡å…³ç³»ï¼Œçœ‹ä¸‹ä¾‹å­ã€‚ å…ˆçœ‹ä¸‹jsæ¨¡å—çš„çš„å¯¼å…¥è§„åˆ™12345678910&lt;!-- å¼•ç”¨Vueæ¨¡å—ï¼Œä¼˜å…ˆä¼šä»Nodeæ ¸å¿ƒæ¨¡å—æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°çš„è¯ï¼Œå°±ä»node_modulesæŸ¥æ‰¾ --&gt;var vue = require(&#x27;vue&#x27;)import Vue from &#x27;vue&#x27;&lt;!-- å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œåˆ™æŒ‰ç›¸å¯¹è·¯å¾„æŸ¥æ‰¾ --&gt;var util = require(&#x27;./utils&#x27;)import util from &#x27;./utils&#x27;&lt;!-- webpackä¸­å¯ä»¥é…ç½®aliasï¼ˆåˆ«åï¼‰ï¼Œå‡è®¾@æŒ‡ä»£src/ --&gt;import main from &#x27;@/common/main&#x27; // è¿™é‡ŒåŠ è½½çš„è·¯å¾„å°±æ˜¯src/common/main.js ä»ä¸Šé¢å¤§æ¦‚èƒ½äº†è§£ï¼Œwebpackä¸­ï¼Œå¯¹jsçš„å¼•å…¥ï¼Œå°±æ˜¯æ¨¡å—å¯¼å…¥ã€‚webpackå®˜æ–¹ç½‘ç«™åœ¨less-loaderå’Œsass-loaderä¸­æœ‰è¿™ä¹ˆä¸€æ®µç›¸åŒè¯ã€‚ åªè¦åŠ ä¸€ä¸ª ~ å‰ç¼€ï¼Œå‘Šè¯‰ webpack å»æŸ¥è¯¢æ¨¡å—ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨cssæ¨¡å—ï¼Œæˆ–è€…htmlä¸­åªè¦åœ¨è·¯å¾„å‰é¢åŠ ä¸€ä¸ª~ï¼Œå®é™…ä¸Šå°±æ˜¯å‘Šè¯‰webpackï¼ŒæŒ‰ç…§æ¨¡å—åŠ è½½æ–¹å¼æ¥å¯»æ‰¾å¯¹åº”çš„èµ„æºã€‚ä»¥ä¸‹ä»£ç æˆ‘ä»¬è¿˜æ˜¯å‡è®¾@æ˜¯srcçš„åˆ«åã€‚ 1234567891011&lt;!-- å› æ­¤é—®é¢˜è¿åˆƒè€Œè§£ --&gt;/*mixin.lessä¸­å£°æ˜çš„è¯¥lesså‡½æ•°ï¼Œè·¯å¾„æ˜¯åœ¨src/common/style/mixin.less*/.bg-set(@img) &#123; background-image: url(@img); background-repeat: no-repeat; background-size: 100%;&#125;/*åœ¨src/page/index/index.vueä¸­ä½¿ç”¨è¯¥å‡½æ•°ï¼Œå›¾ç‰‡å­˜æ”¾åœ¨src/page/index/arrow.png*/.bg-set(&#x27;~@/page/index/arrow.png&#x27;) // å¯ä»¥ é‡åˆ°~ï¼Œæ¨¡å—æ–¹å¼åŠ è½½ï¼Œå°†@/page/index/arrow.png è§£æä¸º src/page/index/arrow.pngã€‚.bg-set(&#x27;~./arrow.png&#x27;) // å¯ä»¥ é‡åˆ°~ï¼Œæ¨¡å—æ–¹å¼åŠ è½½ï¼Œå°†./arrow.png æŒ‰ç›¸å¯¹è·¯å¾„è®¿é—®åŠ è½½è¯¥æ¨¡å—èµ„æºï¼Œå³åœ¨å½“å‰indexæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°arrow.pngã€‚å› æ­¤æ²¡é—®é¢˜ã€‚ è‡³äºæ”¹åŠ¨lesså‡½æ•°çš„æ–¹æ³•ã€‚åŸç†å·®ä¸å¤š 12&lt;!-- å¯¹&#x27;url(@&#123;img&#125;)&#x27;ä»¥æ¨¡å—æ–¹å¼æœç´¢ï¼Œå› è¯¥å‡½æ•°è¢«å¯¼å…¥åˆ°å½“å‰lessä¸­ï¼Œå½“ä¼ å…¥./arrow.pngæ—¶ï¼Œä»¥&#x27;~./arrow.png&#x27;çš„æ–¹å¼è¿›è¡Œè·¯å¾„è§£æï¼Œè·Ÿä¸Šé¢ç¬¬äºŒç§æ–¹å¼ä¸€è‡´ã€‚ --&gt;background-image: ~&#x27;url(@&#123;img&#125;)&#x27;; è‡³æ­¤ï¼Œwebpackä¸­çš„~ï¼Œå¤§å®¶åº”è¯¥éƒ½æ¸…æ¥šä¸å°‘ã€‚å¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚","categories":[],"tags":[]},{"title":"ç®€å•çš„å®ç°Promise","slug":"2018/promise","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:22:01.339Z","comments":true,"path":"2018/12/30/2018/promise/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/promise/","excerpt":"","text":"promise ä½œä¸º es6 ä¸­çš„é‡ç‚¹æ ¸å¿ƒå†…å®¹ï¼Œé™¤äº†åªä¼šç”¨ä¹‹å¤–ï¼Œè¿˜è¦å¼„æ˜ç™½å…¶ä¸­çš„åŸç†å’Œè§„èŒƒã€‚æœ¬æ–‡ç»“åˆå‚é˜…çš„å…¶ä»– Promise å®ç°çš„æ–‡ç« ï¼Œè¿˜æœ‰ PromiseA+çš„è§„èŒƒï¼Œç»“åˆè‡ªå·±çš„ç†è§£ï¼Œè®°å½•ä¸‹å¦‚ä½•å®ç° Promiseã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384import &#x27;babel-polyfill&#x27;// ç®€å•å®ç”¨promiseçš„ä¾‹å­ã€‚// var promiseA = new Promise(function(resolve, reject) &#123;// setTimeout(() =&gt; &#123;// resolve(1)// &#125;, 2000)// &#125;)// thenæ–¹æ³•å¯ä»¥æ— é™è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå¦‚æœthenä¸­æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ï¼Œåˆ™åº”è¯¥å°†ä¸Šä¸€ä¸ªPromiseçš„å€¼ä¼ é€’åˆ°åé¢å»// promiseA.then().then().then().then(r =&gt; &#123;// console.log(r)// &#125;)// thenæ–¹æ³•æ¥å—å¦ä¸€ä¸ªpromiseï¼Œåˆ™ç­‰å¾…æ¥æ”¶çš„promiseå†³è®®ï¼Œå…¶é“¾å¼è°ƒç”¨çš„thenæ˜¯æ¥æ”¶çš„promiseçš„å›è°ƒ// promiseA.then(function(r) &#123;// return new Promise(function(resolve, reject)&#123;// setTimeout(() =&gt; &#123;// resolve(r + 1)// &#125;,2000)// &#125;)// &#125;).then(r =&gt; &#123;// console.log(r)// &#125;)function MyPromise(fn) &#123; let callbackFn = [] let result = null let status = &#x27;pedding&#x27; this.then = function(fullfilledFn) &#123; // å‰ä¸€ä¸ªpromiseçš„then return new MyPromise(function(resolve) &#123; // åä¸€ä¸ªæ–°è¿”å›çš„promise handle(&#123; fullfilledFn: fullfilledFn || null, resolve: resolve &#125;) &#125;) &#125; function handle(callback) &#123; // å¦‚æœæœªå†³è®®ï¼Œå¡å…¥å›è°ƒä¸­ if (status === &#x27;pedding&#x27;) &#123; callbackFn.push(callback) return &#125; // æ ¹æ®PromiseA+çš„è§„èŒƒï¼Œå¦‚æœfullfilledä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”promise1æ‰§è¡ŒæˆåŠŸï¼ŒPromise2å¿…é¡»æˆåŠŸæ‰§è¡Œå¹¶è¿”å›ç›¸åŒçš„å€¼ã€‚ // è®©Promise2æˆåŠŸæ‰§è¡Œï¼Œå°±æ˜¯è°ƒç”¨è¿”å›çš„æ–°promiseä¸­çš„resolveæ–¹æ³•ï¼Œå¹¶ä¼ é€’ç›¸åŒçš„å€¼ï¼Œè¿™é‡Œå³resultï¼ˆåœ¨promise1çš„resolveé˜¶æ®µï¼Œå·²ç»æ‰§è¡Œäº†result = asyncReturnValueï¼‰ // å¦‚æœå·²ç»å†³è®®ï¼Œä¸”thenä¸­æœªæ³¨å†Œfullfilledå‡½æ•°ï¼Œåº”è¯¥å°†å€¼ï¼Œå¸¦å…¥è¿”å›çš„é‚£ä¸ªæ–°promiseçš„resovleä¸­ï¼Œç»§ç»­ä¼ é€’ä¸‹å» if (!callback.fullfilledFn) &#123; callback.resolve(result) return &#125; // å¦‚æœå·²ç»å†³è®®ï¼Œä¸”thenä¸­æœ‰æ³¨å†Œfullfilledå‡½æ•°ï¼Œæ‰§è¡Œå‰ä¸€ä¸ªpromise.thenä¸­çš„fullfilledã€‚ var ret = callback.fullfilledFn(result) // å¤„ç†çš„ç»“æœï¼Œåº”è¯¥ä¼ é€’ç»™æ–°è¿”å›çš„promiseçš„resolveä¸­ã€‚ callback.resolve(ret) &#125; function resolve(asyncReturnValue) &#123; setTimeout(() =&gt; &#123; result = asyncReturnValue status = &#x27;fullfilled&#x27; callbackFn.forEach(item =&gt; &#123; item(asyncReturnValue) &#125;) &#125;, 0) &#125; fn(resolve)&#125;window.a = new MyPromise(function(resolve) &#123; setTimeout(() =&gt; &#123; resolve(1) &#125;, 2000)&#125;)window.a .then(value =&gt; &#123; console.log(value) &#125;) .then(value =&gt; &#123; console.log(value + 1) &#125;)","categories":[],"tags":[]},{"title":"Vueçš„renderå‡½æ•°","slug":"2018/render-in-vue","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:22:04.135Z","comments":true,"path":"2018/12/30/2018/render-in-vue/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/render-in-vue/","excerpt":"","text":"å·¥ä½œå’Œå­¦ä¹ ä¸­å¤§éƒ¨åˆ†çš„vueå·¥ç¨‹éƒ½æ˜¯é€šè¿‡vue-cliè„šæ‰‹æ¶ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å¾ˆå°‘å…³æ³¨åˆ°vueå®ä¾‹åˆ›å»ºé‚£å—ï¼Œå¶å°”è‡ªå·±æ‰‹å†™åˆ™ä¼šå‡ºç°å„ç§æŠ¥é”™ï¼Œæ¯”å¦‚è¯¥ç‰ˆæœ¬ä¸åŒ…å«ç¼–è¯‘å™¨ï¼Œè¯·ä¸‹è½½å®Œæ•´ç‰ˆæœ¬ï¼ˆå¸¦æœ‰ç¼–è¯‘å™¨ï¼‰çš„ã€‚å› æ­¤è¶ç€è¿™ä¸ªæœºä¼šï¼Œè¯¦ç»†äº†è§£äº†ä¸‹vueçš„ç‰ˆæœ¬åŒºåˆ«ä»¥åŠrenderå‡½æ•°çš„ä½¿ç”¨ã€‚ å…ˆè®¤è¯†ä¸‹Vueæä¾›çš„ç‰ˆæœ¬å®Œæ•´ç‰ˆåŒ…å«äº†ç¼–è¯‘å™¨çš„Vueä»£ç ã€‚ å…³äºruntimeç‰ˆæœ¬åˆ›å»ºVueå®ä¾‹ï¼Œæ¸²æŸ“å¹¶å¤„ç†è™šæ‹ŸDOMç­‰çš„ä»£ç ï¼Œä¸åŒ…å«ç¼–è¯‘å™¨ ç¼–è¯‘å™¨æ˜¯ä»€ä¹ˆè´Ÿè´£å°†æ¨¡æ¿å­—ç¬¦ä¸²å˜å¼‚æˆJsæ¸²æŸ“å‡½æ•°çš„ä»£ç  123456789101112// åˆ›å»ºVueå®ä¾‹ï¼Œä¼ å…¥ä¸€ä¸ªæ¨¡æ¿ä½œä¸ºHTMLæ¸²æŸ“ç»“æ„ã€‚éœ€è¦ç¼–è¯‘å™¨ï¼Œåœ¨å®¢æˆ·ç«¯è¿›è¡Œæ¨¡æ¿ç¼–è¯‘çš„ã€‚new Vue(&#123; template: &#x27;&lt;div&gt;&#123;&#123;title&#125;&#125;&lt;/div&gt;&#x27;&#125;)// é€šè¿‡renderå‡½æ•°è¿›è¡Œæ¸²æŸ“ï¼Œåœ¨æ„å»ºæ—¶é¢„ç¼–è¯‘ä¸ºJsä»£ç ï¼Œæœ€ç»ˆç”Ÿæˆçš„bundleä¸­ä¸åœ¨éœ€è¦ç¼–è¯‘å™¨ã€‚new Vue(&#123; render(h) &#123; return h(&#x27;div&#x27;, this.title) &#125;&#125;) å¯ä»¥çœ‹å‡ºæ¥ï¼Œruntimeç‰ˆæœ¬å’Œå®Œæ•´ç‰ˆæœ¬ï¼Œæœ€ç»ˆéƒ½æ˜¯ç¼–è¯‘ä¸ºJsæ¸²æŸ“å‡½æ•°ä»£ç ã€‚å·®å¼‚å°±æ˜¯ç¼–è¯‘ä¸€ä¸ªåœ¨å¼€å‘äººå‘˜ä»£ç æ„å»ºæ—¶ï¼ˆæ‰“åŒ…å™¨æ‰“åŒ…é˜¶æ®µï¼‰ï¼Œä¸€ä¸ªåœ¨å®¢æˆ·ç«¯ä¸Šè°ƒç”¨æ—¶ç¼–è¯‘ã€‚ ä½¿ç”¨vue-cliæ„å»ºçš„vueå·¥ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°vueå®ä¾‹çš„åˆ›å»ºæ˜¯è¿™æ ·çš„ 1234567891011121314&lt;!-- App.vue --&gt;&lt;template&gt; &lt;div class=&quot;wrap&quot;&gt; &lt;v-nav&gt;&lt;/v-nav&gt; &lt;router-view&gt;&lt;/router-view&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt; import vNav from &#x27;v-nav.vue&#x27; export default &#123; name: &#x27;App&#x27; &#125;&lt;/script&gt;&lt;style&gt;&lt;/style&gt; 123456789import App from &#x27;App.vue&#x27;// è¿™é‡Œçš„hå®é™…ä¸Šæ˜¯createElementå‡½æ•°new Vue(&#123; el: &#x27;#app&#x27;, render: (h) =&gt; &#123; return h(App) &#125;&#125;) ä½†æ˜¯å¦‚æœä½ å°è¯•ä½¿ç”¨templateæ¥æŒ‚è½½æ¨¡æ¿ï¼Œä¼šæŠ¥é”™ã€‚æç¤ºä½ éœ€è¦å®Œæ•´ç‰ˆæœ¬ 123&lt;body&gt; &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;&lt;/body&gt; 123456789import vComp from &#x27;./v-comp.vue&#x27;new Vue(&#123; el: &#x27;#app&#x27;, template: &#x27;&lt;div&gt;&lt;v-nav&gt;&lt;/v-nav&gt;&lt;router-view&gt;&lt;/router-view&gt;&lt;/div&gt;&#x27;, components: &#123; vComp &#125;&#125;) è¿™æ˜¯å› ä¸ºï¼Œé‡‡ç”¨webpack2+ï¼Œæˆ–è€…parcelè¿™ç±»æ‰“åŒ…å·¥å…·ï¼Œéƒ½æ˜¯å¼•ç”¨çš„è¿è¡Œæ—¶ç‰ˆæœ¬node_modules\\vue\\dist\\vue.runtime.esm.jsã€‚å¦‚æœä½ ä¸€å®šè¦ä½¿ç”¨templateçš„è¯ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªåˆ«åï¼Œå¼•ç”¨vueçš„å®Œæ•´ç‰ˆæœ¬å³å¯ã€‚å¦‚webpack: 12345678module.exports = &#123; // ... resolve: &#123; alias: &#123; &#x27;vue$&#x27;: &#x27;vue/dist/vue.esm.js&#x27; &#125; &#125;&#125; å…³äºrenderæ¸²æŸ“å‡½æ•°æŸäº›ç¯å¢ƒä¸­ä»£ç æ›´ç®€ç»ƒ è¿™é‡Œå¼•ç”¨å®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªä¾‹å­ 1234567891011121314151617181920&lt;!-- ä¸€ä¸ªvueå•æ–‡ä»¶ --&gt;&lt;template&gt; &lt;div&gt; &lt;h1 v-if=&quot;level === 1&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/h1&gt; &lt;h2 v-if=&quot;level === 2&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/h2&gt; &lt;h3 v-if=&quot;level === 3&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/h3&gt; &lt;h4 v-if=&quot;level === 4&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/h4&gt; &lt;h5 v-if=&quot;level === 5&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/h5&gt; &lt;/div&gt;&lt;/template&gt; 123456789export default &#123; name: &#x27;title&#x27;, props: &#123; level: &#123; type: Number, required: true &#125; &#125;&#125; è¿™ä¸ªç»„ä»¶å®é™…å°±æ˜¯æ ¹æ®ä¼ é€’çš„levelæ¥å†³å®šä½¿ç”¨çš„åˆ°åº•æ˜¯h1åˆ°h5ä¸­çš„å“ªä¸€ä¸ªã€‚è™½ç„¶æ€è·¯æ¸…æ™°ï¼Œä½†æ˜¯ä»£ç å†—é•¿ã€‚é‡‡ç”¨renderå‡½æ•°çš„æ¥é‡å†™çš„è¯ã€‚ 123456789101112131415161718Vue.component(&#x27;heading&#x27;, &#123; render: (createElement) =&gt; &#123; console.log(createElement( &#x27;h&#x27; + this.level, // hæ ‡ç­¾ this.$slots.default // æ’æ§½å†…å®¹ )) return createElement( &#x27;h&#x27; + this.level, // hæ ‡ç­¾ this.$slots.default // æ’æ§½å†…å®¹ ) &#125;, props: &#123; level: &#123; type: Number, required: true &#125; &#125;&#125;) æ³¨æ„çš„æ˜¯ï¼ŒcreateElementå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªè™šæ‹ŸDOMèŠ‚ç‚¹ï¼ˆè¿™ä¸ªç»„ä»¶åªæ˜¯æ•´ä¸ªé¡µé¢çš„ä¸€å°éƒ¨åˆ†ï¼‰ï¼Œå³VNodeã€‚è€Œè™šæ‹ŸDOMåˆ™æ˜¯å¯¹Vueç»„ä»¶æ ‘å»ºç«‹èµ·æ¥çš„æ•´ä¸ªVNodeæ ‘çš„ç§°å‘¼ã€‚ä¸Šé¢ä»£ç ä¸­çš„consoleä¼šæ‰“å°å‡ºå¦‚ä¸‹ç±»ä¼¼å†…å®¹ã€‚ æ³¨æ„ï¼šcreateElementçš„å‚æ•°æœ‰ä¸‰ä¸ªã€‚ å‚æ•°1å¿…å¡«ï¼Œå¯ä»¥æ˜¯Stringï¼ˆHTMLå­—ç¬¦ä¸²ï¼‰, Objectï¼ˆç»„ä»¶é€‰é¡¹å¯¹è±¡ï¼‰, Functionï¼ˆè§£æä¸Šè¿°ç±»å‹ä»»ä½•ä¸€ç§çš„å¼‚æ­¥å‡½æ•°ï¼‰ã€‚ å‚æ•°2é€‰å¡«ï¼ŒObejctï¼ŒåŒ…å«æ¨¡æ¿ç›¸å…³å±æ€§çš„æ•°æ®å¯¹è±¡ï¼Œä¾‹å¦‚class, titleç­‰ç­‰ã€‚æ¶‰åŠçš„ä¸œè¥¿å¾ˆå¤šï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£dataå¯¹è±¡ å‚æ•°3é€‰å¡«ï¼ŒArrayï¼ŒStringã€‚å­èŠ‚ç‚¹VNodesï¼Œç”±createElmenet()å‡½æ•°è¿”å›ä¸€ä¸ªVNodeå¯¹è±¡ï¼Œæˆ–è€…æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚ åœ¨ä¸Šä¾‹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªä¼ é€’çš„2ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªä¼ å…¥çš„å‚æ•°å°±æ˜¯createElementå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ˜¯å¤šä¸ªå¯¹è±¡ï¼Œéƒ½æ˜¯ç”±createElement()å‡½æ•°è¿”å›çš„VNodeèŠ‚ç‚¹ã€‚ç±»ä¼¼å¦‚ä¸‹ VNodes(å­èŠ‚ç‚¹)å¿…é¡»æ˜¯å”¯ä¸€çš„è¿™é‡Œçš„å”¯ä¸€æ˜¯æŒ‡ï¼ŒcreateElementè¿”å›çš„VNodeå¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œä½¿ç”¨ä¸Šä¹Ÿæ˜¯å”¯ä¸€çš„ï¼Œåº”è¯¥çœ‹åšä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚è€Œä¸èƒ½å½“åšå¼•ç”¨å¯¹è±¡ä½¿ç”¨ã€‚å®˜æ–¹ç¤ºä¾‹ä¸­ï¼Œå¦‚ä¸‹ä»£ç ï¼ŒåŒä¸€ä¸ªå¯¹è±¡è¢«å¤šæ¬¡å¼•ç”¨ä½¿ç”¨ï¼Œå°±æ˜¯é”™è¯¯çš„ã€‚ 123456render: function(createElement) &#123; var onlyOneObject = createElement(&#x27;p&#x27;,&#x27;hi&#x27;); // å‚æ•°1ï¼Œpæ ‡ç­¾ã€‚å‚æ•°2ï¼Œå­—ç¬¦ä¸²ï¼Œå­èŠ‚ç‚¹ return createElement(&#x27;div&#x27;, [ onlyOneObject, onlyOneObject // æ•°ç»„ä¸­å¼•ç”¨åŒä¸€ä¸ªVNodes ])&#125; ä¸€å®šéœ€è¦é‡å¤æ¸²æŸ“ç›¸åŒçš„å…ƒç´ /ç»„ä»¶ï¼ˆå³VNodesï¼‰ï¼Œé‡‡ç”¨å·¥å‚å‡½æ•°æ¥å®ç°ã€‚ 1234567render: function(createElement) &#123; return createElement(&#x27;div&#x27;, Array.apply(null, &#123;length: 20&#125;).map(function()&#123; // applyç¬¬äºŒä¸ªå‚æ•°æ¥å—æ•°ç»„æˆ–ç±»æ•°ç»„ç”Ÿæˆä¸€ä¸ª20ä¸ªé•¿åº¦çš„æ•°ç»„ï¼Œmapè¯¥æ•°ç»„ï¼Œè¿”å›å¯¹åº”çš„ä¸€ä¸ªåº”ç”¨mapä¼ é€’å‡½æ•°çš„20é•¿åº¦çš„æ•°ç»„å†…å®¹ã€‚å³[VNodes, VNodes, ..., VNodes] return createElement(&#x27;p&#x27;, hi) &#125;) )&#125; Jsä»£æ›¿æ¨¡æ¿å¼•æ“å¸¸ç”¨çš„åŠŸèƒ½å®ç°v-ifå’Œv-for1234&lt;ul v-if=&quot;items.length&quot;&gt; &lt;li v-for=&quot;item in items&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;&lt;/ul&gt;&lt;p v-else&gt;No items found.&lt;/p&gt; 123456789101112131415161718// renderå‡½æ•°ä¸­å†™æ³•Vue.component(&#x27;forComp&#x27;, &#123; render: (createElement) =&gt; &#123; if (this.items.length) &#123; return createElement(&#x27;ul&#x27;, this.items.map((item,index) =&gt; &#123; return createElement(&#x27;li&#x27;, item.name) &#125;)) &#125;else&#123; return createElement(&#x27;p&#x27;, &#x27;No items found&#x27;) &#125; &#125;, props: &#123; items: &#123; type: Array, required: true &#125; &#125;&#125;) v-model1&lt;input type=&quot;text&quot; v-model=&quot;enterVal&quot;&gt; 123456789101112131415161718192021222324// renderå‡½æ•°ä¸­å†™æ³•Vue.component(&#x27;oInput&#x27;, &#123; render: (createElement) =&gt; &#123; var self = this; return createElement(&#x27;input&#x27;, &#123; // DOMå±æ€§ domProps: &#123; value: self.enterVal &#125;, // äº‹ä»¶ç›‘å¬å™¨ï¼ŒåŸºäºon on:&#123; input: function(event)&#123; self.$emit(&#x27;input&#x27;, event.target.value); // è¿™é‡Œæ´¾å‘ä¸€ä¸ªinputäº‹ä»¶ï¼Œå®é™…ä¸Šå¯¹åº”åº”è¯¥æ˜¯å¦‚ä¸‹Htmlä»£ç ç»“æ„ &#125; &#125; &#125;) &#125;, props: &#123; enterVal: &#123; type: [String, Number], required: true &#125; &#125;&#125;) 12&lt;!-- çŒœæµ‹ï¼Œæœ¬è´¨ä¸Šv-modelåº”è¯¥æ˜¯vueçš„è¯­æ³•ç³–ï¼Œå®ç°ç›‘å¬inputäº‹ä»¶ï¼Œç„¶åå¾—åˆ°æœ€æ–°è¾“å…¥çš„å€¼ï¼Œæ›´æ–°è§†å›¾ --&gt;&lt;input type=&quot;text&quot; v-on:input=&quot;&quot;&gt; æ’æ§½123456789101112131415161718192021222324252627282930// æ™®é€šçš„æ’æ§½å†…å®¹render: function(createElement) &#123; return createElement(&#x27;div&#x27;, this.$slots.default)&#125;// ç”Ÿæˆå¸¦æœ‰ä½œç”¨åŸŸæ’æ§½çš„ç»„ä»¶ç»“æ„ï¼ˆå¯ä»¥ä¼ é€’æ•°æ®çš„slotï¼‰props: [&#x27;message&#x27;],render: function(createElement) &#123;= return createElement(&#x27;div&#x27;, [ // $scopedSlots.defaultæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›VNodes this.$scopedSlots.default(&#123; text: this.message &#125;) ])&#125;// å‘å­ç»„ä»¶ä¸­ä¼ é€’ä½œç”¨åŸŸæ’æ§½ã€‚rende: function(createElement) &#123; return createElement(&#x27;div&#x27;, [ createElement(&#x27;child&#x27;, &#123; scopedSlots: &#123; default: function(props) &#123; return createElement(&#x27;span&#x27;, props.text) &#125; &#125; &#125;) ])&#125; 12345678910111213141516&lt;!-- ä¸Šé¢3æ®µæ¸²æŸ“å‡½æ•°å…³äºæ’æ§½çš„å†™æ³•ï¼Œå¯¹åº”çš„templateç»“æ„åº”è¯¥æ˜¯ --&gt; &lt;div&gt; è¿™é‡Œæ˜¯slotçš„å†…å®¹ &lt;/div&gt; &lt;div&gt; &lt;slot :text=&quot;message&quot;&gt;&lt;/slot&gt; &lt;/div&gt; &lt;div&gt; &lt;child&gt; &lt;span slot-scope=&quot;props&quot;&gt;&#123;&#123;props.text&#125;&#125;&lt;/span&gt; &lt;/child&gt; &lt;/div&gt; æ€»ç»“æœ¬æ–‡ä¸»è¦æ˜¯æ–¹ä¾¿è‡ªå·±ç†è§£renderå‡½æ•°ç©¶ç«Ÿæ˜¯åšä»€ä¹ˆçš„ï¼ŒåŒºåˆ†ä¸åŒvueæ„å»ºç‰ˆæœ¬ä¸­ä½¿ç”¨renderæ–¹å¼çš„å·®å¼‚ï¼ŒååŠéƒ¨åˆ†ç»“åˆå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£äº†ä¸‹renderå‡½æ•°çš„å…¶ä»–ç®€å•ç”¨æ³•ã€‚æ–‡ç« å†…å®¹è¿˜æ˜¯æ¯”è¾ƒæµ…ï¼Œå»ºè®®å¤§å®¶å»å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚","categories":[],"tags":[]},{"title":"è¿›ç¨‹ï¼Œçº¿ç¨‹","slug":"2018/thread-process","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:22:06.703Z","comments":true,"path":"2018/12/30/2018/thread-process/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/thread-process/","excerpt":"","text":"æœ¬ç¯‡ä¸»è¦å…ˆäº†è§£æµè§ˆå™¨çš„è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œä¸ºäº‹ä»¶å¾ªç¯çš„å†…å®¹åšé“ºå«ã€‚ è¿›ç¨‹ç®€å•ç‚¹ç†è§£ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºä¸€æ¬¡æ‰§è¡Œçš„è¿‡ç¨‹ã€‚çœ‹ä½œæ˜¯ä¸€ä¸ªå·¥å‚ï¼Œå·¥å‚ä¹‹é—´ä¸€èˆ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå„å¹²å„çš„ã€‚ çº¿ç¨‹å½’è¿›ç¨‹ç®¡è¾–ï¼Œä¹Ÿèƒ½æ‹¥æœ‰èµ„æºï¼Œç‹¬ç«‹è¿è¡Œã€‚è¿›ç¨‹é‡Œå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚çœ‹ä½œæ˜¯å·¥å‚é‡Œçš„å·¥äººï¼Œå¾ˆå¤šå·¥äººã€‚ å†…å­˜æŒ‰æˆ‘è‡ªå·±çš„ç†è§£ï¼Œç”µè„‘ç¡¬ç›˜åªè´Ÿè´£å­˜å‚¨å†…å®¹ï¼Œå¦‚æœå¼€ä¸ªæ¸¸æˆï¼Œä¼šæŠŠæ¸¸æˆå†…å®¹è¯»å–å‡ºæ¥æ”¾åˆ°å†…å­˜é‡Œé¢å»è·‘ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ç©ã€‚ ä¸‰è€…å…³ç³»ä¸€ä¸ªå·¥å‚ï¼ˆè¿›ç¨‹ï¼‰æœ‰è‡ªå·±çš„çš„åœ°ç›˜ï¼ˆåˆ†é…çš„å†…å­˜ç©ºé—´ï¼‰ï¼Œå·¥å‚é‡Œæœ‰å¾ˆå¤šå·¥äººï¼ˆçº¿ç¨‹ï¼‰ï¼Œå·¥äººä»¬åœ¨åŒä¸€ä¸ªå·¥å‚å¹²æ´»ï¼Œå¯ä»¥å…±äº«è¿™ä¸ªå·¥å‚çš„å¤§éƒ¨åˆ†å…¬å…±ç©ºé—´ï¼Œæ¯”å¦‚å•æ‰€ï¼Œé£Ÿå ‚ï¼Œå®¿èˆã€‚ æµè§ˆå™¨çš„è¿›ç¨‹æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼Œä¸€ä¸ªtabå°±æ˜¯ä¸ªè¿›ç¨‹ï¼Œè¿˜æœ‰æ’ä»¶ï¼Œä¸€ä¸ªæ¿€æ´»ä½¿ç”¨çš„æ’ä»¶ä¹Ÿå ä¸€ä¸ªè¿›ç¨‹ã€‚å› ä¸ºè¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ‰€ä»¥æŸä¸€ä¸ªå´©äº†ï¼Œä¸ä¼šå½±å“å…¶ä»–çš„è¿›ç¨‹ã€‚ æµè§ˆå™¨æœ€é‡è¦çš„è¿›ç¨‹â€”â€”æµè§ˆå™¨å†…æ ¸å†…æ ¸ä¹Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼Œä¸€ä¸ªtabé€‰é¡¹å¡æœ‰ä¸€ä¸ªè‡ªå·±çš„å†…æ ¸ï¼ˆChromeåº”è¯¥æ˜¯æŒ‡V8å¼•æ“ï¼‰ã€‚å†…æ ¸æœ‰ä¸€èˆ¬æœ‰å¦‚ä¸‹å¸¸é©»çº¿ç¨‹ï¼š GUIæ¸²æŸ“çº¿ç¨‹ Javascriptå¼•æ“çº¿ç¨‹ï¼ˆé€šå¸¸è¯´çš„å•çº¿ç¨‹æŒ‡çš„å°±æ˜¯å®ƒï¼‰ å®šæ—¶å™¨è§¦å‘å™¨çº¿ç¨‹ äº‹ä»¶è§¦å‘çº¿ç¨‹ å¼‚æ­¥Httpè¯·æ±‚çº¿ç¨‹ GUIæ¸²æŸ“å¼•æ“æ¸²æŸ“æµè§ˆå™¨ç•Œé¢çš„HTMLå…ƒç´ ï¼Œå½“ç•Œé¢éœ€è¦é‡ç»˜å’Œå›æµæ—¶ï¼Œè¯¥çº¿ç¨‹å°±ä¼šæ‰§è¡Œã€‚è¯¥çº¿ç¨‹å’ŒJavascriptå¼•æ“çº¿ç¨‹äº’æ–¥ã€‚ Javascriptå¼•æ“çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰è§£é‡ŠJSè„šæœ¬çš„ã€‚é€šå¸¸è¯´çš„JSæ˜¯å•çº¿ç¨‹çš„ï¼Œå°±æ˜¯ç”±æ­¤è€Œæ¥ã€‚ä¸ºå•¥æ˜¯å•çº¿ç¨‹ï¼Ÿä¸ºäº†ç®€å•ï¼å‡è®¾æœ‰è¿™ä¹ˆä¸ªæƒ…å†µï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œä¸¤ä¸ªäººï¼ˆJSå¼•æ“çº¿ç¨‹å‡å¦‚æœ‰2ä¸ªï¼‰åŒæ—¶æ‹¿æªæŒ‡ç€ä½ çš„è„‘è¢‹ï¼ˆDOMå…ƒç´ ï¼‰ï¼Œä¸€ä¸ªè®©ä½ ç«™ç€ï¼ˆæ’å…¥ï¼‰ï¼Œä¸€ä¸ªè®©ä½ è¶´ç€ï¼ˆåˆ é™¤ï¼‰ï¼Œä½ åˆ°åº•å¬è°çš„ï¼Ÿè¯¥çº¿ç¨‹å’ŒGUIæ¸²æŸ“å¼•æ“äº’æ–¥ã€‚ GUIæ¸²æŸ“çº¿ç¨‹å’ŒJavascriptå¼•æ“çº¿ç¨‹ä¸ºä»€ä¹ˆäº’æ–¥ï¼Ÿå› ä¸ºå‰è€…æ˜¯æ¸²æŸ“HTMLï¼ˆDOMå’ŒCSSï¼‰ï¼Œåè€…æ˜¯å¯ä»¥æ“ä½œDOMå’ŒCSSçš„ã€‚å¦‚æœåŒæ—¶è¿è¡Œï¼Œä¼šé€ æˆGUIæ¸²æŸ“çº¿ç¨‹ç»˜åˆ¶å…ƒç´ æ•°æ®å‰åè¡¨ç°ä¸ä¸€è‡´ã€‚æ‰€ä»¥è¿™2ä¸ªçº¿ç¨‹ï¼Œä¸€å®šæ˜¯ä¸€ä¸ªè¢«æŒ‚èµ·ï¼Œå¦ä¸€ä¸ªåœ¨è¿è¡Œã€‚JSæ“ä½œæ—¶ï¼ŒGUIæ¸²æŸ“æŒ‚èµ·ï¼Œæ›´æ–°çš„å†…å®¹ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰JSç©ºé—²äº†å†æ‰§è¡ŒGUIæ¸²æŸ“ã€‚ JSä¼šé˜»å¡é¡µé¢åŠ è½½ï¼Œ2ä¸ªçº¿ç¨‹äº’æ–¥ï¼Œå¤§é‡ä¸”å¤æ‚çš„JSä»£ç ï¼Œä¼šè®©JSå¼•æ“è¿è¡Œæ—¶é—´å˜é•¿ï¼Œå¯¼è‡´GUIæ¸²æŸ“æŒ‚èµ·ï¼Œä¸€ç›´ç­‰å¾…JSå¼•æ“ç©ºé—²æ‰å›å»æ¸²æŸ“ã€‚ å®šæ—¶è§¦å‘å™¨çº¿ç¨‹æµè§ˆå™¨çš„å®šæ—¶å™¨setTimeoutå’ŒsetIntervalï¼ŒJSå¼•æ“çº¿ç¨‹å¹¶ä¸è´Ÿè´£å®šæ—¶å™¨çš„è®¡æ—¶ï¼Œå¯æƒ³è€ŒçŸ¥ï¼ŒJSå¼•æ“å¦‚æœä¸€ç›´åœ¨å€’è®¡æ—¶æ•°æ•°ï¼Œå…¶ä»–ä»£ç å°±æ— æ³•è¿è¡Œäº†ï¼Œé˜»å¡æ•´ä¸ªä»£ç çš„è¿è¡Œã€‚äº‹å®ä¸Šï¼Œå®šæ—¶å™¨æ˜¯å¼‚æ­¥çš„ï¼Œå°±æ˜¯å› ä¸ºJSå¼•æ“çº¿ç¨‹å¹¶æ²¡æœ‰ç®¡ä»–ä»¬ï¼Œè€Œæ˜¯äº¤ç”±å®šæ—¶è§¦å‘å™¨çº¿ç¨‹åœ¨è®¡æ—¶ã€‚ äº‹ä»¶è§¦å‘çº¿ç¨‹æ¯”å¦‚clickäº‹ä»¶ï¼Œå½“ç‚¹å‡»äº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šæŠŠäº‹ä»¶å¤„ç†å‡½æ•°æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…JSå¼•æ“æŒ‰é¡ºåºå¤„ç†ç‚¹å‡»äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚ ä¸ªäººä»¥ä¸ºæ˜¯åªå“åº”DOMäº‹ä»¶ï¼Œä¸è¿‡çœ‹ç½‘ä¸Šå¤§å¤šæ•°æ–‡ç« ï¼ˆåŸºæœ¬éƒ½æ˜¯åŒæ ·å†…å®¹copyï¼Œæ²¡å•¥æ·±å…¥çš„ï¼‰ï¼Œæ—¶é—´å‡ºå‘çº¿ç¨‹è¿˜ç®¡è¾–äº†ajaxäº‹ä»¶å’Œå®šæ—¶å™¨äº‹ä»¶çš„è§¦å‘ã€‚æœ‰ä¸ªç–‘é—®ï¼Œå·²ç»æœ‰äº†å®šæ—¶è§¦å‘å™¨çº¿ç¨‹å’Œå¼‚æ­¥Httpè¯·æ±‚çº¿ç¨‹ï¼Œä¸ºå•¥äº‹ä»¶è§¦å‘çº¿ç¨‹è¿˜ä¼šè·Ÿajaxäº‹ä»¶å’Œå®šæ—¶å™¨äº‹ä»¶æŒ‚é’©ï¼Ÿï¼ˆ8æœˆ17æ—¥è‡ªç­”ï¼Œè€ƒè™‘ä¸‹Nodeé‡Œé¢çš„Eventæ ¸å¿ƒæ¨¡å—ï¼ŒNodeæ˜¯åŸºäºäº‹ä»¶çš„ï¼Œå…¶ä»–æ¨¡å—åŸºæœ¬éƒ½ç»§æ‰¿äº†Eventæ¨¡å—ã€‚ç±»æ¯”è¿™é‡Œï¼Œajaxäº‹ä»¶å’Œå®šæ—¶å™¨äº‹ä»¶ä¹Ÿåº”è¯¥äº¤ç”±ï¼ˆç»§æ‰¿è‡ªï¼‰äº‹ä»¶è§¦å‘çº¿ç¨‹æ¥ç»Ÿä¸€å¤„ç†ï¼‰ å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹é¡¾åæ€ä¹‰ï¼Œå‘é€XMLHttpRequestè¿æ¥çš„ï¼Œè¿æ¥å‘å‡ºåï¼Œæµè§ˆå™¨æ–°å¼€ä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å‘å‡ºçš„è¯·æ±‚ï¼Œå½“è¯·æ±‚å›æ¥æˆ–è€…æŒ‚æ‰ï¼ŒçŠ¶æ€å˜æ›´ï¼Œå¦‚æœè®¾ç½®äº†å›è°ƒå‡½æ•°ï¼Œè¯¥çº¿ç¨‹å°±ä¼šäº§ç”ŸçŠ¶æ€å˜æ›´äº‹ä»¶æ”¾åˆ°JSå¼•æ“çš„å¤„ç†é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…å¤„ç†ã€‚","categories":[],"tags":[]},{"title":"Vueçš„é’©å­","slug":"2018/life-circle-in-vue","date":"2018-12-29T16:00:00.000Z","updated":"2021-11-06T07:21:56.570Z","comments":true,"path":"2018/12/30/2018/life-circle-in-vue/","link":"","permalink":"https://690554125.github.io/2018/12/30/2018/life-circle-in-vue/","excerpt":"","text":"å•é¡µé¢åº”ç”¨é€šå¸¸éƒ½ä¼šç”¨åˆ°vue-routerï¼Œåœ¨ä¸€ä¸ªç»„ä»¶æˆ–è€…é¡µé¢è¢«å±•ç¤ºæˆ–é”€æ¯æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­å’Œè·¯ç”±å®ˆå«åä½œæ­é…ï¼Œèƒ½å¤Ÿæ—¶åˆ»æ§åˆ¶ç»„ä»¶å’Œé¡µé¢åœ¨ä¸åŒé˜¶æ®µè§¦å‘æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°ã€‚ç„¶è€Œï¼Œåˆ†æ¸…æ¥šç”Ÿå‘½å‘¨æœŸå’Œè·¯ç”±å®ˆå«å„è‡ªçš„ä½¿ç”¨åœºæ™¯å¾ˆé‡è¦ï¼Œä¸èƒ½æ··ä¸ºä¸€è°ˆã€‚æœªåŒºåˆ†æ¸…æ¥šï¼Œå°±å®¹æ˜“çŠ¯é”™ï¼Œå¦‚ä¸‹åœºæ™¯æ¡ˆä¾‹ï¼Œéƒ½æ˜¯æˆ‘çŠ¯é”™çš„çœŸå®æ¡ˆä¾‹ã€‚ é”™è¯¯æ¡ˆä¾‹å¦‚ä¸‹å®é™…å·¥ä½œä¸­ç”¨é”™çš„æ¡ˆä¾‹ã€‚ é”™ç”¨åœºæ™¯1Aé¡µé¢(ç»„ä»¶)ä¸­æ‰“å¼€äº†A-1é¡µé¢(ç»„ä»¶)ï¼Œç„¶åç”±A-1é¡µé¢è¿”å›åˆ°Aé¡µé¢ï¼Œåœ¨Aé¡µé¢çš„activatedé’©å­ä¸­å†™äº†å‡½æ•°ï¼ŒæœŸå¾…èƒ½å¤Ÿåœ¨A-1è¿”å›è‡³Aæ—¶è§¦å‘ï¼Œäº‹å®æ˜¯æ²¡æœ‰è§¦å‘ï¼Œå› ä¸ºæ²¡æœ‰å¼„æ¸…æ¥šactivatedé’©å­å‡½æ•°çš„è§¦å‘åœºæ™¯ï¼Œè¿™é‡Œå®é™…åº”è¯¥ç”¨è·¯ç”±å®ˆå«æ¥è§¦å‘ã€‚ é”™ç”¨åœºæ™¯2Homeé¡µé¢ä¸­æ‰“å¼€Aé¡µé¢ï¼ŒAé¡µé¢è¿”å›Homeé¡µé¢ã€‚Homeé¡µé¢ä¸­æ‰“å¼€Bé¡µé¢ï¼ŒBé¡µé¢è¿”å›Homeé¡µé¢ã€‚ä»¥ä¸Šæ“ä½œï¼Œéœ€è¦åœ¨è¿›å…¥A,Bé¡µé¢æ—¶æ ¹æ®é¡µé¢æ›´æ”¹titleä¸ºAæˆ–Bï¼Œå‡éœ€è¦åœ¨è¿”å›Homeé¡µé¢æ—¶ï¼Œåœ¨æŠŠtitleæ”¹ä¸ºhomeã€‚æˆ‘åœ¨Homeï¼ŒAï¼ŒBä¸‰ä¸ªç»„ä»¶ä¸­å†™äº†beforeRouteEnterå®ˆå«ï¼ŒæŒ‚è½½äº†ä¿®æ”¹titleçš„å‡½æ•°ã€‚ç„¶ååªæœ‰Aï¼ŒBæœ‰æ•ˆï¼ŒHomeåªæœ‰åœ¨åˆæ¬¡è¿›å…¥æ—¶æœ‰æ•ˆã€‚æ²¡æœ‰å¼„æ¸…æ¥šæ“ä½œè¡Œä¸ºB-&gt;Homeï¼ŒA-&gt;Homeä¸å±äºbeforeRouteEnterï¼Œè·¯ç”±å˜åŒ–æ˜¯è¿™æ ·çš„: /home/A-&gt;/homeã€‚è§£å†³æ–¹å¼ï¼šHomeç»„ä»¶ä¸­ä½¿ç”¨beforeRouteUpdateï¼Œåˆ¤æ–­to.path === &#39;/home&#39;è§¦å‘ä¿®æ”¹titleã€‚A,Bç»„ä»¶ä¸­ä½¿ç”¨beforeRouteLeaveåˆ¤æ–­to.path === &#39;/home&#39;è§¦å‘ä¿®æ”¹titleã€‚æˆ–è€…åœ¨beforeEachä¸­å¯¹è·¯ç”±çš„å„ä¸ªæ“ä½œåšåˆ¤æ–­ã€‚ ç”Ÿå‘½å‘¨æœŸé’©å­ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œä¸ç®¡æ˜¯åœ¨æ ¹å®ä¾‹è¿˜æ˜¯åœ¨å•æ–‡ä»¶ç»„ä»¶ä¸­ã€‚éƒ½ç»å¸¸ä¼šç”¨åˆ°ã€‚ å†™æ³•æ³¨æ„æ‰€æœ‰é’©å­å‡½æ•°ï¼Œè‡ªåŠ¨ç»‘å®šthisï¼ˆå®ä¾‹æœ¬èº«ï¼‰ã€‚æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°ç»‘å®šçš„thisæ˜¯çˆ¶ä½œç”¨åŸŸã€‚ 1234567891011121314151617181920// æ³¨æ„ï¼Œè¿™é‡Œæ˜¯æœ€ç®€å•çš„å¼•ç”¨vue.jsåï¼Œç„¶åç›´æ¥åœ¨å…¨å±€å®ä¾‹åŒ–Vue// å› æ­¤var vm ç­‰åŒäºwindow.vmvar vm = new Vue(&#123; // right created() &#123; &#125; // ä¸Šé¢å†™æ³•ç­‰åŒäºå¦‚ä¸‹å†™æ³• created: function() &#123; // thisæŒ‡å‘Vueå®ä¾‹æœ¬èº« &#125; // error è¿™ç§å†™æ³•é”™è¯¯ created: () =&gt; &#123; // ç®­å¤´å‡½æ•°ç»‘å®šçš„æ˜¯çˆ¶ä½œç”¨åŸŸï¼Œè¿™ä¸ªä¾‹å­ä¸­thisæŒ‡å‘window // å› æ­¤ç®­å¤´å‡½æ•°çš„è¯thisæŒ‡å‘å¹¶ä¸æ˜¯ä½ æœŸå¾…çš„ &#125;&#125;) ç”Ÿå‘½å‘¨æœŸå‡½æ•°beforeCreateï¼šå®ä¾‹åˆå§‹åŒ–ä¹‹åï¼Œå®ä¾‹è¿˜æ²¡æœ‰åˆ›å»ºå®Œæˆï¼Œå› æ­¤è®¿é—®thisçš„è¯ï¼Œæ˜¯undefinedã€‚ createdï¼šå®ä¾‹åˆ›å»ºå®Œæˆï¼Œä½†æ˜¯æœªå®ŒæˆDOMæŒ‚è½½ã€‚å› æ­¤this.$elæ˜¯è®¿é—®ä¸åˆ°çš„ã€‚è¿™é‡Œå¯ä»¥æ‰§è¡Œwatchï¼Œmethodsç­‰æ–¹æ³•äº†ã€‚å¸¸ç”¨æ¥æŒ‚è½½é¡µé¢æ•°æ®åˆå§‹åŒ–ï¼ˆä¸æ¶‰åŠåˆ°DOMæ“ä½œï¼‰ã€‚ æ¶‰åŠåˆ°domæŒ‚è½½ï¼ŒæŒ‚è½½åçš„é‡æ–°æ‰“è¡¥ä¸æ¸²æŸ“ï¼Œé”€æ¯ç­‰é’©å­ï¼Œéƒ½ä¸ä¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“é˜¶æ®µè¢«è°ƒç”¨ã€‚å¯ä»¥ç†è§£ï¼Œå› ä¸ºæœåŠ¡ç«¯åªä¼šå¯¹é¡µé¢åšä¸€æ¬¡åˆå§‹åŒ–ï¼ŒæŒ‰ç…§åˆå§‹æ¸²æŸ“ï¼Œç”ŸæˆHTMLï¼Œå‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ç«¯ï¼‰ã€‚è¿™å—çŒœæµ‹å¦‚æ­¤ï¼ŒåæœŸå­¦ä¹ ssræ–¹å¼åéªŒè¯ã€‚ beforeMountï¼šåœ¨æŒ‚è½½DOMåˆ°ä¹‹å‰çš„ä¸€ä¸ªé’©å­å‡½æ•°ã€‚èƒ½è®¿é—®åˆ°this.$elï¼Œå°±æ˜¯éœ€è¦æŒ‚è½½çš„å…ƒç´ DOMï¼ˆåŸå§‹æ¨¡æ¿ï¼‰ã€‚æ³¨æ„ï¼š$elå³æŒ‚è½½çš„æ ¹èŠ‚ç‚¹ï¼Œå¦‚&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;ï¼Œå¦‚å•æ–‡ä»¶ç»„ä»¶&lt;template&gt;&lt;div&gt;&lt;/div&gt;&lt;/template&gt;ä¸­çš„divæ ¹èŠ‚ç‚¹ã€‚å¦‚æœæ˜¯å•æ–‡ä»¶çš„æ–¹å¼ï¼Œåœ¨ç»„å»ºä¸­beforeMountä¸ä¸€å®šèƒ½è·å–åˆ°$elï¼Œå®˜æ–¹æ–‡æ¡£åœ¨mountedé’©å­å‡½æ•°ä¸­æœ‰è¯´æ˜ã€‚ æ³¨æ„ mounted ä¸ä¼šæ‰¿è¯ºæ‰€æœ‰çš„å­ç»„ä»¶ä¹Ÿéƒ½ä¸€èµ·è¢«æŒ‚è½½ã€‚å¦‚æœä½ å¸Œæœ›ç­‰åˆ°æ•´ä¸ªè§†å›¾éƒ½æ¸²æŸ“å®Œæ¯•ï¼Œå¯ä»¥ç”¨ vm.$nextTick æ›¿æ¢æ‰ mountedã€‚ mountedï¼šelé€‰é¡¹è¢«æ–°åˆ›å»ºçš„$elæ›¿æ¢ï¼Œä¸”$elæŒ‚è½½åˆ°å®ä¾‹ä¸Šä¹‹åï¼ˆå³vm.$elï¼‰ï¼Œè°ƒç”¨è¯¥é’©å­ã€‚é€šå¸¸ä¼šåœ¨è¯¥é’©å­é˜¶æ®µï¼Œæ“ä½œDOMã€‚è¿™é‡Œå¯ä»¥è®¿é—®åˆ°refæ ‡è®°çš„DOMç»“æ„ã€‚ beforeUpdateï¼šæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåœ¨è™šæ‹ŸDOMæ‰“è¡¥ä¸ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥è®¿é—®æ•°æ®æ›´æ–°å‰é‚£ä¸ªçŠ¶æ€ä¸‹çš„DOMã€‚ updatedï¼šæ•°æ®å‘ç”Ÿå˜åŒ–ä¸”è™šæ‹ŸDOMè¡¥ä¸æ‰“å®Œä¹‹åã€‚DOMæ›´æ–°æˆåŠŸï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›ä¾èµ–DOMçš„æ“ä½œã€‚ä¸åº”è¯¥åœ¨è¯¥é’©å­é‡æ–°æ›´æ”¹çŠ¶æ€ï¼Œè€ƒè™‘ç”¨watchå’Œcomputedã€‚ç±»ä¼¼mountedï¼Œä¸ä¿è¯æ‰€æœ‰ç»„ä»¶éƒ½é‡ç»˜å®Œæˆã€‚å¦‚æœéœ€è¦ç¡®è®¤æ‰€æœ‰ç»„ä»¶é‡ç»˜å®Œæˆï¼Œä½¿ç”¨$nextTickã€‚ beforeDestroyï¼šå®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚å®ä¾‹é”€æ¯ï¼Œå¦‚v-ifï¼Œvue-routerä¸­åˆ‡æ¢è§†å›¾ç­‰éƒ½ä¼šè§¦å‘è¯¥é’©å­ã€‚ destroyedï¼šå®ä¾‹é”€æ¯ä¹‹åè°ƒç”¨ï¼Œå®Œå…¨é”€æ¯ï¼ŒåŒ…æ‹¬å­å®ä¾‹ä¹Ÿä¼šé”€æ¯ï¼ŒåŒè§¦å‘è¯¥é’©å­å‡½æ•°ã€‚ activatedï¼šç»„ä»¶ç›¸å…³çš„é’©å­ï¼Œåªæœ‰keep-aliveåŒ…è£¹çš„ç»„ä»¶ï¼Œé‡æ–°æ¿€æ´»æ—¶ä¼šè§¦å‘ã€‚é€šå¸¸æˆ‘ä»¬ä¼šåœ¨&lt;router-view&gt;&lt;/router-view&gt;å¤–å¥—ä¸€å±‚&lt;keep-alive&gt;&lt;/keep-alive&gt;ï¼Œå•é¡µé¢åº”ç”¨ï¼Œé¢‘ç¹åˆ‡æ¢è§†å›¾ï¼Œå‡å°é‡æ–°æ¸²æŸ“å¼€é”€ã€‚å¦‚æœä½¿ç”¨äº†keep-aliceï¼Œä¼šè§¦å‘activatedé’©å­ï¼Œä½†æ˜¯ç”±äºç»„ä»¶è¢«ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰é”€æ¯ï¼Œä¹Ÿæ²¡æœ‰é‡æ–°åˆ›å»ºï¼Œå› æ­¤ä»ç¬¬äºŒæ¬¡æ¸²æŸ“åŒæ ·ç»„ä»¶æ—¶ä¸ä¼šè§¦å‘beforeCreate,created,beforeMount,mountedç­‰é’©å­ï¼Œè¿™ç‚¹åº”è¯¥å¾ˆå¥½ç†è§£ã€‚è€ŒbeforeDestroy,destroyedåˆ™æ°¸è¿œä¸ä¼šè¢«è§¦å‘ã€‚ deactivatedï¼šç»„ä»¶ç›¸å…³çš„é’©å­ï¼Œåªæœ‰keep-aliveåŒ…è£¹çš„ç»„ä»¶ï¼Œè¢«åœç”¨æ—¶è§¦å‘ï¼Œç±»ä¼¼äºdestroyedï¼Œä½†æ˜¯ä¸æ˜¯çœŸçš„é”€æ¯ï¼Œè€Œæ˜¯å­˜åˆ°å†…å­˜æ”¾åˆ°ä¸€è¾¹ï¼Œæš‚æ—¶ä¸ç”¨è¿™ä¸ªç»„ä»¶ï¼Œkeep-aliveå½¢å¼çš„ç»„ä»¶åˆ‡æ¢ä¼šè§¦å‘è¯¥é’©å­ã€‚ è·¯ç”±å®ˆå«åˆ†ä¸º3ç§ç±»å‹å®ˆå«ï¼šå…¨å±€å‹ï¼Œå•ä¸ªè·¯ç”±ç‹¬äº«å‹ï¼Œç»„ä»¶å†…è°ƒç”¨å‹ã€‚é€šå¸¸å›è°ƒå‡½æ•°æœ‰3ä¸ªå‚æ•°to, from, nextã€‚toï¼Œfromå‡ä¸ºå¯¹è±¡ï¼Œå­˜æ”¾è·¯ç”±è·³è½¬ç›®çš„åœ°çš„å‚æ•°å’Œæ¥æºåœ°çš„å‚æ•°ï¼Œè€Œnextä¸ºå‡½æ•°ï¼Œç±»ä¼¼äºç®¡é“æ“ä½œï¼Œè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªé’©å­ï¼Œä¸æ‰§è¡Œçš„è¯ï¼Œé€šå¸¸ä¼šå¯¼è‡´è·¯ç”±ä¸­æ–­ã€‚ å…¨å±€å‹beforeEachå…¨å±€å‰ç½®è·¯ç”±ã€‚è¿›å…¥æŸè·¯ç”±ä¹‹å‰è§¦å‘ã€‚ beforeResolveå…¨å±€è§£æè·¯ç”±ã€‚å¯¼èˆªç¡®è®¤ä¹‹å‰ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰ç»„ä»¶å†…è°ƒç”¨å‹è·¯ç”±å®ˆå«å’Œå¼‚æ­¥è·¯ç”±ç»„ä»¶è¢«è§£æä¹‹åï¼Œè¯¥è§£æå®ˆå«å°±ä¼šè¢«è°ƒç”¨ã€‚è¿™é‡Œæ¶‰åŠçš„æ‰§è¡Œæ¡ä»¶éœ€è¦ç†è§£çš„æ˜¯ï¼Œ1æ˜¯å¯¼èˆªç¡®è®¤ä¹‹å‰ï¼Œå¯¼èˆªçš„ç¡®è®¤æ˜¯æŒ‡å…¨éƒ¨çš„é’©å­æ‰§è¡Œå®Œï¼Œå¯¼èˆªçŠ¶æ€å°±æ˜¯ç¡®è®¤çš„(confirmedçŠ¶æ€)ã€‚2æ˜¯ç»„ä»¶å†…è·¯ç”±å®ˆå«å’Œå¼‚æ­¥è·¯ç”±ç»„ä»¶éƒ½è¢«è§£æï¼ŒæŒ‡çš„æ˜¯è·¯ç”±å†…è°ƒç”¨å‹çš„3ä¸ªå®ˆå«beforeRouteEnter, beforeRouteUpdate, beforeRouteLeaveï¼Œå¼‚æ­¥è·¯ç”±ç»„ä»¶è§£æå(æ‡’åŠ è½½ï¼Œé€šè¿‡Import()å‡½æ•°æˆ–requireæ–¹å¼ï¼Œç”¨åˆ°çš„æ—¶å€™ä¼šå»åŠ è½½å†è§£æï¼Œæ²¡ç”¨åˆ°å°±ä¸å­˜åœ¨åŠ è½½è§£æä¸€è¯´)ã€‚ç®€å•æ¥è¯´ï¼Œç­‰ç»„ä»¶å†…è°ƒç”¨å‹å®ˆå«æ‰§è¡Œå®Œäº†ï¼Œå¼‚æ­¥ç»„ä»¶ä¹ŸåŠ è½½å®Œäº†ï¼Œæ‰ä¼šæ‰§è¡ŒbeforeResolveã€‚ afterEachå…¨å±€åç½®é’©å­ã€‚æ²¡æœ‰nextå‚æ•°ï¼Œå¯ä»¥ç†è§£ï¼Œæ¯•ç«Ÿéƒ½å·²ç»åç½®äº†ã€‚åœ¨è·¯ç”±æ“ä½œæµç¨‹çš„æœ€åè§¦å‘ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé’©å­çœ‹èµ·æ¥æ˜¯æœ€åä¸€ä¸ªæ‰§è¡Œçš„é’©å­æ²¡é”™ï¼Œä½†æ˜¯åœ¨ç»„ä»¶å†…è°ƒç”¨å®ˆå«beforeRouteEnterçš„å‚æ•°nextä¸­çš„å›è°ƒå‡½æ•°ï¼Œæ‰æ˜¯æœ€åæ‰§è¡Œçš„ï¼Œæ­¤æ—¶å®ä¾‹å·²åˆ›å»ºå¥½ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å›è°ƒä¸­è®¿é—®åˆ°vueå®ä¾‹ï¼ï¼ï¼ 123456789101112131415161718var router = new VueRouter(&#123; routes: []&#125;)router.beforeEach((to, from, next) =&gt; &#123; console.log(&#x27;æˆ‘æ˜¯è€å¤§ï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œ&#x27;) next();&#125;)router.beforeResolve((to, from, next) =&gt; &#123; console.log(&#x27;æˆ‘æ˜¯ä¿å§†ï¼Œå¤§å®¶éƒ½åŠ è½½å¥½ï¼Œæˆ‘åœ¨åŠ è½½&#x27;) next();&#125;)router.afterEach((to, from, next) =&gt; &#123; console.log(&#x27;æˆ‘æ˜¯çœ‹èµ·æ¥çš„æœ€åä¸€åï¼Œä¸è¿‡å¥½åƒæœ‰ä¸€ä¸ªå“¥ä»¬æ¯”æˆ‘è¿˜é åï¼Œè¿™å“¥ä»¬æ˜¯beforeRouteEnterçš„å›è°ƒå‚æ•°next&#x27;) next();&#125;) æ²¡æœ‰è·¯ç”±åœ°å€çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°3ä¸ªå…¨å±€è·¯ç”±ä¼šè¢«å„è‡ªæ‰§è¡Œä¸€éï¼ã€‚ å•ä¸ªè·¯ç”±ç‹¬äº«å®ˆå«beforeEnteråœ¨è·¯ç”±é…ç½®é‡Œé¢å•ç‹¬é…ç½®çš„ã€‚ 123456789101112var router = new VueRouter(&#123; routes: [ &#123; path: &#x27;/name&#x27;, componet: Name, beforeEnter: (to, from, next) =&gt; &#123; console.log(&#x27;è¿›å…¥nameæ—¶è°ƒç”¨ï¼Œåœ¨ç»„ä»¶å†…è°ƒç”¨çš„å®ˆå«ä¹‹å‰&#x27;) next(); &#125; &#125; ]&#125;) ç»„ä»¶å†…è°ƒç”¨å®ˆå«beforeRouteEnteråœ¨æ¸²æŸ“å½“å‰è·¯ç”±ç»„ä»¶å¯¹åº”è·¯ç”±è¢«å®Œå…¨ç¡®è®¤(confirm)å‰è°ƒç”¨ã€‚å› ä¸ºæ­¤æ—¶ï¼Œç»„ä»¶å®ä¾‹è¿˜æœªè¢«åˆ›å»ºã€‚æ‰€ä»¥æ‹¿ä¸åˆ°thiså³ç»„ä»¶å®ä¾‹ã€‚ä½†å¯ä»¥é€šè¿‡nextçš„å›è°ƒå‡½æ•°æ‹¿åˆ°å®ä¾‹ 123456789101112131415161718export default &#123; name: &#x27;comp&#x27;, beforeRouteEnter(to, from, next) =&gt; &#123; console.log(&#x27;è¿›äº†å½“å‰ç»„ä»¶ä¸”åœ¨è·¯ç”±ç¡®è®¤å‰è°ƒç”¨&#x27;) next((vm) =&gt; &#123; console.log(vm) &#125;) &#125;, beforeRouteUpdate(to, from, next) =&gt; &#123; console.log(&#x27;è¿›äº†å½“å‰ç»„ä»¶ï¼Œæˆ–åœ¨å½“å‰ç»„ä»¶æ‰“å¼€å­è·¯ç”±ç»„ä»¶çˆ¶ç»„ä»¶ä»å­˜åœ¨ï¼Œä½†å†…å®¹å·²ç»ä¸ä¸€æ ·äº†ï¼Œéœ€è¦æ›´æ–°ï¼Œä¼šè°ƒç”¨&#x27;) // å¦‚ homeä¸­æ‰“å¼€Aç»„ä»¶ï¼Œ/home -&gt; /home/Aã€‚ å›åˆ°homeç»„ä»¶ï¼Œ/home/A -&gt; /home next(); &#125;, beforeRouteLeave(to, from, next) =&gt; &#123; console.log(&#x27;ç¦»å¼€å½“å‰è·¯ç”±ç»„ä»¶å¯¹åº”çš„è·¯ç”±æ—¶è°ƒç”¨&#x27;) next(); &#125;&#125; å¯¼èˆªå®Œæ•´çš„è§£ææµç¨‹å¯¼èˆªè§¦å‘ï¼Œè‚¯å®šæ˜¯ä»ä¸€ä¸ªè·¯ç”±åœ°å€è·³å¾€å¦ä¸€ä¸ªã€‚æˆ‘ä»¬è¿™é‡Œè€ƒè™‘è¿™ç§æƒ…å†µ/home/A -&gt; /home/Bï¼Œæ¶‰åŠåˆ°æ‰€æœ‰å®ˆå«; è§¦å‘Açš„beforeRouteLeave è§¦å‘å…¨å±€çš„beforeEach è§¦å‘Homeç»„ä»¶ä¸­çš„beforeRouteUpdate è§¦å‘Bçš„ç‹¬äº«è·¯ç”±å®ˆå«beforeEnter è§£æå¼‚æ­¥ç»„ä»¶ è§¦å‘Bçš„ç»„ä»¶çº§å®ˆå«beforeRouteEnter è§¦å‘å…¨å±€çš„beforeResolve å¯¼èˆªç¡®è®¤ è§¦å‘å…¨å±€çš„afterEach è§¦å‘DOMæ›´æ–° ç»„ä»¶å®ä¾‹åˆ›å»ºå®Œæˆï¼Œè°ƒç”¨beforeRouterEnterä¸­ä¼ é€’ç»™nextçš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å¯ä¼ vmï¼Œå³å®ä¾‹å¯¹è±¡ã€‚","categories":[],"tags":[]}],"categories":[],"tags":[]}